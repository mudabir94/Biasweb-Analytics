{% extends "webapp/newbase.html" %}
{% block content %}
{%load static from staticfiles%}

<!-- <nav class="navbar navbar-inverse">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>                        
            </button>
            <a class="navbar-brand">Mobile Analytics</a>
          </div>
          <div class="collapse navbar-collapse" id="myNavbar">
            <ul class="nav navbar-nav">
             
              <li><a href="{%url 'homepage'%}">Home </a></li>
              
              <li><a href="#" >About</a></li>
             
             
              
              {% if  user.is_authenticated %}
              <li><p id="username">{{ user.get_username }}</p></li>
              <li><a href="{% url 'logout'%}">Logout</a></li> 
              
              {% else %}
              <li><a href="{% url 'login'%}?next={{request.path}}">Login {{request.path}}</a></li>   
              {% endif %}  
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
            </ul>
          </div>
        </div>
      </nav> -->
        
      <div class="container-fluid text-center">    
        <div class="row content">
            <div class="col-sm-3 sidenav" ">
                    <div class='container-fluid'>
                        {% with template_sidebar=template_sidebar %}
                        {% include template_sidebar %}
                        {% endwith %}
                    </div>    
            </div>
          
        <div class="col-sm-8 col-md-8 text-left" > 
              
            <div class="latest-product-section"> 
                    {%  for mob in mobiles  %}
   
                    {% if forloop.counter0|divisibleby:3 %} 
                    <div class="row text-center"> {%  endif %}
                           
                            <div class="col-md-4 col-lg-4 col-xs-12 sm-margin-b-50 pull-left">
                                    <div class="margin-b-20" >
                                    <h4>Compare</h4>
                                    <input type="checkbox" value={{mob.id}} id={{mob.id}} name={{mob.id}}-{{mob.Mobile_Name}}  onchange="toggleCheckbox(this)"> 
                                    <img class="img-responsive" src="{% static mob.imagepath1 %}"  alt="Latest Products Image"  title=""/>
                                        </div>
                                <h4> <span class="text-uppercase margin-l-20">{{mob.Mobile_Name}}</span></h4>
                                <!--
                                    <h4><a href="{% url 'mobileinfo' id=mob.id %}">{{mob.Mobile_Companny}}</a> <span class="text-uppercase margin-l-20">{{mob.Mobile_Name}}</span></h4>
                                    <h4><a href = "{% url 'mobileinfo' id=mob.id %}"> Price </a><span class="text-uppercase margin-l-20">{{mob.price}}</span></h4>
                                    <h4>{{mob.os}}</h4>
                                    <h4><a href = "{% url 'mobileinfo' id=mob.id %}"> Size </a><span class="text-uppercase margin-l-20">{{mob.Size}}-Inch</span></h4>
                                    <h4><a href = "{% url 'mobileinfo' id=mob.id %}"> Color </a><span class="text-uppercase margin-l-20">{{mob.Colors}}</span></h4>
                                    <h4><a href = "{% url 'mobileinfo' id=mob.id %}"> Cpu </a><span class="text-uppercase margin-l-20">{{mob.Cpu}}</span></h4>
                                                                        <h4><a href = "{% url 'mobileinfo' id=mob.id %}"> OS </a><span class="text-uppercase margin-l-20">{{mob.OS}}</span></h4>
                                  -->
                                    <a class="link btn btn-success" href="{% url 'mobileinfo' id=mob.id %}">
                                        {% filter upper %}
                                            Read More
                                        {% endfilter %}</a>
                                   
                            </div>
                {%  if forloop.counter|divisibleby:3 or forloop.last %}
                    </div><!-- row closing --><hr>
                    {%  endif %}
                {%  endfor %}
               
                
                  
            </div>                 
            <div class="pagination" >
                    <span class="step-links" >
                        {% if mobiles.has_previous %}
                            <a href="?page=1">&laquo; first</a>
                            <a href="?page={{ mobiles.previous_page_number }}">previous</a>
                        {% endif %}
                        
                        <span class="current">
                            Page {{ mobiles.number }} of {{ mobiles.paginator.num_pages }}.
                        </span>
                    
                        {% if mobiles.has_next %}
                            <a href="?page={{ mobiles.next_page_number }}">next</a>
                            <a href="?page={{ mobiles.paginator.num_pages }}">last &raquo;</a>
                        {% endif %}
                    </span>
                </div>              
               
        </div>
          <div class="col-sm-1 sidenav">
            <div class=""   id="lc" style="position: fixed">
                  
            </div>
          </div>
        </div>
      </div>
      <footer>
		
            <div class="container-fluid" style='margin-left:15px'>
                <p><a href="#" target="blank">Contact</a> | <a href="#" target="blank">LinkedIn1</a> | <a href="#" target="blank">Twitter</a> | <a href="#" target="blank">Google+</a></p>
            </div>
       </footer>	

    <script>
        var arr=[];
       // Because of this code when subject logs in and goes to filter_mobile_view first it loads all mobile 
       // phones and then on refresh it loads the selected phones. 
        window.addEventListener( "pageshow", function ( event ) {
        var historyTraversal = event.persisted || 
        ( typeof window.performance != "undefined" && 
        window.performance.navigation.type === 2 );
                if ( historyTraversal ) {
                window.location.reload();
            }
        });
        function toggleCheckbox(element){      
        if (element.checked == true){
        console.log(element.id);
         
            if (arr.length ===3){
                alert("Array full ");
                element.checked=false;
            }
            else {
                    arr.push(element.id);
            }
        } 
        else {            
            arr.pop(element.id);
        }
        function myfunc(){ 
            console.log("button clicked");
            $.ajax({
                    type: 'POST',
                    dataType: "json",
                   
                    'data': {
                    'mobiledata': JSON.stringify(arr),
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    
                    },
                    url: "{% url 'showmobile' %}",
                    success: function(response){
                        if (response['role']!=undefined){
                            if (response['role']=="Super_Admin")
                            {
                                console.log("size_of_mobile",response['som']);
                                window.location="{%url 'comparemobile_specs'%}"
                            }
                            else{
                                window.location="{%url 'comparemobilespecsfilt_ver'%}"
                            }
                        }
                        else{
                            console.log("size_of_mobile",response['som']);
                        window.location="{%url 'comparemobilespecsfilt_ver'%}"
                        }
                        
                     
                    
                    }
                    
                    });
           
                   
            // get arr and send it to view. 
            // according to the id display the result in a table
        }
        $(document).ready(function () {
                // alert(JSON.stringify(arr));
               
                if(arr.length>1){
                var elem=document.getElementById('comparebtn_id');
                    if (elem===null)  {
                       
                        var btn = document.createElement("BUTTON");
                        btn.id="comparebtn_id";
                        var t = document.createTextNode("Compare");  
                        btn.appendChild(t);
                        btn.onclick=myfunc;
                        document.getElementById('lc').appendChild(btn);     
                         $('#comparebtn_id').addClass('btn'); 
                         $('#comparebtn_id').addClass('btn-success');   
                        $('#comparebtn_id').addClass('btn-success-edit');        
                        
                    }
                }
                else if (arr.length <=1 ){
                    console.log("in condition");
                    var elem=document.getElementById('comparebtn_id');
                    
                   if (elem!==null){
                    document.getElementById('comparebtn_id').remove();
                   }
                }
        });
 }  


     </script>
{%endblock%}