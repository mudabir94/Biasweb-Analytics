<!DOCTYPE html>
<html lang="en">
<head>
        <title>Mobile Analytics</title>
		<meta charset="utf-8" >
		<meta name="viewport" content = "width=device-width, initial-scale=1.0">
        {% load staticfiles %}
        
        <!-- Google API Script -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
          <!-- Bootstrap 4 js -->
       <script type="text/javascript" src="{% static 'webapp/bootstrap-4.1.3-dist/js/bootstrap.min.js' %}" charset="utf-8"></script>
       <!-- BootStrap sytleSheet -->
       <link rel="stylesheet" href="{% static 'webapp/bootstrap-4.1.3-dist/css/bootstrap.min.css' %}" type = "text/css"/>
        <!-- Jquerry Scripts -->
        <script type="text/javascript" src="{% static 'webapp/js/jquery-ui.js' %}" charset="utf-8" ></script>
        <script type="text/javascript" src="{% static 'webapp/js/jquery.js' %}" charset="utf-8" ></script>
       
        <!-- <script src="//code.jquery.com/jquery-1.10.2.js"></script>
        <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script> -->
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>    
       <!-- One MobileJS -->
       <script type="text/javascript" src="{% static 'webapp/js/one_mobile.js' %}" charset="utf-8"></script>
     
      
       <!-- Ahp Testing JS -->
       <script type="text/javascript" src="{% static 'webapp/ahp_js/ahpCalc.obj.js' %}"></script>
       <script type="text/javascript" src="{% static 'webapp/ahp_js/site.js' %}"></script>
       <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

       <!-- Jquerry style sheet -->
       <link rel="stylesheet" href="{% static 'webapp/css/jquery-ui.css' %}" type="text/css" />
       <link rel="stylesheet" href="{% static 'webapp/css/jquery-ui.structure.css' %}" type="text/css" />
       <link rel="stylesheet" href="{% static 'webapp/css/jquery-ui.theme.css' %}" type="text/css" />
       <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
      
        <!-- 2by2 tablecss syle -->
        <link rel="stylesheet" href="{% static 'webapp/css/2by2tablecss.css' %}" type = "text/css"/>
        <!-- for arrow icons -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    


       <script src="{% static 'webapp/js/rslider/rSlider.min.js' %}"></script>
       <link rel="stylesheet" href="{% static 'webapp/css/rslider/rSlider.min.css' %}">
     <!-- chart js -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
</head>    
<body>
        <nav class="navbar navbar-dark bg-dark">
                    <!-- <div class="container-fluid"> -->
                      <!-- <div class="navbar-header" > -->
                          
                        <a class="navbar-brand" href="#">Mobile Analytics</a>
                          
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                      <!-- </div> -->
                      <div class="collapse navbar-collapse" id="myNavbar">
                        <ul class=" navbar-nav mr-auto">
                         
                          <li><a href="{%url 'homepage'%}">Home </a></li>
                          <li><a href="#" >About</a></li>
                          {% if  user.is_authenticated %}
                          <li><p id="username">{{ user.get_username }}</p></li>
                          <li><p id="role">{{ user.role_id.role_name }}</p></li>
                          <li><a href="{% url 'logout'%}">Logout</a></li> 
                          {% else %}
                          <li><a href="{% url 'login'%}?next={{request.path}}">Login</a></li>   
                          {% endif %}  
                        </ul>
                        <!--<ul class="nav navbar-nav navbar-right">
                          <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
                        </ul>-->
                      </div>
                    <!-- </div> -->
        </nav>

        <div class='container-fluid'>
            <div class='row'>
                <div class="col-md-2" style="background:black">
                    <div id="prevbtn_div"></div>
              </div>
                <div class="col-md-9">
                    <div class="row">
                        <div class="col-md-7" >
                            <div id="tablediv">   </div>
                        </div>
                       <div class='col-md-5'>
                            <!-- <div id="chartContainer" style="height: 300px; width: 100%;"></div> -->
                            <div class='row'>
                                <div class='col-md-12'>
                                    <canvas id="bar_chart" width="400"height="200" style="background:white"></canvas>
                                </div>
                            </div>
                            <div class='row'>
                                <div class='col-md-12'>

                                    <!-- <button onclick="ToggleCriteriaChart()" >Show Weights</button> -->
                                </div>
                            </div>
                                <div class='row'>
                                    <div class='col-md-12'>
                                        <canvas id="bar_chart_criteria" width="400"height="200" style="background:rgba(158, 193, 248, 0.431)"></canvas>
                                    </div>
                                   <!--Creates the popup body-->
                                </div>
                                <div class='row'>
                                    <div class="col-md-12">
                                    <button onclick="showCritTable(this)" 
                                        style="border: transparent;color: white;background: brown;">
                                        Show Weights
                                    </button>
                                     
                                    </div>
                                </div>
                                <div class='row'>
                                    <div class="col-md-12">
                                      <div id="crittable_div" >

                                      </div>
                                    </div>
                                </div>
                           
                        </div>
                    </div>
                </div>
                <div class="col-md-1" style="background:black">
                    <div class="row"> <div id="nextbtn_div"></div>
                </div>
                </div>
            </div>
        </div>
    </body>
</html>

<script >
   // Global variable 
   var allmobiles={}
   var prev_compared_mobiles_list=[];
   var dict_contains_listofCombiations=null;
   // In future change the name. 
   var mobiletesting={};
   
   let  all_rank_matrix_dict= new Object();;
   
   var crit_rank_matrix_dict={};
   var alt_rank_matrix_dict= {};
  
   var criteria_list=[];
   var other_criteria_list=['SIZE',"RESOLUTION"];

   var alternatives_list=[];
   var final_result_dict={};
   var crit_combs=[];
   var alt_combs=[];
   var flag=true;
   var alt_labels_chart=[];
   var crit_labels=[];

   // temparay lsit
    var checkheader=[];
    var checkalts=[];
    var test_result_vecs={
        'criteria':[0.33,0.33]
    };
    var input_range_id_list=[];
    var input_range_val_list=[];


$(document).ready(function(){
   
     // FOR TETSTING COPYING IN SUCCESS METHOD ----------------------.->>>
    // for (var i in alternatives_list){
    //     if (alternatives_list[i].length>5){
    //         var k=alternatives_list[i].split(' ');
    //         console.log(k)
    //          alt_labels_chart.push(k[k.length-1]);
    //     }
    // }
    // // initialization of matrix for ahp... 
    //  var critrankmat= ahpArrayHelper._setUpSquareArray(criteria_list.length);
    //  all_rank_matrix_dict['criteria']=critrankmat;
      
    //  let alt_mat= ahpArrayHelper._setUpSquareArray(alternatives_list.length);
   
    //  var calcResults = ahpCalc.calculateResults(alt_mat);
   
    // //  all_rank_matrix_dict['price']=alt_mat;
    // //  let alt_mat2= ahpArrayHelper._setUpSquareArray(alternatives_list.length);
    // //  console.log(alt_mat2);
    // //  all_rank_matrix_dict['imagepath1']=alt_mat2;

    // //  return false;
    // if(flag==true){
    //  for (var crit in criteria_list){
    //       let alt_mat= ahpArrayHelper._setUpSquareArray(alternatives_list.length);
   
    //     all_rank_matrix_dict[criteria_list[crit]]=alt_mat;
    //      flag=false;
    //  }
    // }
   
    // combination pairs for the comparison of criterias.  
    // crit_combs=k_combinations(criteria_list, 2);
    // // combination pairs for the comparison of alternatives. 
    // alt_combs=k_combinations(alternatives_list, 2);
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // $('#bar_chart_criteria').hide();
    $.ajax({
                type: 'POST',
                dataType: "json",
                'data': {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
        // the ajax call is sent to subdetails url name in the post function.  
                url: "{% url 'comparemobile_specs' %}",
                success: function(data){
                    // check num of mobiles. 
                    console.log('data',data)   
                    if (data['numofmobiles']===2){
                       allmobile=data['allmobiles'] 
                    }   
                    else{
                        //check
                        if (dict_contains_listofCombiations===null){
                            // initiallization on each success func
                            var dict_lst_comb_keynum=0;
                        }
                        alternatives_list=data['alternative_list'];
                        criteria_list=data['criteria_list'];
                        // FOR OTHERS TESTING @DATE 1/JAN/2019
                            criteria_list.push("Others")
                         // IN future also assign alternative list from data 
                         for (var i in alternatives_list){
                                if (alternatives_list[i].length>5){
                                    var k=alternatives_list[i].split(' ');
                                    console.log('k',k);
                                    console.log('k[k.length-1]',k[k.length-1])
                                    // change the name of alt_labels_chart to something relate able. IN FUTURE
                                    alt_labels_chart.push(k[k.length-1]);
                                }
                            }
                            // initialization of matrix for ahp... 
                            var critrankmat= ahpArrayHelper._setUpSquareArray(criteria_list.length);
                            all_rank_matrix_dict['criteria']=critrankmat;
                            // on the basis of critiers initiallize test_result_vecs. 
                            // initialize with 0.333
                            var init_weigts=[];
                            
                            for (var ct in criteria_list){
                                init_weigts.push(0.333);
                                console.log("criteria_list[ct][0]",criteria_list[ct][0])
                                crit_labels.push(criteria_list[ct][0]+criteria_list[ct][1])
                            }
                            test_result_vecs['criteria']=init_weigts
                            let alt_mat= ahpArrayHelper._setUpSquareArray(alternatives_list.length);
                        
                            var calcResults = ahpCalc.calculateResults(alt_mat);
                            
                            //  all_rank_matrix_dict['price']=alt_mat;
                            //  let alt_mat2= ahpArrayHelper._setUpSquareArray(alternatives_list.length);
                            //  console.log(alt_mat2);
                            //  all_rank_matrix_dict['imagepath1']=alt_mat2;

                            //  return false;
                            if(flag==true){
                            for (var crit in criteria_list){
                                let alt_mat= ahpArrayHelper._setUpSquareArray(alternatives_list.length);
                                all_rank_matrix_dict[criteria_list[crit]]=alt_mat;
                                flag=false;
                            }
                         }
                        console.log("all_rank_matrix_dict",all_rank_matrix_dict) 
                        crit_combs=k_combinations(criteria_list, 2);
                     // combination pairs for the comparison of alternatives. 
                        alt_combs=k_combinations(alternatives_list, 2);
                        mobiletesting=data['allmobiles'];     
                        processMobileData(dict_lst_comb_keynum);
                        showchart_criteria();
                    }
                    // right now code only works for 3 mobiles not 2
                    // allmobile=data
                    // makeTable(allmobile)
                    }
                }); 
   });


function ahptesting(){
    // for final ahp result....
    
    // console.log("test_result_vecs['criteria']22",test_result_vecs['criteria'])
    var weights=test_result_vecs['criteria'];
 
    // var weights=[0.125, 0.875];
    console.log("weights",weights);
    var crit_dict={};

    for (criteria in criteria_list){
        console.log("test_result_vecs",test_result_vecs);

        console.log("test_result_vecs[criteria_list[criteria]]",test_result_vecs[criteria_list[criteria]]);
        console.log("weights",weights)
        if (test_result_vecs[criteria_list[criteria]]==undefined){

            crit_dict[criteria_list[criteria]]=[0,0,0];
        }
        else{
            crit_dict[criteria_list[criteria]]=test_result_vecs[criteria_list[criteria]];
        }
    }
    // weights=[0.7263184843830004, 0.20835466803208738, 0.0653268475849121]
    // os=[0.1399,0.5535,0.2610,0.0955]
    // ss=[0.1226,0.2852,0.3461,0.2459]
    // cam=[0.556,0.2776,0.00549,0.6461]
//     if (price==undefined){
//         crit_dict['price']=[0,0,0];
//     }
//     else{
//         crit_dict['price']=price;
//     }
//    if (imagepath1==undefined){
//     crit_dict['imagepath1']=[0,0,0];
//    }else{
//     crit_dict['imagepath1']=imagepath1;
//    }
    
    
    var product_list_main=[]
    for (var i=0;i<weights.length;i++){
        for (var j=i;j==i;j++){
            
          
            var product_list=[]
            for (var k=0;k<alternatives_list.length;k++){
            
                var product=weights[i]*crit_dict[criteria_list[j]][k]
                product_list.push(product);
              
                
                // weight_alt_product_dict[crit_list[j]]=product_list;

            }
            product_list_main.push(product_list)
            // var squares = product_list.map((a, i) => a + arr2[i]);
         
        }
    }
    var finalresult_list=[]
    finalresult_list=product_list_main[0]
    for (var w=0;w<product_list_main.length;w++){
        if(product_list_main[w+1]!=undefined){
            finalresult_list = product_list_main[w+1].map((a, i) => a +finalresult_list[i]);
        }
    }
    console.log('final',finalresult_list)
    final_result_dict['final']=finalresult_list;
    final_result_dict['criteria']=test_result_vecs['criteria'];
}
function myrecord(pair,score,criteria){
   console.log(score)
   console.log(criteria)
   console.log( '  all_rank', all_rank_matrix_dict[criteria])
    let rankmat=    all_rank_matrix_dict[criteria];
    
    rankmat[pair[0]][pair[1]] = score;
   

    rankmat[pair[1]][pair[0]] = 1/score;
      
  return rankmat;
}
function k_combinations(set, k) {
	var i, j, combs, head, tailcombs;
	
	// There is no way to take e.g. sets of 5 elements from
	// a set of 4.
	if (k > set.length || k <= 0) {
		return [];
	}
	
	// K-sized set has only one K-sized subset.
	if (k == set.length) {
		return [set];
	}
	
	// There is N 1-sized subsets in a N-sized set.
	if (k == 1) {
		combs = [];
		for (i = 0; i < set.length; i++) {
			combs.push([set[i]]);
		}
		return combs;
	}
	
	// Assert {1 < k < set.length}
	
	// Algorithm description:
	// To get k-combinations of a set, we want to join each element
	// with all (k-1)-combinations of the other elements. The set of
	// these k-sized sets would be the desired result. However, as we
	// represent sets with lists, we need to take duplicates into
	// account. To avoid producing duplicates and also unnecessary
	// computing, we use the following approach: each element i
	// divides the list into three: the preceding elements, the
	// current element i, and the subsequent elements. For the first
	// element, the list of preceding elements is empty. For element i,
	// we compute the (k-1)-computations of the subsequent elements,
	// join each with the element i, and store the joined to the set of
	// computed k-combinations. We do not need to take the preceding
	// elements into account, because they have already been the i:th
	// element so they are already computed and stored. When the length
	// of the subsequent list drops below (k-1), we cannot find any
	// (k-1)-combs, hence the upper limit for the iteration:
	combs = [];
	for (i = 0; i < set.length - k + 1; i++) {
		// head is a list that includes only our current element.
		head = set.slice(i, i + 1);
		// We take smaller combinations from the subsequent elements
		tailcombs = k_combinations(set.slice(i + 1), k - 1);
		// For each (k-1)-combination we join it with the current
		// and store it to the set of k-combinations.
		for (j = 0; j < tailcombs.length; j++) {
			combs.push(head.concat(tailcombs[j]));
		}
	}
	return combs;
}
function  makeCombinations(mobiles){
        // Get the keys from data['allmobiles']
            var keys = Object.keys(mobiles)
           
            var list1=['Samsung Galaxy A3 2017','Samsung galaxy S7']
            var list2=['Samsung Galaxy A3 2017','Samsung galaxy A5']
            var list3=['Samsung galaxy S7','Samsung galaxy A5']
            var dict={}
            dict[0]=list1;
            dict[1]=list2;
            dict[2]=list3;
            var k_combs=k_combinations(keys, 2);
            return k_combs;
            // make combinations of the keys.
                // store different combinations in lists and all
                // of the lists in dict.
    }
function processMobileData(keynum){
                           
    if (dict_contains_listofCombiations===null){
        dict_contains_listofCombiations=makeCombinations(mobiletesting)
    }

        if (prev_compared_mobiles_list.length===0){
        var listofcomb=dict_contains_listofCombiations[keynum];
                 console.log("listofcomb",listofcomb)
                 allmobiles[listofcomb[0]]=mobiletesting[listofcomb[0]];
                 allmobiles[listofcomb[1]]=mobiletesting[listofcomb[1]];
                 makeTable(allmobiles,keynum);
                 allmobiles={};
            } 
            else{
                var listofcomb=dict_contains_listofCombiations[keynum];
                allmobiles[listofcomb[0]]=mobiletesting[listofcomb[0]];
                allmobiles[listofcomb[1]]=mobiletesting[listofcomb[1]];
                makeTable(allmobiles,keynum);
                allmobiles={};
            }

            
}
var slider_id_val_check_dict=null;
function nextMobilePair(currentKeycombination){
    

   
        // key num increment
        var keynum=currentKeycombination+1;
        // // dict_contains_listofCombiations will be accessed 
        // var comb_list_check=dict_contains_listofCombiations[keynum]
        // // if value would contain null then there would be nothing to compare and no table will be generated
        // console.log('comb_list_check',comb_list_check)
        // if (comb_list_check==undefined){
        //     $('#nextbtn_div').empty();
        //     console.log("dont process the data")
        // }
        // else {
            var input_class=document.getElementsByClassName('slider')
            console.log('input_class',input_class.length);
            var temp_slider_id_val_check_list=[];
            var temp_final_list=[];
            for (var i=0;i<input_class.length;i++){
                
                 temp_slider_id_val_check_list.push(input_class[i].id) 
                 temp_slider_id_val_check_list.push(input_class[i].value)  
                 temp_final_list.push(temp_slider_id_val_check_list);
              
                 temp_slider_id_val_check_list=[];
            }
            if (slider_id_val_check_dict==null){
                slider_id_val_check_dict={};
            }
            slider_id_val_check_dict[dict_contains_listofCombiations[keynum-1]]=temp_final_list;
            temp_final_list=[]
            console.log("slider_id_val_check_dict",slider_id_val_check_dict)
            // slider_id_val_check_list=temp_slider_id_val_check_list;
            // store the id and value in a list. 
            $('#tablediv').empty();
            $('#prevbtn_div').empty();
            // store index/keynum in prev_compared_mobiles_list
            prev_compared_mobiles_list.push(currentKeycombination);
            console.log("prev_compared_mobiles_list",prev_compared_mobiles_list);
            console.log("dict_contains_listofCombiations",dict_contains_listofCombiations)
            // call the processMobileData function
            // get all the slider ids from the current page and store in 
            // a list. 
           
            processMobileData(keynum);
           
        // }

}
function previousMobilePair(currentKeycombination){

                
                // this logic doesnt make any sense..lol but it is required.....
                if ($('#prevbtn_div').empty()===true){
                    $('#prevbtn_div').empty();
                }
                if ($('#nextbtn_div').children().text()==='Submit'){
                    // alert("Coming in it ")
                    keynum=currentKeycombination;
                    // get current sliders 
                        var input_class=document.getElementsByClassName('slider');
                        console.log("input_class<--",input_class)
                        var temp_slider_id_val_check_list=[];
                        var temp_final_list=[];
                    for (var i=0;i<input_class.length;i++){
                    
                        temp_slider_id_val_check_list.push(input_class[i].id) 
                        temp_slider_id_val_check_list.push(input_class[i].value)  
                        temp_final_list.push(temp_slider_id_val_check_list);
                        temp_slider_id_val_check_list=[];
                    }
                    if (slider_id_val_check_dict==null){
                        slider_id_val_check_dict={};
                    }
                    console.log("temp_final_list<--",temp_final_list)
                    slider_id_val_check_dict[dict_contains_listofCombiations[keynum]]=temp_final_list;
                    temp_final_list=[]
                    console.log("slider_id_val_check_dict<--",slider_id_val_check_dict)
                }
                $('#tablediv').empty();
                        // Previous Button would be created this time as prev_compared_mobiles_list is not empty
                        // ***Its main job is to getting the previous/last updated 
                        // listofcombination from prev_compared_list and make table according to it.***
                        // get the last index stored in prev_compared_mobiles_list and pass to the func->
                        var keynum=prev_compared_mobiles_list.pop();
                        //processMobileData func will be called. 
                        processMobileData(keynum)
                        // 
                        // 
                        
                }
function makeTable(allmobile,keynum){
    // features=['Model','price']
    var table=document.createElement("TABLE");
    // table.setAttribute('class','table-bordered')
    var thead=document.createElement("THEAD");
    table.appendChild(thead)
    var tbody=document.createElement("TBODY");
    table.appendChild(tbody);
    var trh=document.createElement("TR");
    thead.appendChild(trh);
    var th=document.createElement('TH')
    th.setAttribute("style","padding-right:1pc")
    trh.appendChild(th);
    th.append("Criteria");
    var count=0;
    var mobilename=[];
    var specs=[];
    for (var namekey  in allmobile){
        
        mobilename.push(namekey)
        // console.log("namekey",namekey)
        // console.log('allmobile[namekey]',allmobile[namekey])
        var th=document.createElement('TH')
        th.setAttribute("style","padding-right:1pc")
        trh.appendChild(th);
        th.append(namekey)
        if (count==0){
            var rowcount=0
            for (var mobilespec in allmobile[namekey]){
            if (mobilespec==='imagepath1'){
                specs.push('imagepath1')
                
                var tr=document.createElement('TR');
                tr.setAttribute('id','imagepath1'+rowcount)
                tbody.appendChild(tr);
                var td=document.createElement('TD');
                td.setAttribute("align","center")
                tr.appendChild(td);
                td.append('Models');
                var td=document.createElement('TD');
                td.setAttribute("align","center")
                tr.appendChild(td);
                var img=document.createElement('img');
                img.setAttribute('class','img-responsive')
                var im=allmobile[namekey][mobilespec]
                console.log("hhbjn","/static/"+im)
                img.src="/static/"+im;
                img.style="height: 154px;"
                td.append(img);
                // console.log('mobilespec',mobilespec)
                // console.log('allmobile[namekey][mobilespec]',allmobile[namekey][mobilespec])
                
                rowcount++;
                $('#tablediv').append(table) 
                }
            else{
                specs.push(mobilespec)
                
                var tr=document.createElement('TR');
                tr.setAttribute('id',mobilespec+rowcount)
                tbody.appendChild(tr);
                var td=document.createElement('TD');
                td.setAttribute("align","center")
                tr.appendChild(td);
                td.append(mobilespec);
                var td=document.createElement('TD');
                td.setAttribute("align","center")
                tr.appendChild(td);
                td.append(allmobile[namekey][mobilespec]);
                // console.log('mobilespec',mobilespec)
                // console.log('allmobile[namekey][mobilespec]',allmobile[namekey][mobilespec])
                
                rowcount++;
                $('#tablediv').append(table) 
            }
        }
           
        }
        else{
            var rowcount=0
            for (var mobilespec in allmobile[namekey]){
                if (mobilespec==='imagepath1'){
                    var img=document.createElement('img');
                img.setAttribute('class','img-responsive')
                var im=allmobile[namekey][mobilespec]
                // console.log("hhbjn",im)
                img.src="/static/"+im;
                img.style="height: 154px;"
                    var extendrow=document.getElementById(mobilespec+rowcount)
                    td_cell=extendrow.insertCell(-1);
                    td_cell.setAttribute("align","center")
                    td_cell.append(img);
                rowcount++;
                 
                }
                else{
                var extendrow=document.getElementById(mobilespec+rowcount)
                td_cell=extendrow.insertCell(-1);
                td_cell.setAttribute('align',"center")
                td_cell.innerHTML=allmobile[namekey][mobilespec]
                rowcount++;
                }
            }
        
        }
        count++;
    }


/// ADDING Sliderss...
    var rowcount=0;
    
    for (var mbs in specs){
               
    var refrow =document.getElementById(specs[mbs]+rowcount);

    if (refrow!=null){
        var newrow = document.createElement("TR");
        newrow.setAttribute('align','center')
        newrow.setAttribute('id',specs[mbs]+'-'+mobilename)
        // var td=document.createElement('TD');
        // newrow.appendChild(td);
        // td.append("Slider ");
        var td=document.createElement('TD');
        td.setAttribute('id',specs[mbs]+'-'+mobilename+'-td')
        td.setAttribute("align","center")
        td.setAttribute('colSpan',"3")
        newrow.appendChild(td);
        // creating style divs ... 
        var div_row=document.createElement('div')
        div_row.setAttribute('class','row');
        td.append(div_row);
        var div_col=document.createElement('div');
        div_col.setAttribute('class','col-md-2')
        div_row.append(div_col);
        var div_col1=document.createElement('div');
        div_col1.setAttribute('class','col-md-8');
        div_row.append(div_col1);
        
        var input = document.createElement("input");
        input.type = "text";
        input.id=specs[mbs]+'-'+mobilename+'-td'+'__'+specs[mbs]+'-slider';
        input.setAttribute('class','slider')
        div_col1.append(input);
       
      
        var span=document.createElement('span');
        span.id=specs[mbs]+'span';
        span.innerHTML=1;
        
        var div_col2=document.createElement('div');
        div_col2.setAttribute('class','col-md-2');
        div_col2.append(span)
        div_row.append(div_col2);

        td.append(div_row);
        refrow.parentNode.insertBefore(newrow, refrow.nextSibling);
        rowcount++;
       
  
      // on creation check if the comparison is already done or not ? 
      // if already done then load the values of ranges selected earlier 
      // into the slider value ... THATS it.   
      // if target id matched the stored slider id then get value
      
      // GEt the  current pair of mobile in comparison
      // search in dict if the pair already exsists. 
      // if it exsists then get the values of slider one by one, which is based on the loop. 

        var current_slider_comb=mobilename;
        current_slider_comb=current_slider_comb.join(',')
        console.log("current_slider_comb",mbs)
        console.log(slider_id_val_check_dict);
        var value=[1];
        if (slider_id_val_check_dict!=null){
            if (slider_id_val_check_dict[current_slider_comb]!=undefined){
                console.log("slider_id_val_check_dict-->",slider_id_val_check_dict[current_slider_comb][mbs][1]);
                value=[parseInt(slider_id_val_check_dict[current_slider_comb][mbs][1])];
            }
          
            
        }
        
       
    
        var slider2 = new rSlider({
                    target: specs[mbs]+'-'+mobilename+'-td'+'__'+specs[mbs]+'-slider',
                    
                    values: [-9,-8,-7,-6,-5,-4,-3,-2,1,2,3,4,5,6,7,8,9],
                    widget:false,
                    // labels:[9,8,7,6,5,4,3,2,1,2,3,4,5,6,7,8,9],
                    
                    labels:false,
                    set:value,
                    tooltip:false,
                    
                  
                    onChange: function (event) {
                        // console.log(this.target);
                        var split_arr=this.target.split('__');
                        var parent_id=document.getElementById(split_arr[0]).parentNode;
                        showSliderRangeVal(parent_id,event)
                    }
        });
       

        }
    }

    // Check for next button generation @TODO:
         //check if combination dict_contains_listofCombiations[key+1]  undefined for next then don't generate next button.  
    var comb_list_check_maketable=dict_contains_listofCombiations[keynum+1]
    if (comb_list_check_maketable==undefined){
        $('#nextbtn_div').empty();
        var submit_button=document.createElement("BUTTON");
        submit_button.setAttribute("class","btn btn-success");
        var text = document.createTextNode("Submit");
        submit_button.appendChild(text);
        $(submit_button).appendTo('#nextbtn_div');

    }
    else{
         // Generate Next button
         $('#nextbtn_div').empty();
        var nextbutton=document.createElement('button');
        nextbutton.setAttribute("onclick","nextMobilePair("+keynum+")")
        nextbutton.setAttribute("class","btn btn-primary");
        var text = document.createTextNode("Next ");
        nextbutton.appendChild(text);
        var itag=document.createElement("I")
        itag.setAttribute("class","fa fa-arrow-circle-right");
        nextbutton.appendChild(itag);
      
        $(nextbutton).appendTo('#nextbtn_div');
    }
    //Check for previous button 
    if (prev_compared_mobiles_list.length===0){
        // dont make the button 
        // if button exsists then remove it. 
        console.log("in if condition")
    }
    else{
        var prevbutton=document.createElement('button');
        prevbutton.setAttribute("onclick","previousMobilePair("+keynum+")");
        prevbutton.setAttribute("class","btn btn-primary");
        var itag=document.createElement("I")
        itag.setAttribute("class","fa fa-arrow-circle-left");
        prevbutton.appendChild(itag);
        var text = document.createTextNode("Prev ");
        prevbutton.appendChild(text);
       
        $(prevbutton).appendTo('#prevbtn_div');
    }
}

function conversionFunction(score){
    if (score<0){
        console.log('score-left-before',score)
        var score=-(score) //+10;
        console.log('score_left',score)
    }
    else{
        // score =-score
        // var score=score-8;
        console.log('score_right-before',score)
        score=1/score;
        console.log('score-right-after',score)

    }
    
    return score;
}

// Function to check if the templist contains comparison objects array
function containsArray (obj1, obj2,temp_list) {
  console.log("obj1",obj1);
  console.log("obj2",obj2);
  for (key in obj1){ 
     if (JSON.stringify(obj1[key]) == JSON.stringify(obj2)){
                  var index_array=[]
           for (var k in obj2){

               index_array.push(temp_list.indexOf(obj2[k]));
                   }
        return index_array;        
     }
   }
}


function showSliderRangeVal(parent_id,value){
     //console.log('element',element.id);
     console.log('parent id',parent_id.id);
    // var objele=$(element);
    // console.log('objele',objele)
    var val=parseInt(value);
    var score=val;
    console.log('score_first',score)

    score=conversionFunction(score);
    console.log('score',score);
    //console.log("parentid",objele.parent().attr('id'));
    //var parent_id=$('#'+parent_id).attr('id')//objele.parent().parent().attr('id');
    // console.log("parentid",$(element).parent().parent().attr('id'));
    // var parent_id=$(element).parent().parent().attr('id');
    var split_arr=parent_id.id.split('-');
    var criteria=split_arr[0];
    console.log("split_arr[0]",split_arr[0])
    var rawphoneslist=split_arr[1];
    var phones=rawphoneslist.split(',');
     // each of these funcs will go to slider functions in future.... 
    
    var pair=containsArray(alt_combs,phones,alternatives_list);
    console.log('pair========',pair)
    console.log('criteria========',criteria)
    var mat=[];
    mat=myrecord(pair,score,criteria);
    var calcResults = ahpCalc.calculateResults(mat);
    console.log('all',all_rank_matrix_dict);
    console.log(calcResults);
    test_result_vecs[criteria]=calcResults.resultColumn;
    // test_result_vecs['criteria']=calcResults.resultColumn;
    console.log('test_result_vecs[criteria]all',test_result_vecs[criteria]);
    ahptesting();
    console.log(criteria+'span');
    if (val<0){
        val=-val;
    }
    document.getElementById(criteria+'span').innerHTML=val;
 
    
    showchart_final();
    // showchart_criteria();
   
}
var myChart;
function showchart_final(){

    var main_data={};
    var dataset=[];
    var dataset_dic={};
    var labels=alt_labels_chart;
    var label='Final Score';
    var data_per=[];
    for (var t in final_result_dict['final']){
       
        data_per.push( 100* final_result_dict['final'][t])
    }
    var data=data_per;
    // change color. 
    // var backg_col=[];
    // var bor_col=[];
    //     var red=100;
    //     var green=255;
    //     var blue=40;
    //     var alpha=0.6;
    // for (var c=0;c<alternatives_list.length;c++){
        
    //     var rgba='rgba('+red+','+ green+','+blue+','+ alpha+')'
    //     red=red+50;
    //     green=green-20;
    //     blue=blue+50;
    //     backg_col.push(rgba)
    //     bor_col.push(rgba)
    // }
    var backgroundColor=[ 'rgba(255, 99, 132, 0.6)','rgba(54, 162, 235, 0.6)','rgba(255, 206, 86, 0.6)',]
    var borderColor=['rgba(255,99,132,1)','rgba(54, 162, 235, 1)','rgba(255, 206, 86, 1)',]
    // var backgroundColor=backg_col;
    // var borderColor=bor_col;
    var borderWidth=0.5;

    dataset_dic['label']=label;
    dataset_dic['data']=data;
    dataset_dic['backgroundColor']=backgroundColor;
    dataset_dic['borderColor']=borderColor;
    dataset_dic['borderWidth']=borderWidth;
    dataset.push(dataset_dic);
    main_data['labels']=labels;
    main_data['datasets']=dataset;
    console.log(main_data);
    console.log(crit_combs)
    if(myChart)
    {
        myChart.destroy();
    }
	var canvas=document.getElementById('bar_chart').getContext('2d')
    
    
     myChart = new Chart(canvas, {
    type: 'horizontalBar',
    
    data: main_data,
    showTooltips: true,
    // options: {
    //     scales: {
    //         yAxes: [{
    //             ticks: {
    //                 beginAtZero:true,
    //                  max:100
    //             }
    //         }]
    //     }
    // }
});

}
var myChart_crit;
function showchart_criteria(){
    var main_data={};
    var dataset=[];
    var dataset_dic={};
    var label='Criteria';
    var data_per=[];
    console.log("final_result_dicta--q-w",final_result_dict['criteria'])
    for (var t in final_result_dict['criteria']){
       
        data_per.push( 100* final_result_dict['criteria'][t])
    }
    var data=data_per;
    var backg_col=[];
    var bor_col=[];
    // #@TODO: Color Pallete, distinct colors..
        var red=100;
        var green=255;
        var blue=40;
        var alpha=0.6;
    for (var c=0;c<criteria_list.length;c++){
        
        var rgba='rgba('+red+','+ green+','+blue+','+ alpha+')'
        red=red+50;
        green=green-20;
        blue=blue+50;
        backg_col.push(rgba)
        bor_col.push(rgba)
    }
    // console.log(backg_col)
    // var backgroundColor=[ 'rgba(255, 99, 132, 0.2)','rgba(54, 162, 235, 0.2)','rgba(255, 206, 86, 0.2)','rgba(255, 100, 86, 0.2)']
    // var borderColor=['rgba(255,99,132,1)','rgba(54, 162, 235, 1)','rgba(255, 206, 86, 1)','rgba(255, 100, 86, 0.2)']
    var backgroundColor=backg_col;
    var borderColor=bor_col;
    var borderWidth=0.5;

    dataset_dic['label']=label;
    dataset_dic['data']=data;
    dataset_dic['backgroundColor']=backgroundColor;
    dataset_dic['borderColor']=borderColor;
    dataset_dic['borderWidth']=borderWidth;
    dataset.push(dataset_dic);
    // convert labels into dynamic list. 
    // get first ele of crit from criteria list. 

    // main_data['labels']=['M','P','C','Cp','OS'];
    main_data['labels']=crit_labels
    main_data['datasets']=dataset;
    console.log("main_data",main_data);
    if(myChart_crit)
    {
        myChart_crit.destroy();
    }

    var canvas_crit=document.getElementById('bar_chart_criteria').getContext('2d');
    myChart_crit = new Chart(canvas_crit, {
    type: 'pie',
    showTooltips: false,
    data: main_data,
    
    // options: {
    //     scales: {
    //         yAxes: [{
    //             ticks: {
    //                 beginAtZero:true,
    //                 // max: 100
    //             }
    //         }]
    //     }
    // }
});
}
function ToggleCriteriaChart(){
    $("#bar_chart_criteria").toggle();
}
var crit_val_check_dict={};
function showCritTable(element){

$('#crittable_div').empty();
$('#crittable_div').dialog({ 
    title: "Criteria Comparison",
    autoOpen: false,
    minHeight: 200,
    maxHeight: 300,
    closeOnEscape: true,
    hide: { effect: "highlight", duration: 1000 },
    buttons: [
    {
      text: "Save",
      
      click: function() {
           ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            var input_class=document.getElementsByClassName('slider2')
            console.log('input_class',input_class.length);
            var temp_slider_id_val_check_list=[];
            var temp_final_list=[];
            for (var i=0;i<input_class.length;i++){
                var comb_slider_id_split=input_class[i].id.split('-')[0];
                 temp_slider_id_val_check_list.push(input_class[i].id.split('-')[0]) 
                 temp_slider_id_val_check_list.push(input_class[i].value)  
                 temp_final_list.push(temp_slider_id_val_check_list);
              
                 temp_slider_id_val_check_list=[];
            }
            console.log("temp_final_list<-->",temp_final_list)
            if (crit_val_check_dict==null){
                crit_val_check_dict={};
            }
            for (var i in temp_final_list){
               
                crit_val_check_dict[temp_final_list[i][0]]=temp_final_list[i][1];
                
            }
            console.log("crit_val_check_dict_ok",crit_val_check_dict)
            temp_final_list=[]

        
        $( this ).dialog( "close" );
      }
 
      // Uncommenting the following line would hide the text,
      // resulting in the label being used as a tooltip
      //showText: false
    }
  ]
    }); // Initialize dialog plugin
$('#crittable_div').dialog("open"); // Open popup
// $('#crittable_div').toggle();
// get criteria rank matrix. 
// get criteria combinations. 

// update criteira rank on each slider change/ 
// criteria list. 


var div = document.createElement('div');
div.setAttribute('class','row');
for (var i=0;i<crit_combs.length;i++){
    console.log("crit_comb",crit_combs[i])
    var comb_div=document.createElement('DIV');
    comb_div.setAttribute('class','col-md-12');
                var p_row_div=document.createElement('DIV');
                p_row_div.setAttribute('class','row');

                var comb_names_p=crit_combs[i]
                for (var e=0;e<comb_names_p.length;e++){
                    var p_col_div=document.createElement('DIV');
                    p_col_div.setAttribute('class','col-md-6');
                    var p=document.createElement('p');
                    p.innerHTML=comb_names_p[e];
                    p_col_div.append(p);
                    p_row_div.append(p_col_div);
                }
    comb_div.append(p_row_div);
            var input_row_div=document.createElement('DIV');
            input_row_div.setAttribute('class','row');
                var input_col_div=document.createElement('DIV');
                input_col_div.setAttribute('class','col-md-10');
                    var input = document.createElement("input");
                    input.type = "text";
                    input.id=crit_combs[i]+'-slider22';
                    input.setAttribute('class','slider2');
                    input_col_div.append(input)
                input_row_div.append(input_col_div);
                var input_col_span_div=document.createElement('DIV');
                input_col_span_div.setAttribute('class','col-md-2');
                    var input_span=document.createElement('span');
                    input_span.id=crit_combs[i]+'-span';
                    input_span.innerHTML=1;
                    input_col_span_div.append(input_span);
                    input_row_div.append(input_col_span_div);

                
            comb_div.append(input_row_div)
            div.append(comb_div);   
    $('#crittable_div').append(div);
    
    var dict_key_join=crit_combs[i].join(',');
    console.log("<--",crit_val_check_dict)
        // check if the crit_check_dict contains the value for the crit combinations if so, then replace the value... 
    var value=[1];
    if (crit_val_check_dict[dict_key_join]!=undefined){
        // crit_val_check_dict[crit_combs[i]][i][0]
        console.log("crit_val_check_dict[dict_key_join]",crit_val_check_dict[dict_key_join]);
        value=[parseInt(crit_val_check_dict[dict_key_join])]
    }
var slider = new rSlider({
                    target: crit_combs[i]+'-slider22',
                    values: [-9,-8,-7,-6,-5,-4,-3,-2,1,2,3,4,5,6,7,8,9],
                    widget:false,
                    // labels:[9,8,7,6,5,4,3,2,1,2,3,4,5,6,7,8,9],
                    labels:false,
                    set:value,
                    tooltip:false,
                    onChange: function (event) {
                        // showSliderRangeVal_crit()
                        console.log(this.target)
                        var split_arr_critcomb=this.target.split('-');
                        var comb_tob_tested=split_arr_critcomb[0].split(',');
                        var pair2=containsArray(crit_combs,comb_tob_tested,criteria_list);
                        console.log("pair2",pair2);
                        score=conversionFunction(event);
                        
                         if (event<0){
                            event=-event;
                        }
                        console.log(split_arr_critcomb[0])
                        document.getElementById(split_arr_critcomb[0]+'-span').innerHTML=event;
                        var mat=[];
                        mat=myrecord(pair2,score,'criteria');

                        all_rank_matrix_dict['criteria']=mat;
                       
                        var calcResults = ahpCalc.calculateResults(all_rank_matrix_dict['criteria']);
                        test_result_vecs['criteria']=calcResults.resultColumn;
                        final_result_dict['criteria']=test_result_vecs['criteria'];
                        ahptesting();
                        showchart_criteria();
                        showchart_final();

                    }
        });

      

}
 

}

</script>


