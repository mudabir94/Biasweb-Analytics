{% extends "webapp/newbase.html" %}
{% block content %}
{%load static from staticfiles%}
<div class="container-fluid text-center">    
    <div class="row content">
        <div class="col-md-2 sidenav" >
        </div>
        <div class=" col-md-8 text-left"  >
            <div class="row is-flex">
                <div class="col">
                    <ul class="crit_list">
                        
                    {%for crit in crit_list%}
                    <li  rel="{{crit}}" style="padding-top:20px"> 
                        <div class="row is-flex">
                            {%if crit == "imagepath1" %}
                            <div class="col-md-3">Look and Feel</div>
                            {%else%}
                            <div class="col-md-3">{{crit}}</div>
                            {%endif%}
                            <div class="col-md-9"><input id="{{crit}}" class="slider"></input></div>

                        </div>
                    
                    

                    </li>
                    {%endfor%}

                    </ul>
                </div>
               
         </div>              

            
        </div>
        
        <div class="col-md-2 sidenav" >
                <button  onclick="SaveWeights()">Save</button>
                <button  onclick="NextPage()">Next</button>

        </div>
    
    
    </div>
    
    </div>
<script>
    var critlist_val_dict=null
    var crit_list=[]
$(document).ready(function(){ 
    // localStorage.removeItem("critlist_val_dict");

    // GET CRIT LIST and run the slider.... 
   
    $(".crit_list li").each(function(i)
    {
         console.log($(this).attr('rel')) // This is your rel value
         crit_list.push($(this).attr('rel'));
    });
    // $.ajax({
    // type: 'GET',
    // dataType: "json",
    // 'data': {

    // },
    // url: "{% url 'criteria_weights' %}",
    // success: function(data){
    //     critlist_val_dict=JSON.parse(data['criteria_weights_dict'])
    //     console.log("critlist_val_dict",critlist_val_dict)
    // }
    
    // });
    critlist_val_dict=JSON.parse(window.localStorage.getItem("critlist_val_dict")); 
    if (critlist_val_dict!=null){
    console.log("critlist_val_dict",critlist_val_dict["criteria_weights"])
    console.log("crit_list",crit_list)
    }
    else{
    critlist_val_dict={}
    }
    
   
    for (var c in crit_list){
        console.log("criteria_list",crit_list[c])
        var value=[5];
        if(critlist_val_dict==null){
            critlist_val_dict={}
        }
        if (critlist_val_dict!==undefined){
            // console.log("CHECK2",critlist_val_dict.criteria_weights)
            if (critlist_val_dict["criteria_weights"]!=undefined){
                value=[parseInt(critlist_val_dict["criteria_weights"][c][1])];
            }
        }
        
        var slider = new rSlider({

        target:crit_list[c] ,
        values: [1,2,3,4,5,6,7,8,9,10],
        widget:false,
        labels:[1,2,3,4,5,6,7,8,9,10],
        labels:true,
        set:value,
        tooltip:true,
        onChange: function (event) {
            // console.log("EVENT",event)
            // console.log("THIS",this.target)
            // if (critlist_val_dict[this.target]===undefined){
            //     critlist_val_dict[this.target]=[]
            // }
            // else{
            //     critlist_val_dict[this.target]=event;
            // }
            // console.log("critlist_val_dict",critlist_val_dict)
        }
        });

    }
   
 }) 

function SaveWeights(){
    var input_class=document.getElementsByClassName('slider')
    var temp_slider_id_val_check_list=[];
    var temp_final_list=[];
    for (var i=0;i<input_class.length;i++){
        
            temp_slider_id_val_check_list.push(input_class[i].id) 
            temp_slider_id_val_check_list.push(input_class[i].value)  
            temp_final_list.push(temp_slider_id_val_check_list);
            temp_slider_id_val_check_list=[];
    }
    criteria_weights=["criteria_weights"]
    if (critlist_val_dict==null){
        critlist_val_dict={}
    }
    critlist_val_dict[criteria_weights[0]]=temp_final_list
    console.log("critlist_val_dict",critlist_val_dict)
    $.ajax({
    type: 'POST',
    dataType: "json",
    'data': {
        'critlist_val_dict':JSON.stringify(critlist_val_dict),
        'csrfmiddlewaretoken': '{{ csrf_token }}',

    },
    // the ajax call is sent to subdetails url name in the post function.  
    url: "{% url 'criteria_weights' %}",
    success: function(data){
        alert()

    }
    
    });
}
function NextPage(){
    window.location="{%url 'comparemobile_1by1_direct'%}"
}

</script>

<script>
        // Warning before leaving the page (back button, or outgoinglink)
        window.onbeforeunload = function() {
            window.localStorage.setItem("critlist_val_dict",JSON.stringify( critlist_val_dict));
        }
</script>  
{%endblock%}