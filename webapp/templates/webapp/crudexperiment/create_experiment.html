{% extends "webapp/crudexperiment/base_experiment.html" %}
{% block content %}
{%load static from staticfiles%}
<div class="container-fluid text-center"> 
    <!-- MAIN ROW CONTENT DIV  -->
    <div class="row content">
        <!-- 1st SIDEBAR COL DIV -->
        <div class="col-sm-3 sidenav" style='background:rgb(74, 116, 89)'>
            <div class='container-fluid'>
              {% with template_sidebar=creat_exp_template_sidebar %}
              {% include template_sidebar %}
              {% endwith %}
            </div>
        </div>
        <div class="col-md-7 text-left" > 
             <!-- Order Criteria  -->
             <div class="row-fluid" id="order_criteria_div">

             </div>


            <!-- CREATE EXP ROW DIV  -->
            <div class ="row-fluid">     
                    <div class ="row">   
                        <div class='col-md-12' >
                          
                        <!-- <p1>Create Experiment </p1> Show Experiment Id here e.g. ses-007 (admin id) + experiment no. (5 digits) -->
                        </div>  
                    </div>
                    <div class ="row"> 
                        <div class='col-md-12' id='cr_exp_header' >    
                        <!-- <p1>Admin id {{admin_id}}</p1> -->
                        </div>                            
                    </div>
                    <div class ="row"> 
                        <div class='col-md-12' >
                        <!-- <p1>Experiment id {{experiment_id}}</p1> -->
                        </div>                            
                    </div>
            </div>
            <!-- CUSTOM NAV ROW DIV -->
            <div class='row-fluid'>
                <div class='row' id='custom_nav_div' >
                    <div class='col-md-3'><button id='ftlvl' class='custom_nav_btn active 'onclick='showFeatureLvls($(this))'>Feature Levels</button> </div>
                    <div class='col-md-3'><button id='btchmng' class='custom_nav_btn'onclick='showBatchManagement()'>Batch Management</button></div>
                    <div class='col-md-3'><button id='blkmng' class='custom_nav_btn' onclick='showBlockManagement()'>Block Management</button></div>
                    <div class='col-md-3'><button id='create_exp_mobile_catalog' class='custom_nav_btn' onclick='mobileCatalog()'>Mobile catalog</button></div>
                </div>    
            </div>
            <br>
            <!--FEATURES LEVELS ROW DIV -->
            <div class='row-fluid' id='feat_lvl_div'>
                <div class='row'>
                    <div class='col-md-3'>
                            <p1><b>Select features to enable:</b></p1>
                    {% for feature in platformfeatobj%}
                        <div class='row-fluid'>
                            <div class='col-md-12'>
                                <input type="checkbox"  id='{{feature.id}}' action='{%url "createexp"%}'
                                        method="post" 
                                        value="{{feature.feature_symbol}}" 
                                        onclick="outerCheckBox($(this).attr('value'),$(this).attr('id'))">
                                        {{feature.feature_name}} 
                                        <div  id='{{feature.id}}-innercheckboxdiv' class='innerchecksboxdivs' title='{{feature.feature_symbol}}'>
                                        </div>
                                </input>
                                <br>
                            </div>
                        </div>
                        {%endfor%}
                    
                        <div class='row-fluid'>
                            <button id="sendfeatlvl_btn" onclick='sendFeatureLevels()'> Set Feature Levels </button>
                        </div> 
                    </div>
                    <div class=col-md-3   >
                        <div id='defaultfeatLevel_tablediv'>
                            
                        </div>
                    </div>
                    <div class='col-md-5'  >
                        <div class='row'>
                            <div class='col-md-12'>
                            </div>
                        </div>
                        <div class='row'>
                            <div class='col-md-12'>
                                <div class='table-responsive' id='generated_blocks'></div>
                            </div>    
                        </div>
                       

                    </div>
                    
                    <div class='col-md-1' >
                      
                       
                             <button id="nextbtn_to_batch" onclick='showImportSubdiv()'>NEXT</button>

                            
                    
                    </div>
                </div>
            </div>  
            <br>
           
            <!-- IMPORT SUBJECT DIV ROW DIV-->
            <div class='row-fluid' id='importSubdiv'> 
                    <div class='row'>
                        <div class='col-md-1'>
                            <div class='row-fluid'></div>
                        </div>
                        <div class='col-md-5'>
                            <!-- Import Subjects Div -->
                            <div class='row-fluid'>
                                    <div class='row'>
                                        <div class='col-md-12'>
                                        <label>Import Subjects</label>
                                        </div>
                                    </div>
                                <br>
                             
                                    <div class='row'>
                                            <div class='col-md-2'>
                                                <label>Import CSV File</label>
                                            </div>
                                            <div class='col-md-5'>
                                                <input type="file"  id="fileUpload" onclick="chooseFileFunc()"/>
                                            </div>
                                            <div class='col-md-5'>
                                                <input type="button" id="upload" value="Upload" /> 
                                            </div>
                                
                                    </div>
                                <br>
                                    <div class='row'>
                                        <div class='col-md-2'>
                                            <label>Import Excel File</label>
                                        </div>
                                        <div class='col-md-5'>
                                                <input type="file"  id="excelFile" />
                                        </div>
                                        <div class='col-md-5'>
                                                <input type="button" id="excelFileUpload" value="Upload" /> 
                                        </div>

                                       
                                       
                                    </div>
                                </div>
                            <hr />
                            <!--SET COLUMN LABELS SELECTORS-->
                            <div class='row'>
                                    <div class='col-md-12'  >
                                            <div class='row'>
                                                    <div class='col-md-6' ><div class='map_select_label' id='custom_label_id'>Custom id</div> </div>
                                                    <div class='col-md-6'> <div class="show_select_tag" id="show_s1"></div></div>
                                            </div>
                                    </div>
                                    <div class='col-md-12' >
                                            <div class='row'>
                                                    <div class='col-md-6' > <div class='map_select_label' id='email_label_id'>Email</div></div>
                                                    <div class='col-md-6'> <div class="show_select_tag" id="show_s2"></div></div>
                                            </div>
                                    </div>
                                    <div class='col-md-12' >
                                            <div class='row'>
                                                    <div class='col-md-6' > <div class='map_select_label' id='batchT_label_id'>Batch Title</div></div>
                                                    <div class='col-md-6'> <div class="show_select_tag" id="show_s3"></div></div>
                                            </div>
                                    </div>
                            </div>
                            <!-- Proceed Btn Div -->
                            <div class='row'>
                                    <div class='col-md-12' >
                                        <div class='col-md-6' > </div>
                                        <!-- postExpData -->
                                        <div class='col-md-6'> <div id='proceedbtndiv'></div></div>
                                    </div>
                            </div>
                        
                            <!-- Self Defined DIV -->
                            <div class='row-fluid' >
                                        <!-- Ask USER FOR SELF DEFAULT OR CUSTOM -->
                                        <div class='row-fluid'>
                                                <div id='self_permission_text_div'></div>
                                        </div>
                                        <div class='row-fluid'>
                                               <div class='row'>
                                                   <div class='col-md-6' >
                                                       <div id='self_button_yes_div'></div>
                                                   </div>
                                                   <div class='col-md-6'>
                                                        <div id='self_button_no_div'></div>
                                                   </div>
                                               </div>
                                        </div>
                                        <!-- Self Button Display -->
                                        <div class='row-fluid' >
                                               
                                                <div class='col-md-12' id='selfbuttondiv'>
                                                
                                                </div>
                                        </div>
                                        
                                        <!-- Self defined Input Fields -->
                                        <div class='row-fluid' >
                                            <div class='col-md-12'  id='self-defined'>
                                                    <hr/>
                                                    <div class='row'>
                                                        <div class='col-md-6'><div class='self-defined-inputs' id='batchtitle_name'></div></div>
                                                        <div class='col-md-6'><div class='self-defined-inputs'  id='batchtitle_input'></div></div>

                                                    </div>
                                                    <div class='row'>
                                                        <div class='col-md-6' ><div class='self-defined-inputs'  id='batchnum_name'></div></div>
                                                        <div class='col-md-6' ><div class='self-defined-inputs'  id='batchnum_input'></div></div>
                                                    </div>
                                                    <div class='row'>
                                                        <div class='col-md-6'><div class='self-defined-inputs'  id='batchlabel_name'></div></div>
                                                        <div class='col-md-6'><div class='self-defined-inputs'  id='batchlabel_input'></div></div>
                                                    </div>
                                                    <div class='row'>
                                                        <div class='col-md-6' ></div>
                                                        <div class='col-md-6' id='self-assignbuttondiv'></div>
                                                    </div>

                                            </div>
                                        </div>
                            </div>
                            <!-- PreDefined Div-->
                            <div class='row-fluid'>
                                    <div class='row-fluid' >
                                        <div class='col-md-12' id='predefbuttondiv'>
                                            
                                        </div>
                                    </div>

                                    <div class='row-fluid' >

                                        <div class='col-md-12' id='pre-defined'> 
                                            <hr/>
                                            <div class='row'>
                                                    <div class='col-md-6'><div id='custom_label_id1'></div></div>
                                                    <div class='col-md-6'><div id='custom_tag_id1'></div></div>
                                            </div>
                                            <div class='row'>
                                                    <div class='col-md-6'><div id='email_label_id1'></div></div>
                                                    <div class='col-md-6'><div id='email_tag_id1'></div></div>
                                            </div>
                                            <div class='row'>
                                                    <div class='col-md-6'><div id='batchT_label_id1'></div></div>
                                                    <div class='col-md-6'><div id='batchT_tag_id1'></div></div>
                                            </div>
                                            <!-- <div class='row'>
                                                    <div class='col-md-12' id="pre-batchtitletext"></div>
                                            </div>
                                            <div class='row'>
                                                <div class='col-md-12' id="pre-RadioDiv"></div>
                                            </div>-->
                                            <div class='row'>
                                                    <div class='col-md-6' ></div>
                                                    <div class='col-md-6' id="pre-assignbuttondiv"></div>
                                            </div> 
                                        </div> 
                                
                                    </div>
                            </div>
                        </div>
                      
                        <div class='col-md-6'>
                            <div class='row-fluid'>
                                <div class='col-md-12'>
                                            <div>Batch Summary</div>
                                </div>
                            </div>
                            <div class='row-fluid'>
                                <div class='col-md-12'>  
                                        <div class='batchsize_div'></div>
                                </div>
                            </div>
                            <br>  
                            
                        </div>      
                    </div> 
                    <!-- Row Ending -->
                    <br>   
            </div>
            <!--Hiding Feature level  -->
            <!-- <div class='row-fluid' id='dispFileFeatLvldiv' style='background:aqua'>
                    <div class='col-md-1'></div>
                    
                   
                     <div class='col-md-5'> 
                             <div class='row-fluid'>
                                     <div class='col-md-12'>
                                          <label> Feature Levels</label>
                                     </div>
                                 </div>
                                 <div class='row-fluid'>
                                     <div class='col-md-12'>

                                     </div>    
                                 </div>
                                 <div class='row-fluid'>
                                         <div class='col-md-12' >
                                             <div class='displayfeaturelevelTable'>

                                             </div>
                                         </div>
                                 </div>
                     </div>
                     <div class='col-md-1'></div>
            </div> -->
            <!--  -->
            <div class='row-fluid' id='dataDiv' style="background:lawngreen" >
                  
                            <div class='row-fluid'>
                                <div id='dataDiv-label'>  
                                    <label> Uploaded data from file. </label>
                                </div>
                              
                            </div>
                             <!--DATA & DETAILS EDITING DISPLAY SECTION-->
                            <div class='row-fluid' >
                                <div class='col-md-12'>
                                    <div id="showfiledatadiv">
                                     </div>
                                </div>
                            </div>
                    
            </div>
            <!--  -->
            <div class='row-fluid' id='subj_split_batch_rowdiv'>
                                    
                    <div class='col-md-12'>
                            <div class='row-fluid'>
                                <div id='subj_split_batch_rowdiv_batch_label'>
                                <label>Subject Split to Batches</label>
                                </div>
                            </div>
                            <div class='row-fluid'>
                                <div id='subj_split_batch_tabel' class=" table-bordered">
                                </div>
                            </div>
                    </div>

            </div>

             <!--BLOCK ASSIGNMENT ROW DIV-->
            <div class='row-fluid' id='block_assign_row_div' >
                    <div class='row'>
                        <div class="col-md-6" >
                                <br>
                                <br>
                                    <div class='row-fluid'>

                                        <p1><b><i>Assign subjects to latest set of feature blocks?</b></i></p1>
                                        <br>
                                        <br>
                                        <button style="background: #1f8c6e;box-shadow: 0 0 0.5px 0.5px #1f8c6e;border: none;" onclick='assignToBlocks()'> Assign to Blocks </button>
                                    </div>
                        </div>
                    </div>
            </div>
          
                <br>
            <!--MY OUTPUT DIV ROW DIV-->
            <div class='row-fluid' id='blkoutputsDiv' style='background:rgb(252, 227, 8)'>  
                      
                        <div class='row'>
                                <!-- <div class='col-md-6'>
                                    <div id='blocksListDiv'></div>
                                </div> -->
                                <div class='col-md-12'>
                                   
                                    <div id='blocksBreakUpDiv'></div>
                                    
                                </div>
                        </div>
            </div> 
            <!-- Previous Btn -->
            <div class='row-fluid' id='batchmngprvbtn_div'>
                    <div class='col-md-1'>
                        <div id='prev_btn_div'>
                        <button style="background: #105796;box-shadow: 0 0 0.5px 0.5px #105796;border: none;" onclick="showFeatLvlDiv()">Previous</button>
                        </div>
                    </div>
                    <div class='col-md-5'></div>
                    <div class='col-md-6'>
                        <div id='save_button_div'>
                                <button onclick="saveExperiment()">Save</button>
                        </div>
                    </div>
            </div>
           
            <div class="row-fluid" id="phones_main_button_div">
             
                    <div class="col-md-12 col-sm-12" id="phoneset_button_div">

                      <!-- <button onclick="FuncA()">A</button>
                      <button onclick="FuncB()">B</button> -->
                      <!-- <button onclick="NextStep($(this))">Next Step</button> -->
                    </div>
            </div>
        

            <div class='row-fluid'>
                    <div class='row'>
                            <div class='col-md-12'>
                                    
                                        <div id="phsetnum_div"></div>
                                        <div id="ordersetnum_div"></div>
                                        <div id="defualt_criteria_popup"></div>
                                        <div id="criteria_display_popup"></div>


                            </div>
                    </div>
            </div>
           
            <!-- Mobile Catalog Div -->
            <div class='row-fluid' id='mobile_catalog_div'>
                   
                     
                <div class='row'>
                        <div class='col-md-12'>
                                
                                <div class="latest-product-section" > 
                                        {%  for mob in mobilephones  %}
                    
                                        {% if forloop.counter0|divisibleby:3 %} 
                                        <div class="row text-center">
                                            {%  endif %}
                                            
                                                <div class="col-md-4 col-lg-4 col-xs-12 sm-margin-b-50 pull-left">
                                                        <div class="margin-b-20" >
                                                        <!-- <h4>Compare</h4> -->
                                                        <input type="checkbox" value={{mob.id}} id={{mob.id}} name={{mob.id}}-{{mob.Mobile_Name}}  onchange="toggleCheckbox(this)"> 
                                                        <img class="img-responsive" src="{% static mob.imagepath1 %}"  alt="Latest Products Image"  title=""/>
                                                        </div>
                                                        <a class="link btn btn-success" href="{% url 'mobileinfo' id=mob.id %}">
                                                            {% filter upper %}
                                                                Read More
                                                            {% endfilter %}
                                                        </a>
                                                    
                                                </div>
                                                        {%  if forloop.counter|divisibleby:3 or forloop.last %}
                                                            </div><!-- row closing --><hr>
                                                            {%  endif %}
                                                        {%  endfor %}
                                    
                                </div>                    
                        </div>
                </div>
                                <!-- Pagination row -->
                    
                <div class='row'>
                        <div class='col-md-12'>
                            
                                <!-- <div class="pagination" >
                                        <span class="step-links">
                                        
                                            {% if mobilephones.has_previous %}
                                                <a href="?page=1">&laquo; first</a>
                                                <a href="?page={{ mobilephones.previous_page_number }}">previous</a>
                                            {% endif %}
                                            
                                            <span class="current">
                                                Page {{ mobilephones.number }} of {{ mobilephones.paginator.num_pages }}.
                                            </span>
                                        
                                            {% if mobiles.has_next %}
                                                <a href="?page={{ mobilephones.next_page_number }}">next</a>
                                                <a href="?page={{ mobilephones.paginator.num_pages }}">last &raquo;</a>
                                            {% endif %}
                                        </span>
                                </div> -->
                        </div>
                </div>
            </div>
            
            <div class="turn-page" id="pager"></div>
        </div>
        <div class="col-sm-2 sidenav" style="background: rgb(148, 0, 14);">
            <div class='container-fluid'>
                {% with template_sidebar=creat_exp_template_sidebar2 %}
                {% include template_sidebar %}
                {% endwith %}
              </div>
        </div>   
    </div>
</div>
      <footer>
		
          <div class="container-fluid" style='margin-left:15px'>
                <ul id="pagination-demo" class="pagination-sm"></ul>
                <div id="page-content" class="page-content">Page 1</div>
            <p><a href="#" target="blank">Contact</a> | <a href="#" target="blank">LinkedIn1</a> | <a href="#" target="blank">Twitter</a> | <a href="#" target="blank">Google+</a></p>
          </div>
     </footer>	



<script>
var active_button=''


var global_phones_exp_phones=[]
//Global Variable
var dict = {};

var arr_feature_levels=[];
var globalfiledatalist=[];
var exp_id = '{{sess_expId}}';
var custom_exp_id='{{sess_custExpId}}';
var block_list = [];
// for csv file uploading. 
var global_rows=[];

// var header = document.getElementById("custom_nav_div");
var btns = document.getElementsByClassName("custom_nav_btn");

// variable to save outer and inner check box div info. for pre populating. 
var checkbox_id_dict={};
window.row_filedata=null;


//  runs when the page is loaded/called. 
$(document).ready(function () {       

    initializePage();

});
/* ** Hides all divs except feat_lvl_div.**
   ** checks exp_id, if it exsists then asks for working on it, else discards**
   ** if it exsists and working on it is confirmed. **
      *** Loads all dictionaries that will be used to populate the ui such as feature levels dict, blocklist dict etc. *** 
*/
function initializePage(){
// This Will hide all the divs with class=innercheckboxdivs
$("#order_criteria_div").hide();
$('.innerchecksboxdivs').hide();
$('.map_select_label').hide();
$('.show_select_tag').hide();
$('#self-defined').hide();
$('#pre-defined').hide();
$('#selfbuttondiv').hide();
$('#blkoutputsDiv').hide();

$('#prebuttondiv').hide();
$('#upload').prop('disabled',true);
$('#importSubdiv').hide();
$('#dispFileFeatLvldiv').hide();
$('#subj_split_batch_rowdiv').hide();
$('#block_assign_row_div').hide();
$('#brand_check_div').hide();

//$('#blkoutputsDiv').hide();
$('#batchmngprvbtn_div').hide();
$('#dataDiv').hide();
$('#price_slider').hide();
$('#phones_main_button_div').hide();
$("#exp_sel_phones_div").hide();
$("#searchfilter_head_div").hide();

$('#feat_lvl_div').show();

// Exp id is null//
if(exp_id===""){
    /*
        *test to see if session exp empty
        *if not, then alert that session exists
        *if ok, load the experiment details as were
        *else, set sess_expId to None
    */
    /*
        * By default hide mobile catalog div...
    */
    $("#create_exp_mobile_catalog").css('background-color','black');
    $("#create_exp_mobile_catalog").css('color','black');
    $("#create_exp_mobile_catalog").css('cursor','not-allowed');
    $("#create_exp_mobile_catalog").attr("disabled", true); 

} else {

    let contin = confirm("Continue working on Experiment: "+custom_exp_id+"?");
     if(contin===false){

        //  alert("TO BE IMPLEMENTED AS AJAX CALL")
        alert ("Discarding everything. ")
        
         localStorage.removeItem("blockList");
         localStorage.removeItem("checkbox_id_dict");
         localStorage.removeItem("feat_dict");
        //  $('#feat_lvl_div').hide();
         exp_id="";
        //  ajax call to remove pickle data
         $.ajax({
                type: 'POST',
                dataType: "json",
                'data': {

                'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
        // the ajax call is sent to subdetails url name in the post function.  
                url: "{% url 'remove_session_obj' %}",
                success: function(data){
                        alert('Deleted')
                    }
                }); 


     }
     else{
         
        showExpWIP();
        // TO BE IMPLEMENTED
        // Check through an ajax call if anything related to dict,blocklist etc
        // is stored in the database if data is not null then save the 
        // retrieved data into dict,checkbox_id_dict
        //else try to get data from local storage... 
        
        //* Fetching feature_level dictionary containing feature symbol as key and its sub levels as values.*
        dict=JSON.parse(window.localStorage.getItem("feat_dict")); 
        //* Dictionary of checkboxes already checked by the user along with sub checklevels as values ( for history of checkboxes  checked )*
        checkbox_id_dict=JSON.parse(window.localStorage.getItem("checkbox_id_dict")); 
        //* block list contains the combinations of feature levels that will be used for display as a table*
        var blockList = JSON.parse(window.localStorage.getItem("blockList")); 

        console.log("Feature_levels_dict",dict)
        console.log("checkbox_id_dict",checkbox_id_dict)
        //* Population of block list table with block list. 
        if ( blockList===null){
                alert('block list empty');
            }
        else{
            table_blocks=draw_block_table(blockList)
            display_blocktable(table_blocks);
        }
        //* Population of feature level table with feature levels . 

        if (dict==null ){
            dict={}
        }
        else {
            displayfeaturelevelTable();
        }
        /* Filling outer checkboxes when the page is loaded.  
        ** First Check if checbox_id_dict is empty if not then run following, else do nothing. 
        ** Runs a SEPERATE OUTERCHECKBOX function that generates checkboxes exactly like the original one, but doesnt store data in dict.
        ** Which will run a seperate showinnerbox function to populate the innerchecboxes. 
        */
      
        if (checkbox_id_dict==null){
            checkbox_id_dict={};
        }

        else{
            /* Strong implementation which will create Outer checkboxes and tick the ones already selected */
             showcheckboxes_stored();
        }

        // Showing saved subject data. 
        // send an ajax call and get the expCont.subjData of the current Exp Object. 
        getSavedSubjectDataExpCont();
        
        }
    }
}
/* Strong implementation which will create Outer checkboxes and tick the ones already selected */
/*  As checkbox_id_dict is global here we will simply use it. 
    ** It gets the keys one by one, which is basically the ids of checkboxes and set their check prop to true. 
    ** OuterCheckBox_Store is then called, passing the value (e.g P.1,P.2) and key (e.g 6) to it. 
*/
function showcheckboxes_stored(){
    p_flag=false;
    for (var key in checkbox_id_dict){
            console.log('cheCKebox value',checkbox_id_dict[key]);
            console.log('key',key);
            var outercheckbox = document.getElementById(key);
            if (key==="7"){
            /*
                // IN FUTURE
                // Create a show and edit button. 
                // show button fuctionality will be to only show the display the CO.
                // Edit button will reopen the CO page with the same number of sets that were set previously and the user can not edit it. 
            // */
                var crit_order=JSON.parse(window.localStorage.getItem("crit_order_dict"));
                var crit_hide=JSON.parse(window.localStorage.getItem("crit_hide_dict")); 
                crit_order_dict=crit_order
                crit_hide_dict=crit_hide;
            }
            if (key==="6"){
                p_flag=true;
                
                var slider_dict=JSON.parse(window.localStorage.getItem("slider_set_dict")); 
                var brand_dict=JSON.parse(window.localStorage.getItem("brand_set_dict")); 
                var phone_dict=JSON.parse(window.localStorage.getItem("phoneset_dic")); 
                var pname_dic=JSON.parse(window.localStorage.getItem("phonename_dic")); 
                slider_set_dict=slider_dict;
                brand_set_dict=brand_dict;
                phoneset_dic=phone_dict;
                phonename_dic=pname_dic;
                setlist=[];
                for (var i in phoneset_dic){
                    setlist.push(i)
                }
                console.log('slider_dict',slider_dict);
                console.log('brand_dict',brand_dict);
                console.log('phone_dict',phone_dict);
                console.log('pname_dic',pname_dic);

            }
           
            outercheckbox.checked = true; 
            outerCheckBox_Stored( outercheckbox.getAttribute('value') ,key )
        }
        // disabling Mobile Catalog button if p is not ticked!.
        if (p_flag===false) {
        $("#create_exp_mobile_catalog").css('background-color','black');
        $("#create_exp_mobile_catalog").css('color','black');
        $("#create_exp_mobile_catalog").css('cursor','not-allowed');

        $("#create_exp_mobile_catalog").attr("disabled", true); 
        }

}

function outerCheckBox_Stored(outercheckval,outercheckid) {

/* Ajax call is made to send the outercheckboxid to the controller/server. 
    // The controller will fetch the sub-details of that feature from model and return back in success function. 
    // Success funtion will first check if the outercheckbox is checked or unchecked. 
    // If unchecked it'll simply hide the innercheckboxdiv or do nothing as by default its hidden.
    // else will populate data in that div and show to user.
*/  
$.ajax({
type: 'POST',
dataType: "json",
'data': {
'd': JSON.stringify(outercheckval),
'csrfmiddlewaretoken': '{{ csrf_token }}',
},
// the ajax call is sent to subdetails url name in the post function.  
url: "{% url 'subdetails' %}",
success: function(data){
console.log("success");
var outerckbox = $('#'+outercheckid);
console.log('outercheckbox obj',outerckbox);
        // For this Function IF CONDITION SHOULD ALWAYS BE TRUE... 
        if (outerckbox.is(':checked')) {
            // alert('You Checked');
            console.log('outercheckval',outercheckval);
            console.log('data retrieved',data)
            
            //checkbox_id_dict[outercheckid]=[];
            showInnerCheckBoxDivs_Stored(outercheckid,data);
            // updateFeatureLvls();
        } 
        else {
            // alert('You Un-Checked it');
            // For now its purpose is simply to hide the innercheckdivs.  
            hideInnerCheckBoxDivs(outercheckid);
            // console.log(outercheckval);
            // dict[outercheckval]=null;
            // if (dict[outercheckval]==null  ){
            //     delete dict[outercheckval];
            //     console.log('in else condition');  
            // }
            // console.log(dict)
            // updateFeatureLvls();
        }
}
}); 
}


function showInnerCheckBoxDivs_Stored(outercheckid,data){
        console.log('#'+outercheckid+'-innercheckboxdiv')
        // Creating inner checks and populating them with data. 
        console.log(checkbox_id_dict)
        var k=checkbox_id_dict;
        var innercheckbox_id_list=[];
        var value_found=''
        /* Phone set and Criteria Ordering are the Anamolies
            ** For both of them different checks but same functionality. **
            ** Fetching the innerCheckBox Div it will first clear it.**
            ** FOR NOW, Getting the data from dict while the others from subdetails/-> Data. **
            ** Load the Data Present in feature level dict in it. **
            ** And simply display the div. **

         */
        
        if (outercheckid==="6"){

            console.log(dict);
            $('#6-innercheckboxdiv').empty();
            var row_div=document.createElement("div");
            row_div.setAttribute("class",'row');
            var col_md_6_div=document.createElement("div");
            col_md_6_div.setAttribute("class","col-md-12");
            row_div.append(col_md_6_div);
            col_md_6_div.append(dict['P'])
            var col_md_6_div_2=document.createElement("div");
            col_md_6_div_2.setAttribute("class","col-md-12");
            row_div.append(col_md_6_div_2);
            var edit_href=document.createElement("a");
            edit_href.setAttribute("onclick","mobileCatalog()");
            edit_href.setAttribute("class","edit_href")

            edit_href.innerHTML="Edit";
            col_md_6_div_2.append(edit_href)
        
            $('#'+outercheckid+'-innercheckboxdiv').append(row_div);
            $('#'+outercheckid+'-innercheckboxdiv').show();



        }
        else if (outercheckid==="7"){
            $('#'+outercheckid+'-innercheckboxdiv').empty();
            $('#'+outercheckid+'-innercheckboxdiv').show();

            var row_div=document.createElement("div");
            row_div.setAttribute("class",'row');
            var innercheckboxdiv=document.getElementById('7-innercheckboxdiv')
            innercheckboxdiv.append(row_div);
            var col_md_6_div=document.createElement("div");
            col_md_6_div.setAttribute("class","col-md-12");
            row_div.append(col_md_6_div);
            col_md_6_div.append(dict["CO"])
            var col_md_6_div_2=document.createElement("div");
            col_md_6_div_2.setAttribute("class","col-md-12");
            row_div.append(col_md_6_div_2);
            var view_href=document.createElement("a");
            view_href.setAttribute("onclick","criteriaDispPopup()");
            view_href.setAttribute("class","view_href")

            view_href.innerHTML="View";
            col_md_6_div_2.append(view_href);
            
           
            $('#'+outercheckid+'-innercheckboxdiv').show();
           
        }
        /* For all others */
        else{
            for (var o in data){
                    console.log('A',o);    
                    var innercheck_element =  $(document.createElement("input")).attr({
                            id: o +'-innercheckbox-'+outercheckid,
                            name:  '',
                            value: data[o],
                            text :'',
                            type:  'checkbox',
                            checked:true,
                            onclick:"innerCheckBox($(this).attr('value'),$(this).attr('id'),\
                            $(this).parent().attr('title'), $(this).parent().attr('id')\
                            )"
                            })
                    var inner_id=innercheck_element.attr('id')
                    console.log('inner_id',inner_id)
                    console.log('outercheckid',outercheckid);
                    console.log('INNERCHECK FUNC CHECKBOX DICT',k);
                    console.log('array',k[outercheckid])

                    var stored_innercheckbox_id_list=k[outercheckid]
                    console.log('stored_innercheckbox_id_list',stored_innercheckbox_id_list);
                    delete stored_innercheckbox_id_list[value_found];
                    console.log(stored_innercheckbox_id_list)
                    if (jQuery.isEmptyObject(stored_innercheckbox_id_list)){
                    
                        innercheck_element.prop('checked',false)
                    }
                    else {
                            for (var value_id in stored_innercheckbox_id_list){
                                
                                console.log("stored_innercheckbox_id_list[value_id]",stored_innercheckbox_id_list[value_id]);
                                console.log ('inner_id',inner_id)
                                        if (stored_innercheckbox_id_list[value_id]===inner_id)
                                        {    console.log('in if cond')
                                            innercheckbox_id_list.push(inner_id)

                                            value_found=value_id
                                            console.log("stored_innercheckbox_id_list",stored_innercheckbox_id_list);
                                            
                                            break;
                                        }
                                        else{
                                            console.log('in else cond')
                                            innercheck_element.prop('checked',false)

                                        }
                            }
                    }
                    // adding input attributes to a div
                    $('#'+outercheckid+'-innercheckboxdiv').append(innercheck_element);
                    $('#'+outercheckid+'-innercheckboxdiv').append(data[o]);
                    $('#'+outercheckid+'-innercheckboxdiv').show();
                }
            
            }

            checkbox_id_dict[outercheckid]=innercheckbox_id_list;
            console.log('DICTionary',dict);

            console.log('All innercheck boxid added to checkbox dict',checkbox_id_dict);
}


/* 
   *Function that hides the divs containing innercheckbox*
   *No Func for phoneset and CO, and might not need it.*

*/
function hideInnerCheckBoxDivs(outercheckid){
    delete checkbox_id_dict[outercheckid];
    var get_chkbx_id_dict=JSON.parse(window.localStorage.getItem("checkbox_id_dict")); 
    var get_chkbx_id_dict=checkbox_id_dict;
    var set_chkbx_id_dict=get_chkbx_id_dict;
    window.localStorage.setItem("checkbox_id_dict", JSON.stringify(set_chkbx_id_dict));

    console.log("checkbox_id_dict",checkbox_id_dict);
$('#'+outercheckid+'-innercheckboxdiv').hide();
$('#'+outercheckid+'-innercheckboxdiv').empty();

}


function getSavedSubjectDataExpCont(){
    $.ajax({
        type: 'POST',
        dataType: "json",
        'data': {

            'csrfmiddlewaretoken': '{{ csrf_token }}',
        },
        // the ajax call is sent to subdetails url name in the post function.  
        url: "{% url 'get_saved_subject_data_expcont' %}",
        success: function(data){
        console.log("data['subject_data']",data['subject_data'])
        
        // console.log('keys',Object.keys(data['subject_data'])[0])
        // console.log(Object.keys(data['subject_data'][Object.keys(data['subject_data'])[0]]).length);
        //  for (var i=0;i<Object.keys(data['subject_data'][Object.keys(data['subject_data'])[0]]).length;i++){

        //  }
         }
                     
    }); 
}


function defaultFeatLevel_Table(){
    var defaultdic={};
    defaultdic['I']=['I.1'];
    defaultdic['R']=['R.1'];
    defaultdic['W']=['W.direct'];
    defaultdic['A']=['A.all','A.user']
    defaultdic['C']=['C.full']
    var table=document.createElement('TABLE');
    table.setAttribute('class','table table-striped table-bordered')
    var thead=document.createElement('THEAD');
    table.appendChild(thead);
    var tbody=document.createElement('TBODY');
    table.appendChild(tbody);
    var trh=document.createElement('TR');
    var th=document.createElement('TH')
    thead.appendChild(trh)
    th.append('Feature Symbol')
    trh.appendChild(th)
    var th=document.createElement('TH')
    th.append('Feature Levels')
    trh.appendChild(th)
    if (defaultdic==='{}'){
        console.log('empty table');
    }
    else{
        for (var row in defaultdic){
      
        var tr=document.createElement('TR');
        tbody.appendChild(tr)
        var td=document.createElement('TD')
        td.append(row)
        tr.appendChild(td)
        var td=document.createElement('TD')
        td.append(defaultdic[row])
        tr.appendChild(td)
        }
    }
    
    console.log(table)
    $(table).appendTo('#defaultfeatLevel_tablediv');
    //dict=default_dic;
}

 $(function () {
    $("#excelFileUpload").bind("click", function () {
    var fileUpload = $("#excelFile")[0];

   
 //Validate whether File is valid Excel file.
 console.log('k',fileUpload);
 var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.xls|.xlsx)$/;
 if (regex.test(fileUpload.value.toLowerCase())) {
     if (typeof (FileReader) != "undefined") {
         var reader = new FileReader();

         //For Browsers other than IE.
         if (reader.readAsBinaryString) {
             reader.onload = function (e) {
                 
                 ProcessExcel(e.target.result);
             };
             reader.readAsBinaryString(fileUpload.files[0]);
         } else {
             //For IE Browser.
             reader.onload = function (e) {
                 var data = "";
                 var bytes = new Uint8Array(e.target.result);
                 for (var i = 0; i < bytes.byteLength; i++) {
                     data += String.fromCharCode(bytes[i]);
                 }
                 ProcessExcel(data);
             };
             reader.readAsArrayBuffer(fileUpload.files[0]);
         }
     } else {
         alert("This browser does not support HTML5.");
     }
 } else {
     alert("Please upload a valid Excel file.");
 }
    });
});
function ProcessExcel(data) {
        //Read the Excel File data.
        var workbook = XLSX.read(data, {
            type: 'binary'
        });
 
        //Fetch the name of First Sheet.
        var firstSheet = workbook.SheetNames[0];
 
        //Read all rows from First Sheet into an JSON array.
        //  var excelRows = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[firstSheet]);
        var excelRows = XLSX.utils.sheet_to_csv(workbook.Sheets[firstSheet]);
        excelRows=excelRows.split("\n");
        var filedatalist=[]

        for (var row in excelRows){
                        if (excelRows[row]==''){
                            console.log("excelRows[row]",excelRows[row])
                            excelRows.splice(row, 1)
                        }else{
                        filedatalist.push(excelRows[row]);
                        }
                    }
       global_rows=excelRows
       console.log('excel rows',excelRows)
       setFileDataList(filedatalist);
             
       showFileDataTable(excelRows)
       console.log('header',excelRows[0]);
       header=excelRows[0];
       header=header.split(',');
       console.log('header',header[0]);
       console.log('header',typeof(header));
       $('#excelFileUpload').prop('value', 'Uploaded');
                        
       $('#excelFileUpload').prop('disabled',true);
       var select_tag1 = $('<select id="s1"/>');
                        $('<option />', {value: "", text:"None"}).appendTo(select_tag1);
                        for(var col in header) {

                            $('<option />', {value: col, text: header[col]}).appendTo(select_tag1);
                        }
                        //DEFAULT FOR TESTING
                        select_tag1.val('0');
                        var select_tag2 = $('<select id="s2" />');
                        $('<option />', {value: "", text:"None"}).appendTo(select_tag2);
                        for(var col in header) {
                            $('<option />', {value: col, text: header[col]}).appendTo(select_tag2);
                        }
                        var select_tag3 = $('<select id="s3" onchange="onS3Select(this)"/>');
                        $('<option />', {value: "", text:"None"}).appendTo(select_tag3);
                        for(var col in header) {
                            $('<option />', {value: col, text: header[col]}).appendTo(select_tag3);
                        }
                        //DEFAULT FOR TESTING
                        select_tag3.val('1');
                        $('#show_s1').append(select_tag1);
                        $('#show_s2').append(select_tag2);
                        $('#show_s3').append(select_tag3);
                        var proceedbtn= document.createElement("BUTTON");
                        proceedbtn.setAttribute("style","background: #1f8c6e;box-shadow: 0 0 0.5px 0.5px #1f8c6e;border: none;")
                        var proceedStr="Process Import"
                        var text = document.createTextNode(proceedStr);
                        proceedText = proceedbtn.appendChild(text)
                        proceedbtn.onclick = function() {postExpData()};
                       // proceedbtn.classList.add("");

                        $('#proceedbtndiv').append(proceedbtn)
                        $('.map_select_label').show();
                        $('.show_select_tag').show();
        //Add the data rows from Excel file.

        // $.ajax({
        // type: 'POST',
        // dataType: "json",
        // 'data': {
        //     'excel_data':JSON.stringify(excelRows),
        //     'csrfmiddlewaretoken': '{{ csrf_token }}',
        // },
        // // the ajax call is sent to subdetails url name in the post function.  
        // url: "{% url 'import_excel' %}",
        // success: function(data){
        //   console.log("DATA");
        //   console.log(data);
        // }
                     
    // }); 
 
       
};


// Don't know it is used or not
// Code for changing the background colour of the custom_nav_bt
for (var i = 0; i < btns.length; i++) {
      btns[i].addEventListener("click", function() {
    var current = document.getElementsByClassName("active");
    current[0].className = current[0].className.replace(" active", "");
    this.className += " active";
    console.log('classname',this.className);
  });
}


// Uploading file Function . 
function showImportSubdiv(){
    // setting current active btn.
    // var current=$('#ftlvl')
    var current=$(".active");
    current.prop('class',current.attr('class').replace('active',""));
    $('#btchmng').prop('class', 'custom_nav_btn active');

    
    $('#feat_lvl_div').hide();
    $('#mobile_catalog_div').hide();
    $("#price_slider_div").hide(); 
    $('#brand_check_div').hide();
    $("#phones_main_button_div").hide(); 

    $('#importSubdiv').show(1000);
    $('#batchmngprvbtn_div').show();


}
function showFeatLvlDiv(){
    $('#order_criteria_div').hide();
    $('#importSubdiv').hide();
    $('#block_assign_row_div').hide();
    $('#dataDiv').hide();
    $('#batchmngprvbtn_div').hide();
    $('#dataDiv').hide();
    $('#expphonelist_div').hide();
    $("#price_slider_div").hide(); 
    $('#brand_check_div').hide();

    $("#phones_main_button_div").hide(); 

    $('#mobile_catalog_div').hide();
   
    $('#feat_lvl_div').show( 1000);

    // var current=$('#btchmng')
    var current=$(".active");
    current.prop('class',current.attr('class').replace('active',""));
    $('#ftlvl').prop('class', 'custom_nav_btn active');
}

function displayfeaturelevelTable(){
    $('#dispFileFeatLvldiv').show();
    makeFeatureLvldicTable();

}
function makeFeatureLvldicTable(){
    var table=document.createElement('TABLE');
    table.setAttribute('class','table table-striped table-bordered')
    var thead=document.createElement('THEAD');
    table.appendChild(thead);
    var tbody=document.createElement('TBODY');
    table.appendChild(tbody);
    var trh=document.createElement('TR');
    var th=document.createElement('TH')
    thead.appendChild(trh)
    th.append('Feature Symbol')
    trh.appendChild(th)
    var th=document.createElement('TH')
    th.append('Feature Levels')
    trh.appendChild(th)
    if (dict==='{}'){
        console.log('emoty table');
    }
    else{
        for (var row in dict){
      
        var tr=document.createElement('TR');
        tbody.appendChild(tr)
        var td=document.createElement('TD')
        td.append(row)
      
        tr.appendChild(td)
        var td=document.createElement('TD')
        
        td.append(dict[row])
        tr.appendChild(td)
         }
    }
    
    console.log(table)
    $(table).appendTo("#displayfeaturelevelTablediv");
    $(table).appendTo(".displayfeaturelevelTable");
    window.localStorage.setItem("dispfeatlevels", JSON.stringify(dict));
}
function updateFeatureLvls(){
    window.localStorage.setItem("dispfeatlevels", JSON.stringify(dict));
    $('.displayfeaturelevelTable').empty();
    displayfeaturelevelTable();
}
function showFeatureLvls(){
    $('#importSubdiv').hide();
    $('#block_assign_row_div').hide();
    $('#dataDiv').hide();
    $('#batchmngprvbtn_div').hide();
    $('#dataDiv').hide();
    $('#mobile_catalog_div').hide();
    
    $('#phones_main_button_div').hide();
    $('#expphonelist_div').hide();
    $('#price_slider_div').hide();
    $('#brand_check_div').hide();
    $("#exp_sel_phones_div").hide();
    $("#searchfilter_head_div").hide();
    $('#blkoutputsDiv').hide();
    $('#order_criteria_div').hide();


    $('#feat_lvl_div').slideDown(500);
    



    $('#dispFileFeatLvldiv').show();
    

}
function showBatchManagement(){
    $("#exp_sel_phones_div").hide();
    $("#searchfilter_head_div").hide();
    $('#feat_lvl_div').hide();
    $('#block_assign_row_div').hide();
    $('#mobile_catalog_div').hide();
    $("#price_slider_div").hide(); 
    $('#brand_check_div').hide();

    $("#phones_main_button_div").hide(); 
    $('#importSubdiv').slideDown();

    $('#batchmngprvbtn_div').show();
    $('#dispFileFeatLvldiv').show();
    $('#blkoutputsDiv').hide();

  


   
}
function HideALL(){
    $('#block_assign_row_div').hide();
    $('#feat_lvl_div').hide();
    $('#dispFileFeatLvldiv').hide();
    $('#subj_split_batch_rowdiv').hide();
    $('#importSubdiv').hide();
    $('#dataDiv').hide();
    $('#batchmngprvbtn_div').hide();
    $('#mobile_catalog_div').hide();
    $("#price_slider_div").hide(); 
    $('#brand_check_div').hide();

    $("#phones_main_button_div").hide(); 
    $('#blkoutputsDiv').hide();
    $('.innerchecksboxdivs').hide();
    $('.map_select_label').hide();
    $('.show_select_tag').hide();
    $('#self-defined').hide();
    $('#pre-defined').hide();
    $('#selfbuttondiv').hide();
    $('#blkoutputsDiv').hide();
    $('#prebuttondiv').hide();
    $('#upload').prop('disabled',true);
    $('#importSubdiv').hide();
    $("#exp_sel_phones_div").hide();
    $("#searchfilter_head_div").hide();



    // var current=$(".active");
    // current.prop('class',current.attr('class').replace('active',""));
}
function showBlockManagement(){
    // hiding all unneccesary rows
    $('#importSubdiv').hide();
    $('#feat_lvl_div').hide();
    $('#dispFileFeatLvldiv').hide();
    $('#subj_split_batch_rowdiv').hide();
    $('#dataDiv').hide();
    $('#batchmngprvbtn_div').hide();
    $('#blkoutputsDiv').hide();

    $('#mobile_catalog_div').hide();
    $("#price_slider_div").hide(); 
    $('#brand_check_div').hide();

    $("#phones_main_button_div").hide(); 
    $('#block_assign_row_div').show();
    // $('#blkoutputsDiv').show();
}
function showExpWIP(){
    $('#cr_exp_header').html("<p1>CREATE EXPERIMENT</p1>");
    $('#cr_exp_header').append("<p>"+custom_exp_id+" is UNDER CONSTRUCITON</p>");
}
function saveExperiment(){
    // Getting all data from local storage and sending to server
    alert (' Getting all data from local storage and sending to server')
    var dict_temp=JSON.parse(window.localStorage.getItem("feat_dict")); 
    var checkbox_id_dict_temp=JSON.parse(window.localStorage.getItem("checkbox_id_dict")); 
    var blockList_temp = JSON.parse(window.localStorage.getItem("blockList")); 
    if (dict_temp===null){
        dict_temp={}
    }
    if (checkbox_id_dict_temp===null){
        checkbox_id_dict_temp={}
    }
    if (blockList_temp===null){
        blockList_temp={}
    }
    ftDict_chkbxDict_blkLst={}
    ftDict_chkbxDict_blkLst['feat_dict']=dict_temp;
    ftDict_chkbxDict_blkLst['checbox_id_dict']=checkbox_id_dict_temp;
    ftDict_chkbxDict_blkLst['blockList_temp']=blockList_temp;
    $.ajax({
                type: 'POST',
                dataType: "json",
                'data': {
                'ftDict_chkbxDict_blkLst':JSON.stringify(ftDict_chkbxDict_blkLst),
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
    // the ajax call is sent to subdetails url name in the post function.  
                url: "{% url 'saveexperiment' %}",
                success: function(data){
                       alert(data['status']);
                       alert("on success remove every thing from local storage.\
                             ask for redirection to create_exp page.\
                             if yes then\
                             redirect otherwise do nothing.")
                       // on success remove every thing from local storage. 
                       // ask for redirection to create_exp page. if yes then 
                       // redirect otherwise do nothing. 

                    }
                }); 

}
$(function () {
    $("#upload").bind("click", function () {
        var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.csv)$/;
        if (regex.test($("#fileUpload").val().toLowerCase())) {
            if (typeof (FileReader) != "undefined") {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                    console.log(e);
                   
                    var table = $("<table  id='showfiledataTable'/>");
                    var rows = e.target.result.split("\n");
                    global_rows=rows;
                    console.log(global_rows);
                    var filedatalist=[]
                    /// check filedata for empty rows 
                    for (var row in rows){
                        if (rows[row]==''){
                            console.log("rows[row]",rows[row])
                            rows.splice(row, 1)
                        }else{
                        filedatalist.push(rows[row]);
                        }
                    }
                    console.log('filedatalist',filedatalist);

                    setFileDataList(filedatalist);
                    console.log('rows>>',rows);
                    console.log('rows type',typeof(rows));
                    showFileDataTable(rows);

                
                    
                    console.log('header',rows[0]);
                    header=rows[0];
                    header=header.split(',');
                    console.log('header',header[0]);
                    console.log('header',typeof(header));
                    // var table=document.createElement('TABLE');
                    // table.setAttribute('id','showfiledataTable')
                    // table.setAttribute('class',"display table table-striped table-bordered ")    
                    // var thead=document.createElement('THEAD')
                    // table.appendChild(thead)
                    // var tbdoy=document.createElement('TBODY');
                    // table.appendChild(tbdoy);
                   
                    // for (var rowindex in rows){
                    //  if (rowindex==0){
                    //     var trh=document.createElement('TR');
                    //     thead.appendChild(trh);
                    //     console.log(rows[rowindex])
                    //     var rowcols=rows[rowindex].split(',')
                    //     for (var j=0;j<rowcols.length;j++){
                    //         var th=document.createElement('TH');
                    //         th.append(rowcols[j])
                    //         trh.appendChild(th)
                            
                    //         }
                    //  }
                    //  else{
                    //     var tr=document.createElement('TR');
                    //     tbdoy.appendChild(tr);
                     
                    //     console.log(rows[rowindex])
                    //     var rowcols=rows[rowindex].split(',')
                    //     for (var j=0;j<rowcols.length;j++){
                    //         var td=document.createElement('TD');
                    //         td.append(rowcols[j])
                    //         tr.appendChild(td)
                            
                    //         }
                    //  } 
                    // }
                    // console.log(table)
                    //  $(table).appendTo("#showfiledatadiv");
                    //  $('#showfiledataTable').DataTable({
                           
                    //         "bLengthChange": false,
                    //         "bFilter": false,
                    //         "pageLength": 5,
                    //         "pagingType": "full_numbers"
                    //         });
                    //         $('#dataDiv').show();
                        // Disable the upload button when pressed. 
                        $('#upload').prop('value', 'Uploaded');
                        
                        $('#upload').prop('disabled',true);
                        var select_tag1 = $('<select id="s1"/>');
                        $('<option />', {value: "", text:"None"}).appendTo(select_tag1);
                        for(var col in header) {

                            $('<option />', {value: col, text: header[col]}).appendTo(select_tag1);
                        }
                        //DEFAULT FOR TESTING
                        select_tag1.val('0');
                        var select_tag2 = $('<select id="s2" />');
                        $('<option />', {value: "", text:"None"}).appendTo(select_tag2);
                        for(var col in header) {
                            $('<option />', {value: col, text: header[col]}).appendTo(select_tag2);
                        }
                        var select_tag3 = $('<select id="s3" onchange="onS3Select(this)"/>');
                        $('<option />', {value: "", text:"None"}).appendTo(select_tag3);
                        for(var col in header) {
                            $('<option />', {value: col, text: header[col]}).appendTo(select_tag3);
                        }
                        //DEFAULT FOR TESTING
                        select_tag3.val('1');
                        $('#show_s1').append(select_tag1);
                        $('#show_s2').append(select_tag2);
                        $('#show_s3').append(select_tag3);
                        var proceedbtn= document.createElement("BUTTON");
                        proceedbtn.setAttribute("style","background: #1f8c6e;box-shadow: 0 0 0.5px 0.5px #1f8c6e;border: none;")
                        var proceedStr="Process Import"
                        var text = document.createTextNode(proceedStr);
                        proceedText = proceedbtn.appendChild(text)
                        proceedbtn.onclick = function() {postExpData()};
                       // proceedbtn.classList.add("");

                        $('#proceedbtndiv').append(proceedbtn)
                        $('.map_select_label').show();
                        $('.show_select_tag').show();
                       //$('.show_select_tag').html('');
                       //$('.show_select_tag').append(select_tag);

                }
                
                // reader.readAsBinaryString($("#fileUpload")[0].files[0]);
                reader.readAsText($("#fileUpload")[0].files[0]);

            }
             else {
                alert("This browser does not support HTML5.");
            }
        } 
        else {
            alert("Please upload a valid CSV file.");
        }
    });
});    
function  showFileDataTable(rows){
                    
                    var table=document.createElement('TABLE');
                    table.setAttribute('id','showfiledataTable')
                    table.setAttribute('class',"display table table-striped table-bordered ")    
                    var thead=document.createElement('THEAD')
                    table.appendChild(thead)
                    var tbdoy=document.createElement('TBODY');
                    table.appendChild(tbdoy);
                   
                    for (var rowindex in rows){
                        if (rowindex==0){
                            var trh=document.createElement('TR');
                            thead.appendChild(trh);
                            console.log(rows[rowindex])
                            var rowcols=rows[rowindex].split(',')
                                for (var j=0;j<rowcols.length;j++){

                                    var th=document.createElement('TH');
                                    // th.setAttribute('class','success')
                                    th.append(rowcols[j])
                                    trh.appendChild(th)
                                    
                                }
                        }
                        else{
                            var tr=document.createElement('TR');
                            tbdoy.appendChild(tr);
                        
                            console.log(rows[rowindex])
                            var rowcols=rows[rowindex].split(',')
                                    for (var j=0;j<rowcols.length;j++){
                                        var td=document.createElement('TD');
                                        td.append(rowcols[j])
                                        tr.appendChild(td)
                                        
                                    }
                        } 
                    }
                    console.log(table)
                    $("#showfiledatadiv").html('');
                    $(table).appendTo("#showfiledatadiv");
                    $('#showfiledataTable').DataTable({
                            "bLengthChange": false,
                            "bFilter": false,
                            "pageLength": 5,
                            "pagingType": "full_numbers"
                            });
                    $('#dataDiv').show();

        }

function showBatchSummaryDiv(){
    $('.batchsize_div').show();
}
function hideBatchSummaryDiv(){
    $('.batchsize_div').hide();
}
function emptySelfBatchTable(){
    $('#self_batch_size_summary').empty();
}
function emptyPreBatchTable(){
    $('#pre_batch_size_summary').empty();

}
function emptyOneBatchTable(){
    $('#one_batch_summery_table').empty();

}

function onS3Select(select) {
     //alert(select.options[select.selectedIndex].text);
     if (select.options[select.selectedIndex].text==='None'){
        $('#selfbtnid').prop('disabled',false);
        emptySelfBatchTable();
        emptyPreBatchTable();
        emptyOneBatchTable();

     }
     else{
        $('#selfbtnid').prop('disabled',true);

        $('#selfbuttondiv').empty();
        $('#self-defined').hide( 1000 );
        $('#batchtitle_name').empty();
        $('#batchtitle_input').empty();
        $('#batchnum_name').empty();
        $('#batchnum_input').empty();
        $('#batchlabel_name').empty();
        $('#batchlabel_input').empty();
        $('#self-assignbuttondiv').empty();
        $('#self_permission_text_div').empty();
        $('#self_button_yes_div').empty();
        $('#self_button_no_div').empty();
        // hideBatchSummaryDiv();
        emptySelfBatchTable();
        emptyPreBatchTable();
        emptyOneBatchTable();
        $('#subj_split_batch_tabel').empty();
        
        $('#subj_split_batch_rowdiv').hide();
        refreshFileDataList();
     }
}
function assignToBlocks(){
    $('#blocksBreakUpDiv').html(
        "<font color=red><b><i>Please wait while the assignment is being processed</i></b></font>")
    $.ajax({
        type: 'POST',
        dataType: "json",
        'data': {

            'csrfmiddlewaretoken': '{{ csrf_token }}',
        },
        // the ajax call is sent to subdetails url name in the post function.  
        url: "{% url 'assign_blocks' %}",
        success: function(data){
            
            console.log("<<---RECEIVED ASSIGN TO BLOCK POST RETURN--->>");
            console.log(data)
            // for(var i in data){
            //     console.log("data:",i,data[i]);
            // }
            var blocks=JSON.parse(data['blocks']);
            var block_table_extended=document.getElementById('blocks_table');

            var block_table_extended_thead=block_table_extended.tHead;
            var block_table_extended_thead_row=block_table_extended_thead.rows[0];
            console.log('head row',block_table_extended_thead_row);
            // block_table_extended_thead.appendChild(th);
            // th.append('A');
            console.log(block_table_extended.tHead.innerHTML);
            console.log(block_table_extended.tBodies[0].rows.length)
            var block_table_extended_tbody=block_table_extended.tBodies[0];
            var   block_table_extended_tbody_row_length=  block_table_extended.tBodies[0].rows.length;
            
            const keys = Object.keys(blocks)
            console.log(keys);
            console.log("block_table_extended_tbody_row_length",block_table_extended_tbody_row_length);
            if (block_table_extended.tBodies[0].rows[block_table_extended.tBodies[0].rows.length-1].cells[1].innerHTML!="Batch Totals"){
             var col_list=[]; 
             for (var i=0;i<block_table_extended_tbody_row_length;i++)
             {
                 console.log('i',block_table_extended.tBodies[0].rows[i].innerHTML);
                 var tr=block_table_extended.tBodies[0].rows[i];
                 console.log(i);
                 console.log(keys[i])
                 key=keys[i];
                 for (var  j in blocks[key]){
                                if (col_list.includes(j)) {
                                console.log('Do  nothing')
                                }
                                else{
                                col_list.push(j);
                                var th_cell=block_table_extended_thead_row.insertCell(-1);
                                th_cell.innerHTML=j;

                                }
                    var td_cell= tr.insertCell(-1);
                    td_cell.innerHTML=blocks[key][j]
                    console.log(blocks[key][j]);
                 }

            }

            console.log('block_table_extended',block_table_extended.tBodies[0].rows[block_table_extended.tBodies[0].rows.length-1].cells[1].innerHTML);
           
                    var newRow   = block_table_extended_tbody.insertRow(block_table_extended_tbody_row_length);
                    var newCell  = newRow.insertCell(0);
                    newCell.innerHTML='';
                    var newCell  = newRow.insertCell(1);
                    newCell.innerHTML='Batch Totals';
                    for (var cells in blocks['Total']){
                        var newCell  = newRow.insertCell(-1);
                        newCell.innerHTML= blocks['Total'][cells];
                    }
                    // $('#blocks_table').DataTable({"pageLength": 5 });
                    // $('#blocks_table').appendTo('#blocksBreakUpDiv')
                    $('#blocksBreakUpDiv').append('#blocks_table');
                    // $("#block_assign_row_div").hide();
                    if(data['blocks']!=="Empty"){
                        alert('Blocks Created in Feature LEVELS')
                        
                    } else {
                        alert('PLEASE IMPORT SUBJECTS FIRST')
                    }
            }
            showFeatureLvls();
            var bllmng=document.getElementById('blkmng');
            var ftlvl=document.getElementById('ftlvl');

            bllmng.setAttribute("class","custom_nav_btn")
            ftlvl.setAttribute("class","custom_nav_btn active")
            console.log("block_table_extended_tbody_row_length", block_table_extended.tBodies[0].rows.length);

            
        }
                     
    }); 
}
var proceedbtncount=0
function showSelfBarButton(){
        var selfbutton= document.createElement("BUTTON");
        var text = document.createTextNode("Self Defined ");
        selfbutton.appendChild(text);
        selfbutton.onclick = function() {switchVisible($('#self-defined'),header)};
        selfbutton.classList.add("barbutton");
        selfbutton.id='selfbtnid';
        $('#selfbuttondiv').append(selfbutton).slideDown(1000).fadeIn(1000);
}
function hideSelfBarButton(){
        $('#selfbtnid').prop('disabled',true);
        $('#selfbuttondiv').empty();
        $('#self-defined').hide( 1000 );
        $('#batchtitle_name').empty();
        $('#batchtitle_input').empty();
        $('#batchnum_name').empty();
        $('#batchnum_input').empty();
        $('#batchlabel_name').empty();
        $('#batchlabel_input').empty();
        $('#self-assignbuttondiv').empty();
        $('#subj_split_batch_rowdiv').hide();
        $('#subj_split_batch_tabel').empty();
        $('.batchsize_div').empty();
        $('#showfiledataTable').empty();
        showFileDataTable(global_rows);
        emptyOneBatchTable();
        emptyPreBatchTable();
        emptySelfBatchTable();
        var filedt=getFileDataList();
        console.log('filedata');
        console.log(filedt);
        $.ajax({
                    type: 'POST',
                    dataType: "json",
                    'data': {
                    'csvfiledata': JSON.stringify(filedt),
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    // the ajax call is sent to subdetails url name in the post function.  
                    url: "{% url 'selfdefault' %}",
                    success: function(data){
                        console.log('success')
                        console.log(data);
                        var one_batch_summery_table=document.createElement('TABLE');
                        one_batch_summery_table.setAttribute('class','table table-bordered');
                        one_batch_summery_table.setAttribute('id','one_batch_summery_table');
                        var t_head=document.createElement('THEAD');
                        var t_body=document.createElement('TBODY');

                        one_batch_summery_table.appendChild(t_head);
                        one_batch_summery_table.appendChild(t_body);
                        var trh=document.createElement('TR')
                        t_head.appendChild(trh);
                        var th=document.createElement('TH');
                        trh.appendChild(th);
                        th.append('BATCH');
                        var th=document.createElement('TH');
                        trh.appendChild(th);
                        th.append('Size');
                        var total=0;
                        for ( var row in data){
                            console.log(row);
                            console.log(data[row]);
                            var tr=document.createElement('TR');
                            t_body.appendChild(tr);
                            var td=document.createElement('TD');
                            tr.appendChild(td);
                            td.append(row);
                            var td=document.createElement('TD');
                            tr.appendChild(td);
                            td.append(data[row]);
                            var num=parseInt(data[row])
                           total=total+num;
                        }
                        var tr=document.createElement('TR');
                        t_body.appendChild(tr);
                        var td=document.createElement('TD');
                        td.append('Total');
                        tr.appendChild(td);
                        var td=document.createElement('TD');
                        td.append(total);
                        tr.appendChild(td);
                        $(one_batch_summery_table).appendTo('.batchsize_div')    
                       
                       }
                     
                    }); 

}
function postExpData(){
    
    var custom_id=$('#s1').children('option:selected').text();
    var email=$('#s2').children('option:selected').text() ;
    var batch_field=$('#s3').children('option:selected').text();
   
    if (batch_field=='None'){
        emptyOneBatchTable();
        emptyPreBatchTable();
        emptySelfBatchTable();
        $('.batchsize_div').empty();
        $('#self_permission_text_div').empty();
        $('#self_button_yes_div').empty();
        $('#self_button_no_div').empty();
        $('#showfiledatadiv').empty();

        showFileDataTable(global_rows);
        // '<b>Would you like to create new batches now?</b><br><i>(if not, then by default the subjects will be considered as \"Batch 1\")</i>
        var self_permission_text_div=document.createElement('Label');
        self_permission_text_div.append('Would you like to create new batches now?(if not, then by default the subjects will be considered as Batch 1)')
        $('#self_permission_text_div').append(self_permission_text_div);
        var self_button_yes=document.createElement('BUTTON');
        self_button_yes.setAttribute('id','self_button_yes');
        self_button_yes.setAttribute('onclick','showSelfBarButton()');
        var yestext = document.createTextNode("YES ");
        self_button_yes.appendChild(yestext);
        $('#self_button_yes_div').append(self_button_yes);

        var self_button_no=document.createElement('BUTTON');
        self_button_no.setAttribute('id','self_button_no');
        self_button_no.setAttribute('onclick','hideSelfBarButton()');
        var notext = document.createTextNode("NO");
        self_button_no.appendChild(notext);
        $('#self_button_no_div').append(self_button_no);
        $('#self_button_no_div').append("<br/>");

   }
    else{
        // Divs to be removed when button pressed. 
        emptyOneBatchTable();
        emptyPreBatchTable();
        emptySelfBatchTable();
        $('.batchsize_div').empty();
        $('#showfiledatadiv').empty();
        

        // refreshFileDataList();

        
        var filedat=getFileDataList();
        
        console.log('before setting filedata',filedat);
        // if (proceedbtncount!==0){
        //     filedat.pop();
        //     filedat.pop();
        //     filedat.pop();
        // }
        filedat.push(custom_id);
        filedat.push(email);
        filedat.push(batch_field); 
        showFileDataTable(global_rows);
        console.log('afer setting filedata',filedat);
        // proceedbtncount++;
        refreshFileDataList();
        $.ajax({
                        type: 'POST',
                        dataType: "json",
                        'data': {
                        'csvfiledata': JSON.stringify(filedat),
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        },
                        // the ajax call is sent to subdetails url name in the post function.  
                        // HAVE TO REMOVE IT LATER   
                        // >>url: "{% url 'postexp' %}",
                        url: "{% url 'import_subjects' %}",
                        success: function(data){
                            console.log("<<---SUBJECT IMPORT POST WAS GREAT!--->>");
                            console.log("<<---SUBJECT IMPORT DATA",data)
                            for(var i in data){
                                console.log("data:",i,data[i]);
                            }
                            if(exp_id===""){
                                exp_id=data['exp_id'];
                                custom_exp_id=data['custom_exp_id'];
                                showExpWIP();
                            }
                        if(data['batches']!==""){ 
                                groups=data['batches']; 
                        
                                var batch_size_table=document.createElement('TABLE'); 
                                batch_size_table.setAttribute('id','pre_batch_size_summary')
                                batch_size_table.setAttribute('class','table table-striped table-bordered ') 
                                var b_thead=document.createElement('THEAD');
                                batch_size_table.appendChild(b_thead);
                                var b_tbdoy=document.createElement('TBODY');
                                batch_size_table.appendChild(b_tbdoy);
                                var trh=document.createElement('TR');
                                b_thead.appendChild(trh);
                                var th=document.createElement('TH');
                                trh.appendChild(th);
                                th.append('Batch');
                                var th=document.createElement('TH');
                                th.append('Batch Size');
                                trh.appendChild(th);
                                var total=0;

                                for (var rowindex in groups){
                                    var tr=document.createElement('TR');
                                    b_tbdoy.appendChild(tr);
                                    var td=document.createElement('TD');
                                    console.log('rowindex',rowindex);
                                    td.append(rowindex);
                                    tr.appendChild(td);
                                    var td=document.createElement('TD')
                                    console.log('groups[rowindex]',groups[rowindex])
                                    td.append(groups[rowindex]);
                                    tr.appendChild(td);
                                    var num=parseInt(groups[rowindex])
                                    total=total+num;
                                }
                                    var tr=document.createElement('TR');
                                    b_tbdoy.appendChild(tr);
                                    var td=document.createElement('TD');
                                    td.append('Total');

                                    tr.appendChild(td);
                                    var td=document.createElement('TD');
                                    td.append(total);
                                    tr.appendChild(td);
                                console.log(batch_size_table);
                                $(batch_size_table).appendTo('.batchsize_div') 
                                showBatchSummaryDiv();
                                // hiding uploaded data from user.
                                if(exp_id===""){
                                exp_id=data['exp_id'];
                                custom_exp_id=data['custom_exp_id'];
                                showExpWIP();
                            }
                            // console.log(JSON.parse(data[1]))
                            // dataframe_table=JSON.parse(data[1])
                            // var mydata = dataframe_table;
                            // var table = makeTable(mydata,"mytable");
                            // transposeTable(table)
                            
                            // $(table).appendTo("#subj_split_batch");
                            // $('#mytable').DataTable({
                            
                            //     "bLengthChange": false,
                            //     "bFilter": false,
                            //     "pageLength": 5
                            //     });
                            // // hiding the csv file data.
                            // $('#dataDiv').hide();
                            // $('#subj_split_batch_rowdiv').show(); 
                            

                        } 
                        
                            
                        }
                        
                        }); 
        }
}
function batchNumFunc(obj){
        console.log(obj.val())
        var bat_num=parseInt(obj.val());
        console.log(bat_num)
        console.log(typeof(bat_num))
        var labels=[]
        console.log(bat_num.len+1)
        console.log(bat_num.length+1)
        for (var i=1;i<bat_num+1;i++){
             i=i.toString()
             console.log(i)
             labels.push(i)
           
        }
        $('#selfbatchlabelid').val(labels);
}
// Switch Function to show and hide self and pre defined divs. 
function switchVisible(obj,header) {
    if (obj) {
        console.log("swvob",obj);
        console.log('header',header)
        console.log('id',obj.is("#self-defined") )
        if (obj.attr("id") === "self-defined" &&  obj.is(":hidden")) {
            console.log("in if");
            
            var batchtitlename=$('<label>Batch Name:</label>');
            var batchtitleinput = $('<input class="crtinput" type="text" name="batchtitle" value="Batch"  id="selfbatchtitleid">');
            var batchnumname=$('<label>Num of Batches:</label>');
            var batchnuminput = $('<input type="text" class="crtinput" name="batchnum" value="2"   id="selfbatchnumid" onkeyup="batchNumFunc($(this))" >');
            var batchlabelname=$('<label>Label Batches:</label>');
            var batchlabelinput = $('<input type="text" class="crtinput" name="batchlabel"  id="selfbatchlabelid" >');
            var selfassignbutton= $('<button id="selfassignbutton"onclick=selfAssignBatch()>Make Batch</button>') ;
            
            $('#batchtitle_name').append(batchtitlename);
            $('#batchtitle_input').append(batchtitleinput);
            $('#batchnum_name').append(batchnumname);
            $('#batchnum_input').append(batchnuminput);
            $('#batchlabel_name').append(batchlabelname);
            $('#batchlabel_input').append(batchlabelinput);
            $('[name=batchlabel]').val('1,2');
            $('#self-assignbuttondiv').append(selfassignbutton);

            

        
            $('#self-defined').toggle(1000);

           // document.getElementById('self-defined').style.display = 'block';
            $('#pre-defined').hide( 1000 );
            $('#pre-batchtitletext').empty();
            $('#pre-RadioDiv').empty();
            $('#pre-assignbuttondiv').empty();

            
            //document.getElementById('pre-defined').style.display = 'none';
        }
        else if (obj.attr("id") === "self-defined" &&  obj.is(":visible")){
            $('#self-defined').hide( 1000 );
            $('#batchtitle_name').empty();
            $('#batchtitle_input').empty();
            $('#batchnum_name').empty();
            $('#batchnum_input').empty();
            $('#batchlabel_name').empty();
            $('#batchlabel_input').empty();
            $('#self-assignbuttondiv').empty();
        }
        else if (obj.attr("id") === "pre-defined" &&  obj.is(":hidden")) {
            
        //    // $('[name=batchlabel]').remove();
        //    $('#self-defined').hide( 1000 );
        //     $('#batchtitle_name').empty();
        //     $('#batchtitle_input').empty();
        //     $('#batchnum_name').empty();
        //     $('#batchnum_input').empty();
        //     $('#batchlabel_name').empty();
        //     $('#batchlabel_input').empty();
        //     $('#self-assignbuttondiv').empty();


        //    // In future delete this block of code. @TODO
        // //    var batchtitle=$('<p>Select one of the Fields for Batch Assigning</p>');
        // //    $('pre-batchtitletext').append(batchtitle);
        // //    for (var i = 0; i < header.length; i++) {
        // //             var radioBtn = $('<input type="radio" name="'+header[i]+'" value="'+header[i]+'"\
        // //             onclick="radioBtnFunc($(this))"\
        // //             >'+header[i]+'</input>');
        // //             //radioBtn.appendTo('#RadioDiv');

        // //             $("#pre-RadioDiv").append(radioBtn);

        // //         }
        //     var sel1T=$('#s1').children('option:selected').text();
        //     var sel2T=$('#s2').children('option:selected').text();
        //     var sel3T=$('#s3').children('option:selected').text();
        //     $('#custom_label_id1').append('Customid');
        //     $('#custom_label_id1').append('-->');
        //     $('#custom_tag_id1').append(sel1T);
        //     $('#email_label_id1').append('Email');
        //     $('#email_label_id1').append('-->');
        //     $('#email_tag_id1').append(sel2T);
        //     $('#batchT_label_id1').append('Batch Title');
        //     $('#batchT_label_id1').append('-->');
        //     $('#batchT_tag_id1').append(sel3T);
            
        //     var assignbutton= $('<button onclick=preAssignBatch('+JSON.stringify(sel1T)+','+JSON.stringify(sel2T)+','+JSON.stringify(sel3T)+')>Make Batch</button>') ;
        //     assignbutton.fadeIn(300);
        //     $('#pre-assignbuttondiv' ).append(assignbutton) ;
        //     $('#pre-defined').show(1000);
        //    // document.getElementById('pre-defined').style.display = 'block';
             }   
    }
}
//  
function selfAssignBatch(){
    // $('.batchsize_div').empty();
    // if (globalbatchtable!=null){
    //     $('#subj_split_batch').empty();
    //     (globalbatchtable).destroy();
        
    // }
    emptyOneBatchTable();
    emptyPreBatchTable();
    emptySelfBatchTable();
    $('.batchsize_div').empty();
    $("#subj_split_batch_tabel").empty();
    if ($('#mytable').text().length == 0){
        console.log('inif;')
    }else{ $('#mytable').destroy();}
   

    var filedata=getFileDataList();
    // filedata.pop();
    // filedata.pop();
    // filedata.pop();
    var custom_id=$('#s1').children('option:selected').text();
    var email=$('#s2').children('option:selected').text() ;
    var batch_field=$('#s3').children('option:selected').text();
    console.log('filedata',filedata);
    var fieldname=$('#selfbatchtitleid').val();
    console.log('fieldname',fieldname);
    var fieldnum=$('#selfbatchnumid').val();
    console.log('fieldnum',fieldnum);
    var fieldlabel=$('#selfbatchlabelid').val();
    console.log('fieldlabel',fieldlabel);
    console.log(typeof(fieldlabel));
    var assigntype='self';
    filedata.push(custom_id);
    filedata.push(email);
    filedata.push(batch_field);

    
    
    filedata.push(fieldname);
    filedata.push(fieldnum);
    filedata.push(fieldlabel);


    filedata.push(assigntype);
    console.log('fileDATA',filedata);
    refreshFileDataList();
    $.ajax({
                    type: 'POST',
                    dataType: "json",
                    'data': {
                    'csvfiledata': JSON.stringify(filedata),
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    // the ajax call is sent to subdetails url name in the post function.  
                    url: "{% url 'uploadsamplefile' %}",
                    success: function(data){
                        if(exp_id===""){
                            exp_id=data['exp_id'];
                            custom_exp_id=data['custom_exp_id'];
                            showExpWIP();
                        }
                        console.log(JSON.parse(data[1]))
                        dataframe_table=JSON.parse(data[1])
                        var mydata = dataframe_table;
                        var table = makeTable(mydata,"mytable");
                        transposeTable(table)
                        
                        $(table).appendTo("#subj_split_batch_tabel");
                        $('#mytable').DataTable({
                           
                            "bLengthChange": false,
                            // "bFilter": false,
                            "pageLength": 5
                            });
                        // hiding the csv file data.
                        $('#dataDiv').hide();
                        $('#subj_split_batch_rowdiv').show();

                        groups=JSON.parse(data['batches']); 
                       
                        var batch_size_table=document.createElement('TABLE'); 
                        batch_size_table.setAttribute('id','self_batch_size_summary')
                        batch_size_table.setAttribute('class','table table-striped table-bordered ') 
                        var b_thead=document.createElement('THEAD');
                        batch_size_table.appendChild(b_thead);
                        var b_tbdoy=document.createElement('TBODY');
                        batch_size_table.appendChild(b_tbdoy);
                        var trh=document.createElement('TR');
                        b_thead.appendChild(trh);
                        var th=document.createElement('TH');
                        trh.appendChild(th);
                        th.append('Index');
                        var th=document.createElement('TH');
                        th.append('Batch Size');
                        trh.appendChild(th);
                        var total=0;
                        for (var rowindex in groups){
                            var tr=document.createElement('TR');
                            b_tbdoy.appendChild(tr);
                            var td=document.createElement('TD');
                            console.log('rowindex',rowindex);
                            td.append(rowindex);
                            tr.appendChild(td);
                            var td=document.createElement('TD')
                            console.log('groups[rowindex]',groups[rowindex])
                            td.append(groups[rowindex]);
                            tr.appendChild(td);
                            var num=parseInt(groups[rowindex])
                            total=total+num;
                        }
                            var tr=document.createElement('TR');
                            b_tbdoy.appendChild(tr);
                            var td=document.createElement('TD');
                            td.append('Total');

                            tr.appendChild(td);
                            var td=document.createElement('TD');
                            td.append(total);
                            tr.appendChild(td);
                        console.log(batch_size_table);
                       $(batch_size_table).appendTo('.batchsize_div')    
                       }
                    }); 
    


}
//  
function radioBtnFunc(radiovalue){
        console.log('radiovalue',radiovalue.attr('value')) ;
        var radioinput_value=radiovalue.attr('value'); 
        var assignbutton= $('<button onclick=preAssignBatch('+JSON.stringify(radioinput_value)+')>Make Batch And assign to blocks</button>') ;
                         assignbutton.fadeIn(300);
                         $('#pre-assignbuttondiv' ).append(assignbutton) ;
    
}

function preAssignBatch(sel1T,sel2T,sel3T){
    var filedata=getFileDataList();
    console.log(filedata);
    // var fieldname=radioinput_value;
    // console.log("fieldname",fieldname);
    
    console.log(filedata);
    filedata.push(sel1T);
    filedata.push(sel2T);
    filedata.push(sel3T);
    filedata.push('pre');
    console.log(filedata);
    refreshFileDataList();
    $.ajax({
                    type: 'POST',
                    dataType: "json",
                    'data': {
                    'csvfiledata': JSON.stringify(filedata),
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    // the ajax call is sent to subdetails url name in the post function.  
                    url: "{% url 'uploadsamplefile' %}",
                    success: function(data){
                      
                       //create table
                        
                        //  for (var i in data){// 
                        //     // row 
                             
                        //      console.log(i); // key RollNO  Individual cells. 
                        //      // add all to the row.    
                        //      console.log(Object.values(data[i]).length);  // Value {0: 1239123}
                        //      for (var j in data[i] ){  
                        //          console.log(data[i][j]);
                        //      }
                        //  }
                        
                        var mydata = eval(data);
                        var table = makeTable(mydata);
                        transposeTable(table)
                        $(table).appendTo("#subj_split_batch_tabel");
                      
                
                       }
                     
                    }); 
    
}

function makeTable (mydata,tableid) {
    
    var table = $('<table  id='+tableid+' class="table table-bordred table-striped">');
    var colgroup= $('<colgroup>')
    var colg1=$('<col>')
    var colg2=$('<col>')
    var colg3=$('<col>')

    var colg4=$('<col style="background-color:yellow">')
    $(colg1).appendTo(colgroup);
    $(colg2).appendTo(colgroup);
    $(colg3).appendTo(colgroup);
    $(colg4).appendTo(colgroup);
    $(colgroup).appendTo(table);
    var thead = $('<thead>');

    var tblHeader = "<tr>";
        
    for (var k in mydata) tblHeader += "<th>" + k + "</th>";

    tblHeader += "</tr>";
    $(tblHeader).appendTo(thead);
    $(thead).appendTo(table)
    
    var tbody = $('<tbody>');
   

    $.each(mydata, function (index, value) {
        var TableRow = "<tr>";
                
        $.each(value, function (key, val) {
            TableRow += "<td>" + val + "</td>";
    
        });
        TableRow += "</tr>";
        $(TableRow).appendTo(tbody);
        // $(table).append(TableRow);
        

    });

    $(tbody).appendTo(table);
    return ($(table));
};

function transposeTable(table) {
        var $this = table.children('tbody');
        var newrows = [];
        $this.find("tr").each(function(){
            var i = 0;
            $(this).find("td").each(function(){
                i++;
                if(newrows[i] === undefined) { newrows[i] = $("<tr></tr>"); }
                newrows[i].append($(this));
            });
        });
        $this.find("tr").remove();
        $.each(newrows, function(){
            $this.append(this);
        });
  
}

function setFileDataList(filedatalist){
    globalfiledatalist=filedatalist
}
function emptyFileDataList(){
  globalfiledatalist=[];
}
function getFileDataList(){
    return globalfiledatalist;
   
}

function refreshFileDataList (){
var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.csv|.txt)$/;
var regex_xl = /^([a-zA-Z0-9\s_\\.\-:])+(.xls|.xlsx)$/;
var fileUpload = $("#excelFile")[0];
console.log("csv regex",regex.test($("#fileUpload").val().toLowerCase()))
console.log("xl regex",regex_xl.test(fileUpload.value.toLowerCase()))

// if (regex.test(fileUpload.value.toLowerCase())) {
if (regex.test($("#fileUpload").val().toLowerCase())) {
    
    if (typeof (FileReader) != "undefined") {
            var reader = new FileReader();
            reader.onload = function (e) {
          
            var rows = e.target.result.split("\n");
            var filedatalist=[];

                for (var i = 0; i < rows.length; i++) {
                    console.log(rows[i]);
                    filedatalist.push(rows[i]);
                }  
            setFileDataList(filedatalist); 
            window.row_filedata=rows;
            console.log('rows[0]',row_filedata[0])
        }

        reader.readAsText($("#fileUpload")[0].files[0]);
       
    }
     else {
        alert("This browser does not support HTML5.");
    }
} 
else if (regex_xl.test(fileUpload.value.toLowerCase())){
    if (typeof (FileReader) != "undefined") {
         var reader = new FileReader();
        reader.onload = function (e) {
                  //Read the Excel File data.
        var workbook = XLSX.read(e, {
            type: 'binary'
        });
 
        //Fetch the name of First Sheet.
        var firstSheet = workbook.SheetNames[0];
 
        //Read all rows from First Sheet into an JSON array.
        //  var excelRows = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[firstSheet]);
        var excelRows = XLSX.utils.sheet_to_csv(workbook.Sheets[firstSheet]);
        excelRows=excelRows.split("\n");
        var filedatalist=[]

        for (var row in excelRows){
                        if (excelRows[row]==''){
                            console.log("excelRows[row]",excelRows[row])
                            excelRows.splice(row, 1)
                        }else{
                        filedatalist.push(excelRows[row]);
                        }
                    }
      
        window.row_filedata=excelRows;            
       setFileDataList(filedatalist);
                 
            };
             reader.readAsBinaryString(fileUpload.files[0]);
         
     } else {
         alert("This browser does not support HTML5.");
     }
}
else {
    alert("Please upload a valid file.");
}

}
function hide_emptyAllDivs_ImportSubjects(){
    $('.map_select_label').hide();
    $('.show_select_tag').empty();
    $('#proceedbtndiv').empty();
    $('#self_permission_text_div').empty();
    $('#self_button_yes_div').empty();
    $('#self_button_no_div').empty();
    $('#selfbuttondiv').empty();
    $('#self-defined ').hide();
    $('#self-assignbuttondiv').empty();
    $('.self-defined-inputs').empty();
    hideBatchSummaryDiv();
    emptySelfBatchTable();
    emptyPreBatchTable();
    emptyOneBatchTable();
    // $('.batchsize_div').empty();
    $('#dataDiv').hide();
    // $('#dataDiv-label').hide();
    $('#subj_split_batch_rowdiv_batch_label').hide();
    $('#subj_split_batch_tabel').empty();
    $('#showfiledatadiv').empty();
}
function chooseFileFunc(){
  
  
  if ($('#fileUpload').val()===''){
      alert('val empty')
     $('#upload').prop('disabled',false);
  }
  else{
    $('#upload').prop('disabled',false);
    alert('val not empty')
    // Empty all possible divs that are displayed. 
    hide_emptyAllDivs_ImportSubjects();
    // send an ajax call that will delete the exsisting subjects from the database of that experiment. 
    // check
    $.ajax({
            type: 'POST',
            dataType: "json",
            'data': {
            'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            // the ajax call is sent to deleteallsubjects url name in the post function.  
            url: "{% url 'deleteallsubjects' %}",
            success: function(data){
            console.log("success");
            }
        }); 
    }
}
// Outercheckbox function 
// This function gets 2 arguments when called val and id attribute of input type=checkbox
// having id based on the feature.id.
// It is called through onclick function. 
var  setlist=[];
function outerCheckBox(outercheckval,outercheckid) {
console.log("checkbox");
console.log(outercheckval);
    // Ajax call is made to send the outercheckboxid to the controller. 
    // The controller will fetch the sub-details of that feature from model and return back in
    // in success function. 
    // Success funtion will first check if the outercheckbox is checked or unchecked. 
    // If unchecked it'll simply hide the innercheckboxdiv or do nothing as by default its hidden.
    // else will populate data in that div and show to user.  
    $.ajax({
    type: 'POST',
    dataType: "json",
    'data': {
    'd': JSON.stringify(outercheckval),
    'csrfmiddlewaretoken': '{{ csrf_token }}',
    },
    // the ajax call is sent to subdetails url name in the post function.  
    url: "{% url 'subdetails' %}",
    success: function(data){
    console.log("success");
    var outerckbox = $('#'+outercheckid);
    console.log('outercheckbox obj',outerckbox);
    console.log('dict',dict);
   

    // checking if the user has checked or not. 

if (outerckbox.is(':checked')) {
        // alert('You Checked');
        console.log('outercheckval',outercheckval);
        console.log('data retrieved',data);
    if (outercheckval==="P"){ 
                $('#phsetnum_div').empty();
                $('#phsetnum_div').dialog({ 
                title: "Phone Set",
                autoOpen: false,
                minHeight: 200,
                maxHeight: 300,
                
                draggable: true,
                resizable: true,
                closeOnEscape: true,
                close       : function () {
                    $("#6").prop('checked', false);
                    // $("#6").prop('checked', true);

                    // alert()
                },

                hide: { effect: "highlight", duration: 0},
                buttons: [
                            {
                                text:"cancel",
                                click: function() {
                                    $( this ).dialog( "close" );
                                    $("#6").prop('checked', false);
                                 
                                }

                            },
                            
                            {
                            text: "Save",
                            click: function() {
                            // alert('aa');
                               
                                $( this ).dialog( "close" );
                            // Enabling mobile Catalog button if p is not ticked!.

                                $("#create_exp_mobile_catalog").css('background-color','');
                                $("#create_exp_mobile_catalog").css('color','');
                                $("#create_exp_mobile_catalog").css('cursor','pointer');

                                $("#create_exp_mobile_catalog").attr("disabled", false); 

                                $("#6").prop('checked', true);
                                console.log("vale",$('#inputset_num').val())
                                numofsets=$('#inputset_num').val();
                                setlist=[]
                               
                               
                                for (var i=0;i<numofsets;i++){
                                    var j=i+1
                                    var str="P."+j;
                                    setlist.push(str);
                                }
                                console.log("SetList",setlist);
                                if (dict[outercheckval]===undefined){
                                    dict[outercheckval]=setlist;
                                }
                                $('#'+outercheckid+'-innercheckboxdiv').empty();
                                var row_div=document.createElement("div");
                                row_div.setAttribute("class",'row');
                                var col_md_6_div=document.createElement("div");
                                col_md_6_div.setAttribute("class","col-md-12 col-sm-12");
                                row_div.append(col_md_6_div);
                                col_md_6_div.append(dict[outercheckval])
                                var col_md_6_div_2=document.createElement("div");
                                col_md_6_div_2.setAttribute("class","col-md-12 col-sm-12");
                                row_div.append(col_md_6_div_2);
                                var edit_href=document.createElement("a");
                                edit_href.setAttribute("onclick","mobileCatalog()");
                                edit_href.setAttribute("class","edit_href")
                                edit_href.innerHTML="Edit";
                                col_md_6_div_2.append(edit_href);
                               
                                $('#'+outercheckid+'-innercheckboxdiv').append(row_div);
                                $('#'+outercheckid+'-innercheckboxdiv').show();
                                
                                


                                window.localStorage.setItem("feat_dict", JSON.stringify(dict));
                                checkbox_id_dict[outercheckid]=[];
                                window.localStorage.setItem("checkbox_id_dict", JSON.stringify(checkbox_id_dict));
   

                                updateFeatureLvls();


                                mobileCatalog();

                                var current=$(".active");
                                current.prop('class',current.attr('class').replace('active',""));
                                $('#create_exp_mobile_catalog').prop('class', 'custom_nav_btn active');

                            }

                            }
                          
                ]
                }); // Initialize dialog plugin
                $('#phsetnum_div').dialog("open");
                var row_div = document.createElement('div');
                row_div.setAttribute('class','row');
                $('#phsetnum_div').append(row_div);

                var row_d1=document.createElement('div');
                row_d1.setAttribute('class','row');
                row_div.append(row_d1);
                var col_md_12_div=document.createElement('DIV');
                col_md_12_div.setAttribute('class','col-md-12 col-sm-12');
                row_d1.append(col_md_12_div)
                var p_text=document.createElement('p');
                p_text.innerHTML="Number of sets"
                col_md_12_div.append(p_text)
                var row_d2=document.createElement('div');
                row_d2.setAttribute('class','row');
                row_div.append(row_d2);
                var col_md_12_div2=document.createElement('DIV');
                col_md_12_div2.setAttribute('class','col-md-12 col-sm-12');
                row_d2.append(col_md_12_div2)
                var input = document.createElement("INPUT");
                input.setAttribute("type", "number");
                input.id='inputset_num';
                col_md_12_div2.append(input);
    }

            
    else if(outercheckval==="CO"){
        var numofsets=0;
        $('order_criteria_div').empty();
        $('#ordersetnum_div').empty();
        $('#ordersetnum_div').dialog({ 
        title: "Order Criteria",
        autoOpen: false,
        minHeight: 200,
        maxHeight: 300,
        closeOnEscape: true,
        hide: { effect: "highlight", duration: 1000 },
        buttons: [
        {
        text: "Save",
        click: function() {
            $( this ).dialog( "close" );
            console.log("vale",$('#inputset_num_co').val())
            numofsets=$('#inputset_num_co').val();
            HideALL();
            var setlst=[];
            for (var i=0;i<numofsets;i++){
                var j=i+1
                var str="CO."+j;
                setlst.push(str);
            }
            console.log("SetList",setlst);
            dict[outercheckval]=setlst;
            orderCriteriaHtmlSetup(outercheckval,setlst);
            

            if (dict[outercheckval]===undefined){
                dict[outercheckval]=[];
            }
            $('#'+outercheckid+'-innercheckboxdiv').empty();
           
            var row_div=document.createElement("div");
            row_div.setAttribute("class",'row');
            var innercheckboxdiv=document.getElementById('7-innercheckboxdiv')
            innercheckboxdiv.append(row_div);
            

            var col_md_6_div=document.createElement("div");
            col_md_6_div.setAttribute("class","col-md-12");
            row_div.append(col_md_6_div);
            col_md_6_div.append(dict[outercheckval])

            var col_md_6_div_2=document.createElement("div");
            col_md_6_div_2.setAttribute("class","col-md-12");
            row_div.append(col_md_6_div_2);

            var view_href=document.createElement("a");
            view_href.setAttribute("onclick","criteriaDispPopup()");
            view_href.setAttribute("class","view_href")

            view_href.innerHTML="View";
            col_md_6_div_2.append(view_href);
            
            $('#'+outercheckid+'-innercheckboxdiv').show();


            window.localStorage.setItem("feat_dict", JSON.stringify(dict));
            checkbox_id_dict[7]=[];
            window.localStorage.setItem("checkbox_id_dict", JSON.stringify(checkbox_id_dict));
            
            updateFeatureLvls();
         
            
        }
    
        // Uncommenting the following line would hide the text,
        // resulting in the label being used as a tooltip
        //showText: false
        }
    ]
        }); // Initialize dialog plugin
        $('#ordersetnum_div').dialog("open");
        var row_div = document.createElement('div');
        row_div.setAttribute('class','row');
        $('#ordersetnum_div').append(row_div);

        var row_d1=document.createElement('div');
        row_d1.setAttribute('class','row');
        row_div.append(row_d1);
        var col_md_12_div=document.createElement('DIV');
        col_md_12_div.setAttribute('class','col-md-12');
        row_d1.append(col_md_12_div)
        var p_text=document.createElement('p');
        p_text.innerHTML="Number of sets"
        col_md_12_div.append(p_text)
        var row_d2=document.createElement('div');
        row_d2.setAttribute('class','row');
        row_div.append(row_d2);
        var col_md_12_div2=document.createElement('DIV');
        col_md_12_div2.setAttribute('class','col-md-12');
        row_d2.append(col_md_12_div2)
        var input = document.createElement("INPUT");
        input.setAttribute("type", "number");
        input.id='inputset_num_co';
        col_md_12_div2.append(input);
        // send an ajax call to admin_setup sending set num, exp id. 
        

      
    }
    else {
            dict[outercheckval]=data
           
            if (data==null){
                dict[outercheckval]=[0,1]
            }
            console.log('dictionary',dict)
            // calling innercheckboxdivs. 
            // these divs basically come after outercheckbox that contain innerchecks.
            // outercheck id and the data is sent to this function.
            // This function shows the innerChecksdivs after including and populating data in 
            // innerchecks.
            // todo: change the name of innercheckboxdivs name as it seems like it is refering to
            // div inside inner checks...
            
            // checkbox_id_dict[outercheckid]=[];
            showInnerCheckBoxDivs(outercheckid,data);
            updateFeatureLvls();
        } 
    
}
    
    else {
        // alert('You Un-Checked it');
        //  three checks will be made here for p, co and c. 
        // the check will see if the user had created a new exp object and one of the three is being ticked and now unticked. 
        // if unticked then all data stored in dict, phoneset_dic, phonename_dic, featureLevel blocks will be deleted as well by calling sendFeatureLevl()
        // For now its purpose is simply to hide the innercheckdivs.  
        if (outercheckval==="P"){
            if(exp_id!==""){
                    // removing every thing related to phoneset
                    phoneset_dic={};
                    phonename_dic={};
                    brand_set_dict={};
                    slider_set_dict={};
                    // disabling mobile Catalog button if p is not ticked!.

                    $("#create_exp_mobile_catalog").css('background-color','black');
                    $("#create_exp_mobile_catalog").css('color','black');
                    $("#create_exp_mobile_catalog").css('cursor','not-allowed');

                    $("#create_exp_mobile_catalog").attr("disabled", true); 
                }

        }
        hideInnerCheckBoxDivs(outercheckid);
        console.log("outercheckval",outercheckval);
        console.log("dict",dict)
        dict[outercheckval]=null;
        if (dict[outercheckval]==null  ){
            delete dict[outercheckval];
        }
        console.log("phoneset_dic--",phoneset_dic)
        // empty phoneset_dic 
        phoneset_dic={}
        console.log("phoneset_dic",phoneset_dic)

        console.log("dict",dict)


        var get_dict=JSON.parse(window.localStorage.getItem("feat_dict")); 
        get_dict=dict;
        var set_dict=get_dict;
        window.localStorage.setItem("feat_dict", JSON.stringify(set_dict));
        removeFeatureLevel();
        updateFeatureLvls();
    }
  }});  
 }
function criteriaDispPopup(){
        $('#criteria_display_popup').empty();
        $('#criteria_display_popup').dialog({ 
        title: "Criteria Display",
        autoOpen: false,
        minHeight: 200,
        maxHeight: 300,
        closeOnEscape: true,
        hide: { effect: "highlight", duration: 1000 },
    });
    $('#criteria_display_popup').dialog("open");
    var row_content_div = document.createElement('div');
    row_content_div.setAttribute('class','row-content');
    $('#criteria_display_popup').append(row_content_div);
    console.log("crit_order_dict_test",crit_order_dict);
    if (!Object.keys(crit_order_dict).length){
        alert("Data for criteria order not loaded")
    }
    for (var i in crit_order_dict){
        var row_d1=document.createElement('div');
        row_d1.setAttribute('class','row');
        row_content_div.append(row_d1);
        var col_md_12_div=document.createElement('DIV');
        col_md_12_div.setAttribute('class','col-md-12');
        row_d1.append(col_md_12_div)
        col_md_12_div.append(i);
        var row_d2=document.createElement('DIV');
        row_d2.setAttribute('class','row');
        row_content_div.append(row_d2);
        var col_md_12_div_2=document.createElement('DIV');
        col_md_12_div_2.setAttribute('class','col-md-12');
        row_d2.append(col_md_12_div_2)
        col_md_12_div_2.append(crit_order_dict[i])


    }
       

       
}

// once the onclick function=>(innercheckbox) of inner checks are called it 
// shows three things. innercheck value , id and outer check value/title.
function innerCheckBox(innercheckval,innercheckid,outercheckdivtitle,outercheckdivid){
//console.log(innercheckval,innercheckid,outercheckdivtitle);

console.log('outercheckbox title',outercheckdivtitle)
var innercheckboxid = $('#'+innercheckid);
//var parentdiv=innercheckboxid.parent();
//var parentdivid=parentdiv.attr('id');
var temparr=outercheckdivid.split('-');
console.log('outercheck id ',temparr[0])
var innercheckboxid_elem = document.getElementById(innercheckboxid);

//console.log("outerchekboxid-",outercheckid );
console.log("innercheckbox-",innercheckboxid );
// checking if the user has checked or not. 

// if ($(innercheckboxid).is(':checked')) {
    console.log('#'+temparr[0])
    // $('#'+temparr[0]).prop('checked',true);
    
if ($(innercheckboxid).prop('checked') == true){
    //Process for adding the innercheck value in dict. 
            if (dict[outercheckdivtitle] == null) {
                    dict[outercheckdivtitle]=[]
                }   
            arr_feature_levels=dict[outercheckdivtitle];
            console.log('Specific dict in Checked',dict[outercheckdivtitle]);
            console.log('insert',arr_feature_levels);
            arr_feature_levels.push(innercheckval);
            dict[outercheckdivtitle]=arr_feature_levels;
            console.log('arr',arr_feature_levels);
            console.log('All dict in checked condition.',dict);
            // updating feat_dict in session. 
            var get_dict=JSON.parse(window.localStorage.getItem("feat_dict")); 
            get_dict=dict;
            var set_dict=get_dict;
            window.localStorage.setItem("feat_dict", JSON.stringify(set_dict));

            
            updateFeatureLvls();
    //Process for adding innercheck id in checkbox_id_dict
            // 1.GET THE OUTER CHECK BOX ID BY GETTING LAST INDEX OF INNER CHECK ID. 
            var outercheckid=innercheckid.slice(-1);
            // get all innercheck present in check_id_dict
            var innercheck_all_id=checkbox_id_dict[outercheckid];
            // push newly selected one into innercheck_All_id
            innercheck_all_id.push(innercheckid);
            //
            checkbox_id_dict[outercheckid]=innercheck_all_id;
            console.log('newly added id in check dic',checkbox_id_dict)
            // Update check_id_dict in session. 
            var get_chkbx_id_dict=JSON.parse(window.localStorage.getItem("checkbox_id_dict")); 
            var get_chkbx_id_dict=checkbox_id_dict;
            var set_chkbx_id_dict=get_chkbx_id_dict;
            console.log("set_chkbx_id_dict",set_chkbx_id_dict);
            window.localStorage.setItem("checkbox_id_dict", JSON.stringify(set_chkbx_id_dict));


        

        
    
} else if ($(innercheckboxid).prop('checked') == false) {
   // PROCESS TO DELETE THE UNCHECKED  FEATURE LEVEL FROM DICT 
                    // Getting all the feature levels of the feature in a list. 
                    arr_feature_levels=dict[outercheckdivtitle];
                    console.log('Specific dict in UnChecked',dict[outercheckdivtitle]);
                    console.log('arr',arr_feature_levels);
                    console.log(innercheckval);
                    var index = $.inArray(innercheckval, arr_feature_levels);
                        if (index != -1) {
                            var removedvalue=arr_feature_levels.splice(index, 1);
                            console.log('removedvalue',removedvalue);
                    
                        

                        }
                    console.log('del arr',arr_feature_levels);  
                    console.log('del arr',arr_feature_levels.length);
                    // A Check to see if all inner checks are unchecked then remove the key aswell
                    if (arr_feature_levels.length===0){
                        delete  dict[outercheckdivtitle];
                        console.log('condition check');
                        console.log('deleted dic',dict);
   
                    }
                    else{ 
                        dict[outercheckdivtitle]=arr_feature_levels;
                        console.log('dict',dict);
                        
                    }
                    // UPdate Feat_dict in session. 
                    var get_dict=JSON.parse(window.localStorage.getItem("feat_dict")); 
                    get_dict=dict;
                    var set_dict=get_dict;
                    window.localStorage.setItem("feat_dict", JSON.stringify(set_dict));

 // PROCESS TO DELETE THE UNCHECKED FEATURE LEVEL ID FROM CHECKBOX_ID_DICT 
                // 1.GET THE OUTER CHECK BOX ID BY GETTING LAST INDEX OF INNER CHECK ID. 
                var outercheckid=innercheckid.slice(-1);
                // get all the innercheck id from checkbox_id_dict of key outercheckid..
                var innercheck_all_id=checkbox_id_dict[outercheckid]
                // get the index of the innercheckid in innercheck_All_id list
                // Then remove it. 
                var innercheck_id_index = $.inArray(innercheckid, innercheck_all_id);
                                    if (innercheck_id_index != -1) {
                                        var removedid=innercheck_all_id.splice(index, 1);
                                        console.log('removedid',removedid);
                                    }
                                    console.log('innercheck_all_id list',innercheck_all_id);  
                                // A Check to see if all inner checks are unchecked then remove the key aswell
                                if (innercheck_all_id.length===0){
                                        delete  checkbox_id_dict[outercheckid];
                                        console.log('condition check');
                                        console.log('checkbox_id_dic after deletion',checkbox_id_dict);
                                        var x = document.getElementById(outercheckid);
                                        x.checked = false;
                                        $('#'+outercheckid+'-innercheckboxdiv').hide();
                                        $('#'+outercheckid+'-innercheckboxdiv').empty();
                                    }
                                else{ 
                                    checkbox_id_dict[outercheckid]=innercheck_all_id;
                                    console.log('checkbox_id_dict',checkbox_id_dict);
                                }
                                // Update check_id_dict in session. 
                                var get_chkbx_id_dict=JSON.parse(window.localStorage.getItem("checkbox_id_dict")); 
                                var get_chkbx_id_dict=checkbox_id_dict;
                                var set_chkbx_id_dict=get_chkbx_id_dict;
                                window.localStorage.setItem("checkbox_id_dict", JSON.stringify(set_chkbx_id_dict));




    }
    updateFeatureLvls();
}

function showInnerCheckBoxDivs(outercheckid,data){
console.log('#'+outercheckid+'-innercheckboxdiv')
// Creating inner checks and populating them with data. 

 var innercheckbox_id_list=[];
for (var o in data){
        console.log('A',o);    
        var innercheck_element =  $(document.createElement("input")).attr({
                id: o +'-innercheckbox-'+outercheckid,
                name:  '',
                value: data[o],
                text :'',
                type:  'checkbox',
                checked:true,
                onclick:"innerCheckBox($(this).attr('value'),$(this).attr('id'),\
                $(this).parent().attr('title'), $(this).parent().attr('id')\
                )"
            
        })
        var inner_id=innercheck_element.attr('id')
        var stored_innercheckbox_id_list=checkbox_id_dict[outercheckid]
        if ((stored_innercheckbox_id_list===undefined )|| (stored_innercheckbox_id_list==[])){
           innercheckbox_id_list.push(inner_id);
        }
        else{
           
            // IT WILL BE ALWAYS FALSE if check_id_dict[key] is empty> IT SHOULD BE FALSE>
            for (var value_id in stored_innercheckbox_id_list){
                    console.log(stored_innercheckbox_id_list[value_id]);
                    console.log (inner_id)
                

                            if (stored_innercheckbox_id_list[value_id]===inner_id)
                            {    console.log('in if cond')
                                innercheckbox_id_list.push(inner_id)
                                

                            }
                            else{
                                console.log('in else cond')
                                innercheck_element.prop('checked',false)

                            }
                }
        }
        // adding input attributes to a div
        $('#'+outercheckid+'-innercheckboxdiv').append(innercheck_element);
        $('#'+outercheckid+'-innercheckboxdiv').append(data[o]);
        $('#'+outercheckid+'-innercheckboxdiv').show();
    }
     checkbox_id_dict[outercheckid]=innercheckbox_id_list;
    // alert(checkbox_id_dict[outercheckid]);
     console.log('DICTionary',dict);
     window.localStorage.setItem("feat_dict", JSON.stringify(dict));
     window.localStorage.setItem("checkbox_id_dict", JSON.stringify(checkbox_id_dict));
   
     console.log('All innercheck boxid added to checkbox dict',checkbox_id_dict);
}

function sendFeatureLevels(){ 
if (dict['C']===undefined){
    
    // alert("Please Choose Criteria Display Method ")
    $('#defualt_criteria_popup').empty();
    $('#defualt_criteria_popup').dialog({ 
                title: "Default Criteria Confirmation",
                autoOpen: false,
                minHeight: 200,
                maxHeight: 300,
                closeOnEscape: true,
                close       : function () {   $( this ).dialog( "close" );},

                hide: { effect: "highlight", duration: 500 },
                buttons: [
                            // {
                            //     text:"create sets",
                            //     click: function() {
                            //         $('#'+7).attr("checked",true);
                            //         outerCheckBox("CO",7);
                                  
                            //     }

                            // },

                            {
                                text: "Proceed",
                                click: function() {
                                $( this ).dialog( "close" );
                                $('#ordersetnum_div').empty();
                                $('#ordersetnum_div').dialog({ 
                                    title: "Order Criteria",
                                    autoOpen: false,
                                    minHeight: 200,
                                    maxHeight: 300,
                                    closeOnEscape: true,
                                    hide: { effect: "highlight", duration: 1000 },
                                    buttons: [
                                    {
                                    text: "Save",
                                    click: function() {
                                        $( this ).dialog( "close" );
                                        console.log("vale",$('#inputset_num_co').val())
                                        numofsets=$('#inputset_num_co').val();
                                        HideALL();
                                        var setlst=[];
                                        for (var i=0;i<numofsets;i++){
                                            var j=i+1
                                            var str="CO."+j;
                                            setlst.push(str);
                                        }
                                        console.log("SetLst",setlst);
                                        dict["CO"]=setlst;
                                        orderCriteriaHtmlSetup("CO",setlst);
                                        $('#'+7+'-innercheckboxdiv').append(dict["CO"]);
                                        $('#'+7+'-innercheckboxdiv').show();
                                        
                                        updateFeatureLvls();
                                    }
                                    // Uncommenting the following line would hide the text,
                                    // resulting in the label being used as a tooltip
                                    //showText: false
                                    }
                                  ]
                                }); // Initialize dialog plugin
                                $('#ordersetnum_div').dialog("open");   
                                var row_div = document.createElement('div');
                                row_div.setAttribute('class','row');
                                $('#ordersetnum_div').append(row_div);

                                var row_d1=document.createElement('div');
                                row_d1.setAttribute('class','row');
                                row_div.append(row_d1);
                                var col_md_12_div=document.createElement('DIV');
                                col_md_12_div.setAttribute('class','col-md-12');
                                row_d1.append(col_md_12_div)
                                var p_text=document.createElement('p');
                                p_text.innerHTML="Number of sets"
                                col_md_12_div.append(p_text)
                                var row_d2=document.createElement('div');
                                row_d2.setAttribute('class','row');
                                row_div.append(row_d2);
                                var col_md_12_div2=document.createElement('DIV');
                                col_md_12_div2.setAttribute('class','col-md-12');
                                row_d2.append(col_md_12_div2)
                                var input = document.createElement("INPUT");
                                input.setAttribute("type", "number");
                                input.id='inputset_num_co';
                                col_md_12_div2.append(input);                             
                                }
                            
                               
                    }
        ]
              
                }); // Initialize dialog plugin
                $('#defualt_criteria_popup').dialog("open");
                var row_div = document.createElement('div');
                row_div.setAttribute('class','row');
                $('#defualt_criteria_popup').append(row_div);

                var row_d1=document.createElement('div');
                row_d1.setAttribute('class','row');
                row_div.append(row_d1);
                var col_md_12_div=document.createElement('DIV');
                col_md_12_div.setAttribute('class','col-md-12');
                row_d1.append(col_md_12_div)
                var p_text=document.createElement('p');
                p_text.innerHTML="You haven't selected criteria display"
                col_md_12_div.append(p_text)
                var row_d2=document.createElement('div');
                row_d2.setAttribute('class','row');
                row_div.append(row_d2);
                var col_md_12_div2=document.createElement('DIV');
                col_md_12_div2.setAttribute('class','col-md-12');
                row_d2.append(col_md_12_div2);
                var p_text=document.createElement('p');
                p_text.innerHTML="Do wish to proceed with defualt(Full) Criterias?";
                col_md_12_div.append(p_text);
                // var input = document.createElement("INPUT");
                // input.setAttribute("type", "number");
                // input.id='inputset_num_co';
                // col_md_12_div2.append(input);


    // show popup telling admin that by default full criteria is selected. if ok pressed then
    // show all critria list and option for hiding, once user finishes. 
    // c.full will be added to dict. 
    // automatically back to feat_lvl_div. 
    // now criteria display method will be ticked and only c.full will be ticked all else not ticked. 
    // if box unchecked it'll remove everything set for exp. it will check if exp_id is empty or not if not then it will run sendfeature level func. 
    // 
    // 
    return;
}

if (jQuery.isEmptyObject(dict))
{
    alert("Please enable at least one Feature. Thank you!!")
    return;

}
$.ajax({
type: 'POST',
dataType: "json",
'data': {
'dict': JSON.stringify(dict,undefined,''),
'exp_id': exp_id,
'csrfmiddlewaretoken': '{{ csrf_token }}',
},
// the ajax call is sent to createexp url name in the post function.  
url: "{% url 'createexp' %}",
success: function(data){
    console.log("<<---FEATURES POSTED SUCCESSFULLY--->>");
    console.log(data)
    //console.log('Blocks---> ',data);
    for(var i in data){
        console.log("Hi:",i,data[i])
      
    }
    // alert(exp_id);
    if(exp_id===""){
        exp_id = data['exp_id'];
        custom_exp_id = data['custom_exp_id'];
        showExpWIP()
    }
        if (data['block_list']!=null){
            blockList = data['block_list']
            table_blocks=draw_block_table(blockList)
            display_blocktable(table_blocks);
            window.localStorage.setItem("blockList", JSON.stringify(blockList));
 
        }
    }
  }); 
}
function removeFeatureLevel(){
    $.ajax({
type: 'POST',
dataType: "json",
'data': {
'dict': JSON.stringify(dict,undefined,''),
'exp_id': exp_id,
'csrfmiddlewaretoken': '{{ csrf_token }}',
},
// the ajax call is sent to createexp url name in the post function.  
url: "{% url 'createexp' %}",
success: function(data){
    console.log("<<---FEATURES POSTED SUCCESSFULLY--->>");
    console.log(data)
    //console.log('Blocks---> ',data);
    for(var i in data){
        console.log("Hi:",i,data[i])
      
    }
    // alert(exp_id);
    if(exp_id===""){
        exp_id = data['exp_id'];
        custom_exp_id = data['custom_exp_id'];
        showExpWIP()
    }
        if (data['block_list']!=null){
            blockList = data['block_list']
            table_blocks=draw_block_table(blockList)
            display_blocktable(table_blocks);
            window.localStorage.setItem("blockList", JSON.stringify(blockList));
 
        }
    }
  })
}
function draw_block_table(blocklist){
        // var tab_blocks = $("<table id='blocks_table'/>");
       
        var table_blocks=document.createElement('TABLE');
        table_blocks.setAttribute('id','blocks_table');
        table_blocks.setAttribute('class','table table-striped table-bordered table-condensed');

        var thead=document.createElement('THEAD');
        table_blocks.appendChild(thead);
        var tbody=document.createElement('TBODY');
        table_blocks.appendChild(tbody);
        var trh=document.createElement('TR');
        thead.appendChild(trh);
        var  th=document.createElement('TH');
        trh.appendChild(th);
        th.append('Block No');
        var  th=document.createElement('TH');
        trh.appendChild(th);
        th.append('Feature Level Combination');

    for(var i = 0; i < blocklist.length; i++){
            var tr=document.createElement('TR')
            tbody.appendChild(tr);
            var td=document.createElement('TD')
            tr.appendChild(td);
            td.append(blocklist[i]['serial_no'])
            var td=document.createElement('TD')
            tr.appendChild(td);
            td.append(blocklist[i]['levels_set'])
         }
    return table_blocks;
}
function display_blocktable(table_blocks){
    // Is not useed anymore
    // $('#blocksBreakUp').html('');
    // $('#blocksBreakUp').append(table_blocks);
    $('#generated_blocks').html('');
    $('#generated_blocks').append(table_blocks);
    
}

function sendFilePath(id){
        console.log(id);
        console.log($('#'+id).val().replace(/C:\\fakepath\\/i, ''));
        var filepath=$('#'+id).val().replace(/C:\\fakepath\\/i, '');
        console.log(filepath);
        $.ajax({
        type: 'POST',
        dataType: "json",
        'data': {
        'dict': JSON.stringify(filepath),
        'csrfmiddlewaretoken': '{{ csrf_token }}',
        },
        // the ajax call is sent to subdetails url name in the post function.  
        url: "{% url 'createexp' %}",
        success: function(data){}
        
        }); 

      }
</script>
<!-- <script src="https://code.jquery.com/jquery-3.3.1.js"></script> -->
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>


<script src="{% static 'webapp/createexp/DataTables/DataTables-1.10.18/js/jquery.dataTables.min.js' %}"></script>
<link rel="stylesheet" type="text/css" src="{% static 'webapp/createexp/DataTables/DataTables-1.10.18/cs/jquery.dataTables.min.css' %}"/>
<script>
    // Warning before leaving the page (back button, or outgoinglink)
    window.onbeforeunload = function() {
        window.localStorage.setItem("slider_set_dict", JSON.stringify(slider_set_dict));
        window.localStorage.setItem("brand_set_dict", JSON.stringify(brand_set_dict));
        window.localStorage.setItem("phoneset_dic", JSON.stringify(phoneset_dic));
        window.localStorage.setItem("phonename_dic", JSON.stringify(phonename_dic));
        window.localStorage.setItem("crit_order_dict", JSON.stringify(crit_order_dict));
        window.localStorage.setItem("crit_hide_dict", JSON.stringify(crit_hide_dict));




       return "Do you really want to leave our brilliant application?";
       //if we return nothing here (just calling return;) then there will be no pop-up question at all
       //return;
    };
   
</script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script> -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/xlsx.full.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/jszip.js"></script>
<script>
    // var btns = document.getElementsByClassName("custom_nav_btn");
var slider_set_dict={};
var brand_set_dict={};
$(document).ready(function () {
            // console.log('btns',btns)
            $('#mobile_catalog_div').hide();
            $('#pager').hide();

        // var slider2 = new rSlider({
        //             target: '#price_slider',
        //             values: {min:5000,max:70000},
        //             range: true,
        //             tooltip: true,
        //             scale: false,
        //             labels: false,
        //             set: [5000, 70000],
        //             step:10000,
        //             onChange:function (values) { 
        //                 var values=values.split(',');
        //                 console.log(values);
        //                 $.ajax({
        //                      // Ajax call to getrange of phones ...  
        //                         url: "{% url 'createexp' %}",
        //                         type:'GET',
        //                         'data': {
        //                         'price_range_values':JSON.stringify(values),
        //                         // 'csrfmiddlewaretoken': '{{ csrf_token }}',
        //                         },
        //                         dataType: "json",
        //                         success: function(data){
        //                         console.log("data",data)// location.reload();
        //                         $('#mobile_catalog_div').empty();
        //                         $('#pager').hide();
        //                         // var json_data_mobiles=data['samsung_phones']
        //                         var json_data_mobiles=data['mobilephones']
        //                         // var row_fluid=document.createElement('div');
        //                         // row_fluid.setAttribute('class','row-fluid');
        //                         // row_fluid.setAttribute('id','mobile_catalog_div');
        //                         row_fluid=$('#mobile_catalog_div');
        //                         var row=document.createElement('div');
        //                         row.setAttribute('class','row');
        //                         row_fluid.append(row);
        //                         var col_md_12=document.createElement("div");
        //                         col_md_12.setAttribute('class','col-md-12');
        //                         row.append(col_md_12);
        //                         var lps=document.createElement("div");
        //                         lps.setAttribute("class",'latest-product-section');
        //                         col_md_12.append(lps);
        //                         var rtc=document.createElement('DIV');
        //                         rtc.setAttribute("class","row text-center");
        //                         lps.append(rtc);
        //                         for (var i=0;i<json_data_mobiles.length;i++){
                                   
        //                             if (i%3===0 && i!==0){
        //                                 console.log("asd",i)
        //                                 var hr=document.createElement('hr');
        //                                 lps.append(hr); 
        //                                 var rtc=document.createElement('DIV');
        //                                 rtc.setAttribute("class","row text-center");
        //                                 lps.append(rtc);
                                      
        //                             }
        //                             var col_md_4_post=document.createElement('DIV');
        //                             col_md_4_post.setAttribute("class","col-md-4 sm-margin-b-50 pull-left post");
        //                             rtc.append(col_md_4_post);
        //                             var margin_b_20=document.createElement('DIV');
        //                             margin_b_20.setAttribute("class","margin-b-20");
        //                             col_md_4_post.append(margin_b_20);
        //                             var input_checkb=document.createElement('input');
        //                             input_checkb.type="checkbox";
        //                             input_checkb.value=json_data_mobiles[i]['id'];
        //                             input_checkb.id=json_data_mobiles[i]['id'];
        //                             input_checkb.name=json_data_mobiles[i]['id']+"-"+json_data_mobiles[i]['Mobile_Name'];
        //                             input_checkb.setAttribute('onchange','toggleCheckbox(this)')
        //                             var img=document.createElement('img');
        //                             img.setAttribute('class','img-responsive')
        //                             console.log("/static/"+json_data_mobiles[i]['imagepath1'])
        //                             img.src="/static/"+json_data_mobiles[i]['imagepath1'];

        //                             margin_b_20.append(input_checkb);
        //                             margin_b_20.append(img);
        //                             var mobile_name_p=document.createElement('p')
        //                             mobile_name_p.innerHTML=json_data_mobiles[i]['Mobile_Name']
        //                             col_md_4_post.append(mobile_name_p)
        //                             var mobile_price_p=document.createElement('p')
        //                             mobile_price_p.innerHTML=json_data_mobiles[i]['price']
        //                             col_md_4_post.append(mobile_price_p)
        //                             var link=document.createElement('a');
        //                             link.setAttribute('class','link btn btn-success');
        //                             // took alot of time finding this solution...
        //                             var url = "{% url 'mobileinfo' id=4  %}".replace("4", json_data_mobiles[i]['id']);
        //                             link.href= url;

        //                             link.text="READ MORE";
        //                             col_md_4_post.append(link); 
        //                             // if (i%3===0 && i!==0){
                                       
        //                             // }
        //                             // console.log(i)
        //                         }
  
        //                     }
                                
                                
        //                  }); 
                       
        //             }
        // });

        });
function mobileCatalog(){
        
        $('#importSubdiv').hide();
        $('#dispFileFeatLvldiv').hide();
        $('#subj_split_batch_rowdiv').hide();
        $('#block_assign_row_div').hide();
        $('#feat_lvl_div').hide();
        $('#batchmngprvbtn_div').hide();
        $('#dataDiv').hide();
        $('#blkoutputsDiv').hide();
        $('#expphonelist_div').show();
        $('#mobile_catalog_div').show();
        $("#price_slider_div").show(); 
        $('#brand_check_div').show();
        $("#exp_sel_phones_div").show();
        $("#searchfilter_head_div").show();

            // creation of html slide div!
            $('#price_slider_div').empty();
            var row_fluid=$('#price_slider_div');
            var row=document.createElement('div');
            row.setAttribute('class','row');
            row_fluid.append(row);
            var col_md_4_1=document.createElement("div");
            col_md_4_1.setAttribute('class','col-md-2');
            row.append(col_md_4_1);
            var col_md_4_2=document.createElement("div");
            col_md_4_2.setAttribute('class','col-md-8');
            row.append(col_md_4_2);
            var col_md_4_3=document.createElement("div");
            col_md_4_3.setAttribute('class','col-md-2');
            row.append(col_md_4_3);
            var input=document.createElement('input');
            input.setAttribute('class','slider')
            input.setAttribute('id','price_slider')
            col_md_4_2.append(input)
            $('#price_slider').show();

        var slider2 = new rSlider({
                    target: '#price_slider',
                    values: {min:5000,max:70000},
                    range: true,
                    tooltip: true,
                    scale: false,
                    labels: false,
                    set: [5000, 70000],
                    step:500,
                    onChange:function (values) { 
                        var values=values.split(',');
                        console.log("values-->",values);
                        if (brand_set_dict[active_button]===undefined){
                            brand_set_dict[active_button]=[]

                        }
                        $.ajax({
                             // Ajax call to getrange of phones ...  
                                url: "{% url 'createexp' %}",
                                type:'GET',
                                'data': {
                                'brandnames':brand_set_dict[active_button],
                                'price_range_values':JSON.stringify(values),
                                // 'csrfmiddlewaretoken': '{{ csrf_token }}',
                                },
                                dataType: "json",
                                success: function(data){
                                console.log("data",data);// location.reload();
                                $('#mobile_catalog_div').empty();
                              
                                // var json_data_mobiles=data['samsung_phones']
                                var json_data_mobiles=data['mobilephones']
                                // var row_fluid=document.createElement('div');
                                // row_fluid.setAttribute('class','row-fluid');
                                // row_fluid.setAttribute('id','mobile_catalog_div');
                                row_fluid=$('#mobile_catalog_div');
                                var row=document.createElement('div');
                                row.setAttribute('class','row');
                                row_fluid.append(row);
                                var col_md_12=document.createElement("div");
                                col_md_12.setAttribute('class','col-md-12');
                                row.append(col_md_12);
                                var lps=document.createElement("div");
                                lps.setAttribute("class",'latest-product-section');
                                col_md_12.append(lps);
                                var rtc=document.createElement('DIV');
                                rtc.setAttribute("class","row text-center");
                                lps.append(rtc);
                                for (var i=0;i<json_data_mobiles.length;i++){
                                   
                                    // if (i%3===0 && i!==0){
                                    //     console.log("asd",i)
                                    //     var hr=document.createElement('hr');
                                    //     lps.append(hr); 
                                    //     var rtc=document.createElement('DIV');
                                    //     rtc.setAttribute("class","row text-center");
                                    //     lps.append(rtc);
                                      
                                    // }
                                    var col_md_4_post=document.createElement('DIV');
                                    col_md_4_post.setAttribute("class","col-md-4 sm-margin-b-50 pull-left post");
                                    rtc.append(col_md_4_post);
                                    var margin_b_20=document.createElement('DIV');
                                    margin_b_20.setAttribute("class","margin-b-20");
                                    col_md_4_post.append(margin_b_20);
                                    var input_checkb=document.createElement('input');
                                    input_checkb.type="checkbox";
                                    var temp_set_val_list=[];
                                    temp_set_val_list=data['price_range_values'];
                                    if (slider_set_dict[active_button]===undefined){
                                        slider_set_dict[active_button]=[]
                                        slider_set_dict[active_button]=temp_set_val_list
                                    }else{
                                        slider_set_dict[active_button]=temp_set_val_list
                                    }
                                    
                                    if (phoneset_dic[active_button]===undefined    ){
                                        phoneset_dic[active_button]=[];

                                    }
                                    else{
                                        //  a check to check if the retrieved mob id matches the id in the list 
                                        
                                        if (phoneset_dic[active_button].includes(json_data_mobiles[i]['id'])){
                                            input_checkb.checked=true;
                                        }

                                    }
                                    input_checkb.value=json_data_mobiles[i]['id'];
                                    input_checkb.id=json_data_mobiles[i]['id']+"cat";
                                    input_checkb.name=json_data_mobiles[i]['id']+"-"+json_data_mobiles[i]['Mobile_Name'];
                                    input_checkb.setAttribute('onchange','toggleCheckbox(this)')
                                    var img=document.createElement('img');
                                    img.setAttribute('class','img-responsive')
                                    // console.log("/static/"+json_data_mobiles[i]['imagepath1'])
                                    img.src="/static/"+json_data_mobiles[i]['imagepath1'];

                                    margin_b_20.append(input_checkb);
                                    margin_b_20.append(img);
                                    var mobile_name_p=document.createElement('p')
                                    mobile_name_p.innerHTML=json_data_mobiles[i]['Mobile_Name']
                                    col_md_4_post.append(mobile_name_p)
                                    var mobile_price_p=document.createElement('p')
                                    mobile_price_p.innerHTML=json_data_mobiles[i]['price']
                                    col_md_4_post.append(mobile_price_p)
                                    var link=document.createElement('a');
                                    link.setAttribute('class','link btn btn-success');
                                    // took alot of time finding this solution...
                                    var url = "{% url 'mobileinfo' id=4  %}".replace("4", json_data_mobiles[i]['id']);
                                    link.href= url;

                                    link.text="READ MORE";
                                    col_md_4_post.append(link); 
                                    // if (i%3===0 && i!==0){
                                       
                                    // }
                                    // console.log(i)
                                }
                                // console.log("global_phones_exp_phones",global_phones_exp_phones);
                                for (phones in global_phones_exp_phones){
                                    $('input:checkbox[id^='+global_phones_exp_phones[phones]+"cat"+']:not(:checked)').prop('checked',true);
                                    // console.log("catt",$('input:checkbox[id^='+global_phones_exp_phones[phones].id+"cat"+']:not(:checked)').attr('id'));

                                }
                            }
                                
                                
                         }); 
                       
                    }
        });

        // on clicking the mobile catalog generate set buttons and put set P.1 as active. 
        var phoneset_button_div=$('#phoneset_button_div');
        $('#phoneset_button_div').empty();
        $('#phones_main_button_div').show();
        var row=document.createElement('div');
        row.setAttribute('class','row');
        phoneset_button_div.append(row);
        var col_md_8=document.createElement('div');
        col_md_8.setAttribute('class','col-md-9 btn-group');
        col_md_8.id="set_buttons"
        row.append(col_md_8);
        var col_md_2=document.createElement('div');
        col_md_2.setAttribute('class','col-md-2');
        col_md_2.setAttribute('style','width:inherit');

        col_md_2.id="process_buttons"
        row.append(col_md_2);
        var nextstep=document.createElement('button');
        nextstep.innerHTML="Next Step";
        nextstep.setAttribute("onclick","NextStep($(this))");
        col_md_2.append(nextstep);
        var col_md_2=document.createElement('div');
        col_md_2.setAttribute('class','col-md-1');
        col_md_2.id="save_button"
        row.append(col_md_2);
       
        for (var i=0;i<setlist.length;i++){
            var button=document.createElement('button')
            button.id=setlist[i]
            button.innerHTML=setlist[i];
            button.setAttribute("onclick","SetFunc($(this).attr('id'))")
            if (i===0){
                var this_b=button
            }
            $('#set_buttons').append(button)
        }

        SetFunc($(this_b).attr('id'));
        // $('.innerchecksboxdivs').hide();
        // $('.map_select_label').hide();
        // $('.show_select_tag').hide();
        // $('#self-defined').hide();
        // $('#pre-defined').hide();
        // $('#selfbuttondiv').hide();
        // $('#prebuttondiv').hide();
        // $('#upload').prop('disabled',true);
        var current=$(".active");
        current.prop('class',current.attr('class').replace('active',""));
        $('#create_exp_mobile_catalog').prop('class', 'custom_nav_btn active');
    }
    var specmobphones={}
    
   


    function NextStep(element){
        // send all mobile id to server and request for there details. 
        console.log("phoneset_dic-->",phoneset_dic[active_button])
        for (i in phoneset_dic){
            console.log("phoneset_dic[active_button][i]",phoneset_dic[i])
            if (phoneset_dic[i]===undefined || phoneset_dic[i].length<1){
            alert("Please select at least two phones for the sets");
            return;
        }
        }
        // CHECK FOR ALL PHONESET_DICT keys if there list value is less than 1 or undefined
        
        $.ajax({
                // Ajax call to get specific phones...  
                url: "{% url 'get_specificmobile_data' %}",
                type:'POST',
                'data': {
                'specsmobdata':JSON.stringify(phoneset_dic),
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                dataType: "json",
                success: function(data){
                    console.log("active_button",active_button)
                    console.log(data['mobilephones'][active_button])
                    $('#mobile_catalog_div').empty();
                               
                                // var json_data_mobiles=data['samsung_phones']
                                
                                var json_data_mobiles=data['mobilephones'][active_button]
                                specmobphones=data['mobilephones']
                                // var row_fluid=document.createElement('div');
                                // row_fluid.setAttribute('class','row-fluid');
                                // row_fluid.setAttribute('id','mobile_catalog_div');
                                row_fluid=$('#mobile_catalog_div');
                                var row=document.createElement('div');
                                row.setAttribute('class','row');
                                row_fluid.append(row);
                                var col_md_12=document.createElement("div");
                                col_md_12.setAttribute('class','col-md-12');
                                row.append(col_md_12);
                                var lps=document.createElement("div");
                                lps.setAttribute("class",'latest-product-section');
                                col_md_12.append(lps);
                                var rtc=document.createElement('DIV');
                                rtc.setAttribute("class","row text-center");
                                rtc.id="grid";
                                lps.append(rtc);

                            

                                for (var i=0;i<json_data_mobiles.length;i++){
                                   
                                //     if (i%3===0 && i!==0){
                                //         var hr=document.createElement('hr');
                                //         lps.append(hr); 
                                //         var rtc=document.createElement('DIV');
                                //         rtc.setAttribute("class","row text-center");
                                //         lps.append(rtc);
                                      
                                //     }
                                    var col_md_4_post=document.createElement('DIV');
                                    col_md_4_post.setAttribute("class","col-md-4 sm-margin-b-50 pull-left post");
                                    col_md_4_post.id=json_data_mobiles[i]['id'];
                                    rtc.append(col_md_4_post);
                                    var margin_b_20=document.createElement('DIV');
                                    margin_b_20.setAttribute("class","margin-b-20");
                                    col_md_4_post.append(margin_b_20);
                                    var input_checkb=document.createElement('input');
                                    input_checkb.type="checkbox";
                                    console.log("phoneset_dic[active_button]",phoneset_dic[active_button])
                                    if (phoneset_dic[active_button]===undefined){
                                        phoneset_dic[active_button]=[]
                                    }
                                    else{
                                        //  a check to check if the retrieved mob id matches the id in the list 
                                        // console.log("list",phoneset_dic[active_button])
                                        // console.log("list type",typeof(phoneset_dic[active_button]))

                                        if (phoneset_dic[active_button].includes(json_data_mobiles[i]['id'])){
                                            input_checkb.checked=true;
                                        }

                                    }
                                    
                                    input_checkb.value=json_data_mobiles[i]['id'];
                                    input_checkb.id=json_data_mobiles[i]['id']+"cat";
                                    input_checkb.name=json_data_mobiles[i]['id']+"-"+json_data_mobiles[i]['Mobile_Name'];
                                    input_checkb.setAttribute('onchange','toggleCheckbox(this)')
                                    var img=document.createElement('img');
                                    img.setAttribute('class','img-responsive')
                                    // console.log("/static/"+json_data_mobiles[i]['imagepath1'])
                                    img.src="/static/"+json_data_mobiles[i]['imagepath1'];

                                    margin_b_20.append(input_checkb);
                                    margin_b_20.append(img);
                                    var mobile_name_p=document.createElement('p')
                                    mobile_name_p.innerHTML=json_data_mobiles[i]['Mobile_Name']
                                    col_md_4_post.append(mobile_name_p)
                                    var mobile_price_p=document.createElement('p')
                                    mobile_price_p.innerHTML=json_data_mobiles[i]['price']
                                    col_md_4_post.append(mobile_price_p)
                                    var link=document.createElement('a');
                                    link.setAttribute('class','link btn btn-success');
                                    // took alot of time finding this solution...
                                    var url = "{% url 'mobileinfo' id=4  %}".replace("4", json_data_mobiles[i]['id']);
                                    link.href= url;

                                    link.text="READ MORE";
                                    col_md_4_post.append(link); 
                                    // if (i%3===0 && i!==0){
                                       
                                    // }
                                    // console.log(i)
                                 }
                                // console.log("global_phones_exp_phones",global_phones_exp_phones);
                                for (phones in global_phones_exp_phones){
                                    $('input:checkbox[id^='+global_phones_exp_phones[phones]+"cat"+']:not(:checked)').prop('checked',true);
                                    // console.log("catt",$('input:checkbox[id^='+global_phones_exp_phones[phones].id+"cat"+']:not(:checked)').attr('id'));

                                }
                                var ds="grid_"+active_button;
                                console.log("ds",ds)

                                $("#grid").sortable({
                                    stop: function( event, ui ) {
                                      var arr=[]
                                        console.log("event-->",$(this));
                                        var id = ui.item.attr("id");
                                        
                                        // var data = $(this).sortable('toArray', { attribute: 'id' });
                                        $(this).find('input').each(function(){
                                    arr.push($(this).val());  
                                            });         
                                            console.log("array->",arr)
                                        var result = arr.map(function (x) { 
                                        return parseInt(x, 10); 
                                        });
                                        console.log("data-->",result)
                                        phoneset_dic[active_button]=result
                                        console.log("phoneset_dic-->",phoneset_dic);
                                        },
                                  
                                });
                                $( "#grid" ).disableSelection();
                              
                            }
            });
        var backbutton=document.createElement('button');
        backbutton.innerHTML="Back"
        backbutton.setAttribute('onclick','backFunc($(this))')
        backbutton.setAttribute('id','backbutton_id')
       
        
        var savebutton=document.createElement('button');
        savebutton.innerHTML="Save"
        savebutton.setAttribute('onclick','SavePhoneSet($(this))')
        savebutton.setAttribute('id','savebutton_id')
        $(element).remove;
        $('#process_buttons').empty();
        $('#save_button').empty();
        $('#price_slider_div').empty();
        $('#brand_check_div').empty();


        $('#process_buttons').append(backbutton);
        $('#save_button').append(savebutton);
        
    }
    function SavePhoneSet(element){
        console.log("phoneset_dic",phoneset_dic)
        $.ajax({
                // Ajax call to savephoneset  
                url: "{% url 'savephonesets' %}",
                type:'POST',
                'data': {
                'phoneset_dic':JSON.stringify(phoneset_dic),
                'featlevels_dic': JSON.stringify(dict,undefined,''),
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                dataType: "json",
                success: function(data){
                    if(exp_id===""){
                    exp_id = data['exp_id'];
                    custom_exp_id = data['custom_exp_id'];
                    showExpWIP()
                    }
                    if (data['block_list']!=null){
                        blockList = data['block_list']
                        table_blocks=draw_block_table(blockList)
                        display_blocktable(table_blocks);
                        window.localStorage.setItem("blockList", JSON.stringify(blockList));
                    }
                    var current=$(".active");
                    current.prop('class',current.attr('class').replace('active',""));
                    $('#ftlvl').prop('class', 'custom_nav_btn active');
                    
                    console.log("DICT<<<<<!!!!")
                    console.log(dict)
                              


                    showFeatureLvls();
                   ele= document.getElementById('6')
                   ele.checked=true; 
                   

                }
                
        });
    }
    function backFunc (element){
        
        
        
        var nextstep=document.createElement('button');
        nextstep.innerHTML="Next Step";
        nextstep.setAttribute("onclick","NextStep($(this))");
        $('#save_button').empty();
        $('#process_buttons').empty();
       

        $('#process_buttons').append(nextstep);
        
        $(element).remove();
        SetFunc(active_button);
        
    }
    function SetFunc(active_id){
        if(active_button!==""){
            document.getElementById(active_button).style.backgroundColor = ""
        }
        
        active_button=active_id;
        brandCheck_Html_Crt();

        // For  displaying phone list on sidebar
       
                       $('#expphonelist_div').empty();
                       if (phonename_dic[active_button]===undefined){
                            phonename_dic[active_button]=[]
                                }
                        var expphonelist_div=document.getElementById('expphonelist_div');
                        var main_row_div=document.createElement("div");
                        main_row_div.setAttribute("class","row");
                        expphonelist_div.append(main_row_div);

                        var main_col_div=document.createElement('div');
                        main_col_div.setAttribute('class','col-md-12');
                        main_col_div.id=active_button+"unq";

                        main_row_div.append(main_col_div);
                        var h_div=document.createElement("div");
                        h_div.innerHTML=active_button;

                        main_col_div.append(h_div);

                        for (var i in phonename_dic[active_button]){
                            var row_div=document.createElement("div");
                            row_div.setAttribute("class","row");
                            var col_div=document.createElement('div');
                            col_div.setAttribute('class','col-md-12');
                            main_col_div.append(row_div);
                            row_div.append(col_div);
                            
                            if(phonename_dic[active_button].length===0){
                                                    col_div.append(phonename_dic[active_button]);
                                                }
                                                else{
                                                    col_div.append(phonename_dic[active_button][i]);
                                                }
                        }
                        
                        for (var key in phonename_dic){

                            if (key!==active_button){
                                if (phonename_dic[key]===undefined){
                                    phonename_dic[key]=[]

                                }
                                var main_col_div=document.createElement('div');
                                main_col_div.setAttribute('class','col-md-12');
                                main_col_div.id=active_button+"unq";
                                main_row_div.append(main_col_div);
                                var h_div=document.createElement("div");
                                h_div.id=key;
                                h_div.innerHTML=key;
                                main_col_div.append(h_div);

                                    for (var i in phonename_dic[key]){
                                        var row_div=document.createElement("div");
                                        row_div.setAttribute("class","row");
                                        var col_div=document.createElement('div');
                                        col_div.setAttribute('class','col-md-12');
                                        main_col_div.append(row_div);
                                        row_div.append(col_div);
                                                if(phonename_dic[key].length===0){
                                                    col_div.append(phonename_dic[key]);
                                                }
                                                else{
                                                    col_div.append(phonename_dic[key][i]);
                                                }
                                        }
                            }
                            else{
                                console.log("Match")
                            }
                        }
            // $('#expphonelist_div').append(phonename_dic[active_button])
        

        // red color
        document.getElementById(active_button).style.backgroundColor = "#94000e"
        // check if back button exists
        var temp_list=[]
       
        console.log("slider_set_dict[P.1],",slider_set_dict[active_button])
        if ($('#backbutton_id').text()==="Back"){
            
            $('#mobile_catalog_div').empty();
            var json_data_mobiles=specmobphones[active_button]
            console.log("phoneset_dic---",phoneset_dic[active_button]);
            console.log("specmobphones",specmobphones);
            if (phoneset_dic[active_button]!==undefined){
                alert("PJ")
                        if (phoneset_dic[active_button].length===specmobphones[active_button].length){
                            var len=phoneset_dic[active_button].length;
                            for (var i=0;i<len;i++){
                                for (var j=0;j<len;j++){
                                    if(specmobphones[active_button][j].id===phoneset_dic[active_button][i]){
                                            temp_list.push(specmobphones[active_button][j])
                                    }
                                }
                            }
                        }
            }
            
            var json_data_mobiles=temp_list
            console.log("json_data_mobiles",json_data_mobiles)
            row_fluid=$('#mobile_catalog_div');
                                var row=document.createElement('div');
                                row.setAttribute('class','row');
                                row_fluid.append(row);
                                var col_md_12=document.createElement("div");
                                col_md_12.setAttribute('class','col-md-12');
                                row.append(col_md_12);
                                var lps=document.createElement("div");
                                lps.setAttribute("class",'latest-product-section');
                                col_md_12.append(lps);
                                var rtc=document.createElement('DIV');
                                rtc.setAttribute("class","row text-center");
                                rtc.id="grid";
                                lps.append(rtc);
                                for (var i=0;i<json_data_mobiles.length;i++){
                                    // if (i%3===0 && i!==0){
                                    //     var hr=document.createElement('hr');
                                    //     lps.append(hr); 
                                    //     var rtc=document.createElement('DIV');
                                    //     rtc.setAttribute("class","row text-center");
                                    //     lps.append(rtc);
                                    // }
                                    var col_md_4_post=document.createElement('DIV');
                                    col_md_4_post.setAttribute("class","col-md-4 sm-margin-b-50 pull-left post");
                                    col_md_4_post.id=i+1;
                                    rtc.append(col_md_4_post);
                                    var margin_b_20=document.createElement('DIV');
                                    margin_b_20.setAttribute("class","margin-b-20");
                                    col_md_4_post.append(margin_b_20);
                                    var input_checkb=document.createElement('input');
                                    input_checkb.type="checkbox";
                                 
                                    if (phoneset_dic[active_button]===undefined ){
                                        phoneset_dic[active_button]=[];
                                    }
                                    else{
                                        //  a check to check if the retrieved mob id matches the id in the list 
                                        
                                        if (phoneset_dic[active_button].includes(json_data_mobiles[i]['id'])){
                                            input_checkb.checked=true;
                                        }

                                    }
                                    
                                    input_checkb.value=json_data_mobiles[i]['id'];
                                    input_checkb.id=json_data_mobiles[i]['id']+"cat";
                                    input_checkb.name=json_data_mobiles[i]['id']+"-"+json_data_mobiles[i]['Mobile_Name'];
                                    input_checkb.setAttribute('onchange','toggleCheckbox(this)')
                                    var img=document.createElement('img');
                                    img.setAttribute('class','img-responsive')
                                    // console.log("/static/"+json_data_mobiles[i]['imagepath1'])
                                    img.src="/static/"+json_data_mobiles[i]['imagepath1'];

                                    margin_b_20.append(input_checkb);
                                    margin_b_20.append(img);
                                    var mobile_name_p=document.createElement('p')
                                    mobile_name_p.innerHTML=json_data_mobiles[i]['Mobile_Name']
                                    col_md_4_post.append(mobile_name_p)
                                    var mobile_price_p=document.createElement('p')
                                    mobile_price_p.innerHTML=json_data_mobiles[i]['price']
                                    col_md_4_post.append(mobile_price_p)
                                    var link=document.createElement('a');
                                    link.setAttribute('class','link btn btn-success');
                                    // took alot of time finding this solution...
                                    var url = "{% url 'mobileinfo' id=4  %}".replace("4", json_data_mobiles[i]['id']);
                                    link.href= url;

                                    link.text="READ MORE";
                                    col_md_4_post.append(link); 
                                    }
                                    // console.log("global_phones_exp_phones",global_phones_exp_phones);
                                    for (phones in global_phones_exp_phones){
                                        $('input:checkbox[id^='+global_phones_exp_phones[phones]+"cat"+']:not(:checked)').prop('checked',true);
                                        // console.log("catt",$('input:checkbox[id^='+global_phones_exp_phones[phones].id+"cat"+']:not(:checked)').attr('id'));

                                    }
                                    var ds="grid_"+active_button;
                                    console.log("ds",ds)
                                    $("#grid").sortable({
                                    stop: function( event, ui ) {
                                        var arr=[]
                                        var id = ui.item.attr("id");
                                        console.log("id",id);
                                        console.log("children",$(this).find('input'));
                                        $(this).find('input').each(function(){
                                        arr.push($(this).val());  
                                        });         
                                            console.log("array",arr)
                                        // var data = $(this).sortable('toArray', { attribute: 'id' });
                                        var result = arr.map(function (x) { 
                                        return parseInt(x, 10); 
                                        });
                                        phoneset_dic[active_button]=result;
                                        },
                                  
                                });
                                $( "#grid" ).disableSelection();

                            }   
        else{
           
            // creation of html slide div!
            $('#price_slider_div').empty();
            var row_fluid=$('#price_slider_div');
            var row=document.createElement('div');
            row.setAttribute('class','row');
            row_fluid.append(row);
            var col_md_4_1=document.createElement("div");
            col_md_4_1.setAttribute('class','col-md-2');
            row.append(col_md_4_1);
            var col_md_4_2=document.createElement("div");
            col_md_4_2.setAttribute('class','col-md-8');
            row.append(col_md_4_2);
            var col_md_4_3=document.createElement("div");
            col_md_4_3.setAttribute('class','col-md-2');
            row.append(col_md_4_3);
            var input=document.createElement('input');
            input.setAttribute('class','slider')
            input.setAttribute('id','price_slider')
            col_md_4_2.append(input)
            $('#price_slider').show();
            var set_value=[];
            if (slider_set_dict[active_button]===undefined){
                set_value=[5000,70000];
            }
            else{
                set_value=slider_set_dict[active_button]
            }

        var slider2 = new rSlider({
                    target: '#price_slider',
                    values: {min:5000,max:70000},
                    range: true,
                    tooltip: true,
                    scale: false,
                    labels: false,
                    set: set_value,
                    step:500,
                    onChange:function (values) { 
                        var values=values.split(',');
                        console.log("values-->",values);

                        $.ajax({
                             // Ajax call to getrange of phones ...  
                                url: "{% url 'createexp' %}",
                                type:'GET',
                                'data': {
                                'price_range_values':JSON.stringify(values),
                                'brandnames':JSON.stringify(brand_set_dict[active_button])
                                // 'csrfmiddlewaretoken': '{{ csrf_token }}',
                                },
                                dataType: "json",
                                success: function(data){
                                console.log("data",data);// location.reload();
                                $('#mobile_catalog_div').empty();                            
                                // var json_data_mobiles=data['samsung_phones']
                                var json_data_mobiles=data['mobilephones']
                                // var row_fluid=document.createElement('div');
                                // row_fluid.setAttribute('class','row-fluid');
                                // row_fluid.setAttribute('id','mobile_catalog_div');
                                row_fluid=$('#mobile_catalog_div');
                                var row=document.createElement('div');
                                row.setAttribute('class','row');
                                row_fluid.append(row);
                                var col_md_12=document.createElement("div");
                                col_md_12.setAttribute('class','col-md-12');
                                row.append(col_md_12);
                                var lps=document.createElement("div");
                                lps.setAttribute("class",'latest-product-section');
                                col_md_12.append(lps);
                                var rtc=document.createElement('DIV');
                                rtc.setAttribute("class","row text-center");
                                lps.append(rtc);
                                for (var i=0;i<json_data_mobiles.length;i++){
                                   
                                    // if (i%3===0 && i!==0){
                                    //     console.log("asd",i)
                                    //     var hr=document.createElement('hr');
                                    //     lps.append(hr); 
                                    //     var rtc=document.createElement('DIV');
                                    //     rtc.setAttribute("class","row text-center");
                                    //     lps.append(rtc);
                                      
                                    // }
                                    var col_md_4_post=document.createElement('DIV');
                                    col_md_4_post.setAttribute("class","col-md-4 sm-margin-b-50 pull-left post");
                                    rtc.append(col_md_4_post);
                                    var margin_b_20=document.createElement('DIV');
                                    margin_b_20.setAttribute("class","margin-b-20");
                                    col_md_4_post.append(margin_b_20);
                                    var input_checkb=document.createElement('input');
                                    input_checkb.type="checkbox";
                                    var temp_set_val_list=[];
                                    temp_set_val_list=data['price_range_values'];

                                    if (slider_set_dict[active_button]===undefined){
                                        slider_set_dict[active_button]=[]
                                        slider_set_dict[active_button]=temp_set_val_list
                                    }else{
                                        slider_set_dict[active_button]=temp_set_val_list
                                    }
                                    // console.log('slider_set_dict',slider_set_dict)
                                    if (phoneset_dic[active_button]===undefined    ){
                                        phoneset_dic[active_button]=[];

                                    }
                                    else{
                                        //  a check to check if the retrieved mob id matches the id in the list 
                                        
                                        if (phoneset_dic[active_button].includes(json_data_mobiles[i]['id'])){
                                            input_checkb.checked=true;
                                        }

                                    }
                                    input_checkb.value=json_data_mobiles[i]['id'];
                                    input_checkb.id=json_data_mobiles[i]['id']+"cat";
                                    input_checkb.name=json_data_mobiles[i]['id']+"-"+json_data_mobiles[i]['Mobile_Name'];
                                    input_checkb.setAttribute('onchange','toggleCheckbox(this)')
                                    var img=document.createElement('img');
                                    img.setAttribute('class','img-responsive')
                                    // console.log("/static/"+json_data_mobiles[i]['imagepath1'])
                                    img.src="/static/"+json_data_mobiles[i]['imagepath1'];

                                    margin_b_20.append(input_checkb);
                                    margin_b_20.append(img);
                                    var mobile_name_p=document.createElement('p')
                                    mobile_name_p.innerHTML=json_data_mobiles[i]['Mobile_Name']
                                    col_md_4_post.append(mobile_name_p)
                                    var mobile_price_p=document.createElement('p')
                                    mobile_price_p.innerHTML=json_data_mobiles[i]['price']
                                    col_md_4_post.append(mobile_price_p)
                                    var link=document.createElement('a');
                                    link.setAttribute('class','link btn btn-success');
                                    // took alot of time finding this solution...
                                    var url = "{% url 'mobileinfo' id=4  %}".replace("4", json_data_mobiles[i]['id']);
                                    link.href= url;

                                    link.text="READ MORE";
                                    col_md_4_post.append(link); 
                                    // if (i%3===0 && i!==0){
                                       
                                    // }
                                    // console.log(i)
                                }
                                // console.log("global_phones_exp_phones",global_phones_exp_phones);
                                for (phones in global_phones_exp_phones){
                                    $('input:checkbox[id^='+global_phones_exp_phones[phones]+"cat"+']:not(:checked)').prop('checked',true);
                                    // console.log("catt",$('input:checkbox[id^='+global_phones_exp_phones[phones].id+"cat"+']:not(:checked)').attr('id'));

                                }
                            }
                                
                                
                         }); 
                       
                    }
        });

    }
   
      
}

    // fetch data from server against the experiment underconstruction and see if there is any mobiles present. 
    //  NO NEED FOR THIS NOW, REMOVE IN Future,
    function populateExpPhones(){
        $.ajax({
            type: 'GET',
            dataType: "json",
            'data': {
                'custom_exp_id':custom_exp_id,
            'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            url: "{% url 'get_selectedadmin_phones' %}",
                success: function(data){
                    var phns=data['cellphones'];
                    // global_phones_exp_phones=phns
                    // console.log("gbphones",phns)
                    // console.log("phns",phns);
                    var lpd=document.getElementById('expphonelist_div');
                    for (p in phns){
                        console.log("Mobile name",phns[p].Mobile_Name)
                        var div_row=document.createElement('div');
                        div_row.setAttribute('class','row')
                        div_row.id=phns[p].id+"-catrow"
                        global_phones_exp_phones.push(phns[p].id);
                        $('input:checkbox[id^='+phns[p].id+"cat"+']:not(:checked)').prop('checked',true);
                        lpd.append(div_row);
                        var div_col_md_6_1=document.createElement('DIV');
                        div_col_md_6_1.setAttribute('class','col-md-6');
                        div_col_md_6_1.innerHTML=phns[p].Mobile_Name
                        div_row.append(div_col_md_6_1);
                        var div_col_md_6_2=document.createElement('div');
                        div_col_md_6_2.setAttribute('class','col-md-6');
                        var del_button=document.createElement('button');
                        del_button.textContent="Delete";
                        del_button.setAttribute('onclick','delExpPhone($(this).parent().parent())')
                        div_col_md_6_2.append(del_button);
                        div_row.append(div_col_md_6_2);
                    }

                     alert(data['data']);
                    
                }
            
            }); 
    }
    function delExpPhone(element){
        var mob_id=$(element).attr('id');
        split_id=mob_id.split('-')
        console.log("mob_id",split_id[0]);
        mob_id=split_id[0]
        $.ajax({
            type: 'POST',
            dataType: "json",
            'data': {
            'mobiledata': JSON.stringify(mob_id),
            'custom_exp_id':custom_exp_id,
            'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            // the ajax call is sent to subdetails url name in the post function.  
            url: "{% url 'remove_selected_admin_phones' %}",
                success: function(data){
                 $('input:checkbox[id^='+mob_id+"cat"+']:checked').prop("checked", false);
                    alert(data['data']);

                    var index = global_phones_exp_phones.indexOf(parseInt(mob_id));
                     if (index > -1) {
                        global_phones_exp_phones.splice(index, 1);
                            }
                    console.log("global_phones_exp_phones_delPhones_remove",global_phones_exp_phones)

                }
            
            }); 
        $(element).remove()
    }
    function expPhone_UpdataList(element){
         var lpd=document.getElementById('expphonelist_div');
         var div_row=document.createElement('div');
         div_row.setAttribute('class','row')
        //  div_row.id=element.value
         global_phones_exp_phones.push(parseInt(element.value))
         console.log("global_phones_exp_phones_updatelist",global_phones_exp_phones)

         div_row.id=element.value+"-catrow"
         lpd.append(div_row);
         var div_col_md_6_1=document.createElement('DIV');
         div_col_md_6_1.setAttribute('class','col-md-6');
         //// IN FUTURE KEEP THIS PART IN CHECK>>
         var name=element.name.split('-')
         console.log("ele name",name[1]);
         div_col_md_6_1.innerHTML=name[1];
         div_row.append(div_col_md_6_1);
         var div_col_md_6_2=document.createElement('div');
         div_col_md_6_2.setAttribute('class','col-md-6');
         var del_button=document.createElement('button');
         del_button.textContent="Delete";
         del_button.setAttribute('onclick','delExpPhone($(this).parent().parent())')
         div_col_md_6_2.append(del_button);
         div_row.append(div_col_md_6_2);

    }
  
    var phoneset_dic={}
    var lista=[]
    var listb=[]
    var phonename_dic={}
    function toggleCheckbox(element){
        // check the active set 
        // create a key with active set name. having an empty list. 
        // if the dict already contains the key get the list and append it with the new mob element
        // else add the mob in a list and put against that specific key. 

        var setphonelist=[];
        console.log("Element",element.name);
        var mob_id=parseInt(element.value);
        // On toggle check pass the element to an exp_phone list for updation. 
       
        if (element.checked == true){
           // on checking the mobile simply save the data in a dictionary. 
            // setphonelist.push(mob_id)
            
            console.log("dictxd",phoneset_dic)
            if (active_button in  phoneset_dic){
                phoneset_dic[active_button].push(mob_id)
            }else{

                phoneset_dic[active_button]=[]
                phoneset_dic[active_button].push(mob_id)
            }
            console.log("phoneset_dic",phoneset_dic)
            
            $.ajax({
            type: 'POST',
            dataType: "json",
            'data': {
            'mobile_id': mob_id,
            'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            // the ajax call is sent to subdetails url name in the post function.  
            url: "{% url 'retspecmobilephone' %}",
                success: function(data){
                    if (active_button in  phonename_dic){
                        phonename_dic[active_button].push(data['phone'])
                        $('#expphonelist_div').empty();
                        var expphonelist_div=document.getElementById('expphonelist_div');
                        var main_row_div=document.createElement("div");
                        main_row_div.setAttribute("class","row");
                        expphonelist_div.append(main_row_div);

                        var main_col_div=document.createElement('div');
                        main_col_div.setAttribute('class','col-md-12');
                        main_col_div.id=active_button+"unq";

                        main_row_div.append(main_col_div);
                        var h_div=document.createElement("div");
                        h_div.innerHTML=active_button;

                        main_col_div.append(h_div);

                        for (var i in phonename_dic[active_button]){
                            var row_div=document.createElement("div");
                            row_div.setAttribute("class","row");
                            var col_div=document.createElement('div');
                            col_div.setAttribute('class','col-md-12');
                            main_col_div.append(row_div);
                            row_div.append(col_div);
                            
                            col_div.append(phonename_dic[active_button][i]);
                        }
                        
                        for (var key in phonename_dic){
                            

                            if (key!==active_button){
                                if (phonename_dic[key]===undefined){
                                    phonename_dic[key]=[]

                                }
                                var main_col_div=document.createElement('div');
                                main_col_div.setAttribute('class','col-md-12');
                                main_col_div.id=key;
                                main_row_div.append(main_col_div);
                                var h_div=document.createElement("div");
                                h_div.id=key;
                                h_div.innerHTML=key;
                                main_col_div.append(h_div);

                                for (var i in phonename_dic[key]){
                                    var row_div=document.createElement("div");
                                    row_div.setAttribute("class","row");
                                    var col_div=document.createElement('div');
                                    col_div.setAttribute('class','col-md-12');
                                    main_col_div.append(row_div);
                                    row_div.append(col_div);
                                    if(phonename_dic[key].length===0){
                                        col_div.append(phonename_dic[key]);
                                    }
                                    else{
                                        col_div.append(phonename_dic[key][i]);
                                    }
                                }
                            }else{
                                console.log("Match")
                            }
                        }
                        // var expphonelist_div=document.getElementById('expphonelist_div');
                        // var row_div=document.createElement("div");
                        // row_div.setAttribute("class","row");
                        // var col_div=document.createElement('div');
                        // col_div.setAttribute('class','col-md-12');
                        // row_div.append(col_div);
                        // expphonelist_div.append(row_div);
                        // col_div.append(data['phone']);
                        // $('#expphonelist_div').append(data['phone'])

                     }else{

                        phonename_dic[active_button]=[]
                        phonename_dic[active_button].push(data['phone'])
                        $('#expphonelist_div').empty();
                        var expphonelist_div=document.getElementById('expphonelist_div');
                        var main_row_div=document.createElement("div");
                        main_row_div.setAttribute("class","row");
                        expphonelist_div.append(main_row_div);

                        var main_col_div=document.createElement('div');
                        main_col_div.setAttribute('class','col-md-12');
                        main_col_div.id=active_button+"unq"

                        main_row_div.append(main_col_div);
                        var h_div=document.createElement("div");
                        h_div.id=active_button;
                        h_div.innerHTML=active_button;

                        main_col_div.append(h_div);

                        for (var i in phonename_dic[active_button]){
                            var row_div=document.createElement("div");
                            row_div.setAttribute("class","row");
                            var col_div=document.createElement('div');
                            col_div.setAttribute('class','col-md-12');
                            main_col_div.append(row_div);
                            row_div.append(col_div);
                            
                            col_div.append(phonename_dic[active_button][i]);
                        }
                        
                        for (var key in phonename_dic){

                            if (key!==active_button){
                                if (phonename_dic[key]===undefined){
                                    phonename_dic[key]=[]

                                }
                                var main_col_div=document.createElement('div');
                                main_col_div.setAttribute('class','col-md-12');
                                main_col_div.id=key+"unq";
                                main_row_div.append(main_col_div);
                                var h_div=document.createElement("div");
                                h_div.innerHTML=key;
                                main_col_div.append(h_div);

                                for (var i in phonename_dic[key]){
                                    var row_div=document.createElement("div");
                                    row_div.setAttribute("class","row");
                                    var col_div=document.createElement('div');
                                    col_div.setAttribute('class','col-md-12');
                                    main_col_div.append(row_div);
                                    row_div.append(col_div);
                                    if(phonename_dic[key].length===0){
                                        col_div.append(phonename_dic[key]);
                                    }
                                    else{
                                        col_div.append(phonename_dic[key][i]);
                                    }
                                }
                            }else{
                                console.log("Match")
                            }
                        }
                        

                        // $('#expphonelist_div').append(data['phone'])

                    }
                    console.log("phonename_dic--#=>>",phonename_dic)

                    console.log("PHONE DATA--#=>>",data['phone'])
                }
            
            }); 

         
        } 
        else { 
            //on unchecking remove the mobile from the list of phoneset_dic
            console.log("dictxd",phoneset_dic)
            if (active_button in  phoneset_dic){
                var list= phoneset_dic[active_button];
                var namelist=phonename_dic[active_button];
                ind=list.indexOf(mob_id),1;
                namelist.splice(ind,1);

                list.splice(list.indexOf(mob_id),1);
                if (list.length===0){
                    // delete phoneset_dic[active_button];
                    // delete phonename_dic[active_button];
                    // var col_div=document.getElementById(active_button+"unq");
                    // col_div.parentNode.removeChild(col_div);

                    if ($('#backbutton_id').text()==="Back"){
                        $(element).parent().parent().remove();
                    }
                   
                    console.log("after removing phoneset_dic",phoneset_dic)
                }else{
                phoneset_dic[active_button]=list;
                phonename_dic[active_button]=namelist;
                $('#expphonelist_div').empty();
                var expphonelist_div=document.getElementById('expphonelist_div');
                var main_row_div=document.createElement("div");
                main_row_div.setAttribute("class","row");
                expphonelist_div.append(main_row_div);

                var main_col_div=document.createElement('div');
                main_col_div.setAttribute('class','col-md-12');
                main_col_div.id=active_button+"unq"

                main_row_div.append(main_col_div);
                var h_div=document.createElement("div");
                h_div.innerHTML=active_button;
                main_col_div.append(h_div);
                for (var i in phonename_dic[active_button]){
                    var row_div=document.createElement("div");
                    row_div.setAttribute("class","row");
                    var col_div=document.createElement('div');
                    col_div.setAttribute('class','col-md-12');
                    main_col_div.append(row_div);
                    row_div.append(col_div);
                    
                    col_div.append(phonename_dic[active_button][i]);
                }
                        
                        for (var key in phonename_dic){

                            if (key!==active_button){
                                if (phonename_dic[key]===undefined){
                                    phonename_dic[key]=[]

                                }
                                var main_col_div=document.createElement('div');
                                main_col_div.setAttribute('class','col-md-12');
                                main_col_div.id=key+"unq"
                                main_row_div.append(main_col_div);
                                var h_div=document.createElement("div");
                                h_div.id=key;
                                h_div.innerHTML=key;
                                main_col_div.append(h_div);

                                for (var i in phonename_dic[key]){
                                    var row_div=document.createElement("div");
                                    row_div.setAttribute("class","row");
                                    var col_div=document.createElement('div');
                                    col_div.setAttribute('class','col-md-12');
                                    main_col_div.append(row_div);
                                    row_div.append(col_div);
                                    if(phonename_dic[key].length===0){
                                        col_div.append(phonename_dic[key]);
                                    }
                                    else{
                                        col_div.append(phonename_dic[key][i]);
                                    }
                                }
                            }else{
                                console.log("Match")
                            }
                        }
                       
                // $('#expphonelist_div').append(phonename_dic[active_button])
                console.log("<<phonename_dic",phonename_dic)
                if ($('#backbutton_id').text()==="Back"){
                        $(element).parent().parent().remove();

                    }

                console.log("after removing one element from list",phoneset_dic);
                }
            }    

        }
       
       
    }
   
    </script>
<script>
    var crit_order_dict={};
    var crit_hide_dict={};
    var active_co="CO.1";
    var feat_to_disp=[];
    var feat_to_hide=[];
    function orderCriteriaHtmlSetup(CO,CO_list){
        var colist=CO_list;
        $("#order_criteria_div").empty();

        $("#order_criteria_div").show();
        // CREATING HTML <-->
        var order_criteria_div=document.getElementById("order_criteria_div");
        var container=document.createElement("div");
        container.setAttribute('class','container-fluid text-center');
        order_criteria_div.append(container);
        var main_row=document.createElement('div');
        main_row.setAttribute('class','row content');
        container.append(main_row);
        var col_md_1=document.createElement('div');
        col_md_1.setAttribute('class','col-md-1 sidenav');
        main_row.append(col_md_1);
        var back_to_main_setup_btn=document.createElement('button');
        back_to_main_setup_btn.innerHTML="Back";
        back_to_main_setup_btn.setAttribute('onclick','showFeatureLvls()')
        col_md_1.append(back_to_main_setup_btn);
        var col_md_5=document.createElement('div');
        col_md_5.setAttribute('class','col-md-5 text-left');
        main_row.append(col_md_5);

        var select_div=document.createElement('div');
        select_div.setAttribute('id','select_div');
        var container_two=document.createElement('div');
        container_two.setAttribute('class','container ');
        container_two.id="product-section";
        col_md_5.append(select_div);
        col_md_5.append(container_two);
        var disp_feat_div=document.createElement("div");
        disp_feat_div.setAttribute('id','display_feature_div');
        container_two.append(disp_feat_div);
        var col_md_5_2=document.createElement('div');
        col_md_5_2.setAttribute('class','col-md-5');
        main_row.append(col_md_5_2);
        var hiddenfeat_div=document.createElement('div');
        col_md_5_2.append(hiddenfeat_div);
        var h2=document.createElement('h2');
        h2.innerHTML="Hidden Features";
        hiddenfeat_div.append(h2);
        var hide_feature_div=document.createElement('div');
        hide_feature_div.setAttribute('id','hide_feature_div');
        
        hiddenfeat_div.append(hide_feature_div);
        var recenthiddenfeat_div=document.createElement('div');
        recenthiddenfeat_div.setAttribute('id','recent_hidden_div');
        col_md_5_2.append(recenthiddenfeat_div);
        var h2=document.createElement('h2');
        h2.innerHTML="Recent  Hidden Features";
        var ul_mylist=document.createElement('ul');
        ul_mylist.setAttribute('id','myList');
        recenthiddenfeat_div.append(h2);
        recenthiddenfeat_div.append(ul_mylist);
        var col_md_1=document.createElement('div');
        col_md_1.setAttribute('class','col-md-1 sidenav');
        main_row.append(col_md_1);
        var save_to_main_setup_btn=document.createElement('button');
        save_to_main_setup_btn.innerHTML="Save";
        save_to_main_setup_btn.setAttribute('onclick',"saveOrderSet()");
        col_md_1.append(save_to_main_setup_btn);

        get_data_Ajax(colist);

    }
    function get_data_Ajax(colist){
        if (crit_order_dict[active_co]===undefined){
      crit_order_dict[active_co]=[]
    }
        // ajax call to get feature_to_display, feature_to_hide
    $.ajax({
                                url: "{% url 'ordercriteriasetup' %}",
                                type:'GET',
                                'data': {
                                'csrfmiddlewaretoken': '{{ csrf_token }}',
                                },
                                dataType: "json",
                                
                                success: function(data){
                                // this will be changed numofsets will be given by user...
                                var inputdata =colist
                                var select=document.createElement('select');
                                select.setAttribute('id', 'sel_options');
                                select.setAttribute('onchange',"selChangeFunc($(this))")
                                for (var i=0;i<inputdata.length;i++){
                                        var option=document.createElement('option');
                                        option.value=inputdata[i];
                                        option.text=inputdata[i];
                                        select.append(option);
                                }
                                var shw_disp=[];
                                var hide_disp=[];
                                $('#select_div').empty()
                                $('#select_div').append(select);   
                                var feat_dsp=data['feature_to_display'];
                                feat_to_disp=data['feature_to_display'];
                                var disp_feat_div=document.getElementById('display_feature_div');
                                var ul_sortable=document.createElement('ul');
                                ul_sortable.setAttribute('id','sortable');
                                disp_feat_div.append(ul_sortable);
                                for (var i in feat_dsp){
                                    console.log(feat_dsp[i].feature);
                                var li_sortable=document.createElement('li');
                                li_sortable.id=feat_dsp[i].feature+"_"+feat_dsp[i].position;
                                ul_sortable.append(li_sortable);
                                var div_row=document.createElement('div');
                                div_row.setAttribute("class",'row');
                                li_sortable.append(div_row);    
                                var div_col_md_6_1=document.createElement('div');
                                div_col_md_6_1.setAttribute("class","col-md-6");
                                div_row.append(div_col_md_6_1);
                                var btn_btn_primary=document.createElement('button');
                                btn_btn_primary.setAttribute("class","btn btn-primary");
                                btn_btn_primary.innerHTML=feat_dsp[i].feature;
                                div_col_md_6_1.appendChild(btn_btn_primary);
                                var div_col_md_6_2=document.createElement('div');
                                div_col_md_6_2.setAttribute('class',"col-md-6");
                                div_row.append(div_col_md_6_2);
                                var btn_show_hide=document.createElement('button');
                                btn_show_hide.setAttribute("class","show_hide");
                                btn_show_hide.setAttribute("onclick","hideFromDisplay($(this).parent().parent().parent().attr('id'))");
                                btn_show_hide.innerHTML="Hide";
                                div_col_md_6_2.appendChild(btn_show_hide);
                                shw_disp.push(feat_dsp[i].feature);
                                }
                                var feat_hide=data['feature_to_hide'];
                                feat_to_hide=data['feature_to_hide'];
                                var hide_feat_div=document.getElementById('hide_feature_div');
                                var ul_hiddenfeat=document.createElement('ul');
                                ul_hiddenfeat.setAttribute("id","hiddenfeat");
                                hide_feat_div.append(ul_hiddenfeat);
                                for (var i in feat_hide){

                                    console.log(feat_hide[i].feature);
                                    var li_hiddenfeat=document.createElement('li');
                                    li_hiddenfeat.id=feat_hide[i].feature+"_"+feat_hide[i].position
                                    ul_hiddenfeat.append(li_hiddenfeat);

                                    var div_row=document.createElement('div')
                                    div_row.setAttribute('class','row');
                                    li_hiddenfeat.append(div_row);
                                    var div_col_md_6_1=document.createElement('div');
                                    div_col_md_6_1.setAttribute('class','col-md-6');
                                    div_row.append(div_col_md_6_1);
                                    var div_col_md_6_2=document.createElement('div');
                                    div_col_md_6_2.setAttribute('class','col-md-6');
                                    div_row.append(div_col_md_6_2);
                                    var btn_btn_primary=document.createElement('btn');
                                    btn_btn_primary.setAttribute('class','btn btn-primary');
                                    btn_btn_primary.innerHTML=feat_hide[i].feature;
                                    div_col_md_6_1.append(btn_btn_primary);
                                    var btn_show_hide=document.createElement('button');
                                    btn_show_hide.setAttribute('class','show_hide');
                                    btn_show_hide.setAttribute('onclick','showToDisplay($(this).parent().parent().parent().attr("id"))');
                                    btn_show_hide.innerHTML="show";
                                    div_col_md_6_2.append(btn_show_hide);
                                    hide_disp.push(feat_hide[i].feature)
                               
                                }
                                crit_order_dict[active_co]=shw_disp;
                                crit_hide_dict[active_co]=hide_disp;
                                console.log("crit_order_dict-->",crit_order_dict);
                                console.log("crit_hide_dict-->",crit_hide_dict);

                                $('ul').sortable({
                                    axis: 'y',
                                    stop: function (event, ui) {
                                    var data = $(this).sortable('serialize').split("&");
                                    var arr=[];
                                    for (var key in data)
                                    {   
                                        arr.push(data[key].split("=")[0].replace('[]',''));
                                    }
                                    console.log("arr",arr)
                                    console.log("crit_order_dict-->",crit_order_dict)

                                    console.log("jason string",JSON.stringify(arr))

                                    $('span').text(data);
                                    if (crit_order_dict[active_co]===undefined){
                                        crit_order_dict[active_co]=[]
                                    }
                                    else{
                                    crit_order_dict[active_co]=arr;
                                    crit_hide_dict[active_co]=hide_disp;
                                    console.log("crit_order_dict",crit_order_dict);
                                    console.log("crit_hide_dict",crit_hide_dict);

                                    }
                                    // $.ajax({
                                
                                    //     type: 'POST',
                                    //     dataType: "json",
                                    //     'data': {
                                    //     'd': JSON.stringify(arr),

                                    //     'csrfmiddlewaretoken': '{{ csrf_token }}',
                                    //     },
                                        
                                    //     url: "{% url 'updatefeatureposition' %}",
                                    //     success: function(response){
                                    //     console.log("success");
                                    //     }
                                    // });
                                    }
                                });
                                

                            }

                        });

    }
    
    function saveOrderSet(){
        console.log("crit_order_dict",crit_order_dict);
        console.log("crit_hide_dict",crit_hide_dict);
        // make an ajax call that will send the two dicts to server. 
        $.ajax({
                                
                                        type: 'POST',
                                        dataType: "json",
                                        'data': {
                                        'featlevels_dic': JSON.stringify(dict,undefined,''),
                                        'crit_order_dict':JSON.stringify(crit_order_dict),
                                        'crit_hide_dict':JSON.stringify(crit_hide_dict),

                                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                                        },
                                        
                                        url: "{% url 'ordercriteriasetup' %}",
                                        success: function(data){
                                            if(exp_id===""){
                                                    exp_id = data['exp_id'];
                                                    custom_exp_id = data['custom_exp_id'];
                                                    showExpWIP()
                                                    }
                                                    if (data['block_list']!=null){
                                                        blockList = data['block_list']
                                                        table_blocks=draw_block_table(blockList)
                                                        display_blocktable(table_blocks);
                                                        window.localStorage.setItem("blockList", JSON.stringify(blockList));
                                                    }
                                                    alert("HERE")

                                                    showFeatureLvls();    
                                                    // not a good sol
                                                    $('#6-innercheckboxdiv').show();                               
                                        }
                                    });


    }
</script>
<script>

   function selChangeFunc(element){
        role_data=$(element).val();
        console.log("role_data", role_data ); 
        active_co=role_data
        alert(active_co)
        $('#recent_hidden_div').empty();
        $('#hide_feature_div').empty();
        $("#display_feature_div").empty();

        var recenthiddenfeat_div=document.getElementById('recent_hidden_div');
        console.log("recenthiddenfeat_div",recenthiddenfeat_div)
        var h2=document.createElement('h2');
        h2.innerHTML="Recent  Hidden Features";
        var ul_mylist=document.createElement('ul');
        ul_mylist.setAttribute('id','myList');
        recenthiddenfeat_div.append(h2);
        recenthiddenfeat_div.append(ul_mylist);
        
        var hide_feature_div=document.getElementById('hide_feature_div');

        var ul_hiddenfeat=document.createElement('ul');
        ul_hiddenfeat.setAttribute("id","hiddenfeat");
        hide_feature_div.append(ul_hiddenfeat);

        if(crit_order_dict[active_co]===undefined || crit_hide_dict===undefined){
            var feat_dsp=["os",'cpu','price','size'];
            var ft_hide=[]
        }
        else{
            var feat_dsp =crit_order_dict[active_co];
            var ft_hide=crit_hide_dict[active_co];
        }
        
        var disp_feat_div=document.getElementById('display_feature_div');
        var ul_sortable=document.createElement('ul');
        ul_sortable.setAttribute('id','sortable');
        disp_feat_div.append(ul_sortable);
        var  shw_disp=[];
        var hide_disp=[];
        for (var i in feat_dsp){
            console.log(feat_dsp[i]);
        var li_sortable=document.createElement('li');
        var k=parseInt(i)+1

        li_sortable.id=feat_dsp[i]+"_"+k;
        ul_sortable.append(li_sortable);
        var div_row=document.createElement('div');
        div_row.setAttribute("class",'row');
        li_sortable.append(div_row);    
        var div_col_md_6_1=document.createElement('div');
        div_col_md_6_1.setAttribute("class","col-md-6");
        div_row.append(div_col_md_6_1);
        var btn_btn_primary=document.createElement('button');
        btn_btn_primary.setAttribute("class","btn btn-primary");
        btn_btn_primary.innerHTML=feat_dsp[i];
        div_col_md_6_1.appendChild(btn_btn_primary);
        var div_col_md_6_2=document.createElement('div');
        div_col_md_6_2.setAttribute('class',"col-md-6");
        div_row.append(div_col_md_6_2);
        var btn_show_hide=document.createElement('button');
        btn_show_hide.setAttribute("class","show_hide");
        btn_show_hide.setAttribute("onclick","hideFromDisplay($(this).parent().parent().parent().attr('id'))");
        btn_show_hide.innerHTML="Hide";
        div_col_md_6_2.appendChild(btn_show_hide);
        shw_disp.push(feat_dsp[i]);

        }
        var feat_hide=ft_hide;
        var hide_feat_div=document.getElementById('hide_feature_div');
        var ul_hiddenfeat=document.createElement('ul');
        ul_hiddenfeat.setAttribute("id","hiddenfeat");
        hide_feat_div.append(ul_hiddenfeat);
        for (var i in feat_hide){

            var li_hiddenfeat=document.createElement('li');
            li_hiddenfeat.id=feat_hide[i]+"_"+i
            ul_hiddenfeat.append(li_hiddenfeat);

            // var div_row=document.createElement('div');
            // div_row.setAttribute('class','row');
            // temp.append(div_row);
            // var div_col_md_6_1=document.createElement('div');
            // div_col_md_6_1.setAttribute('class','col-md-6');
            // div_row.append(div_col_md_6_1);
            // var btn_btn_primary=document.createElement('btn');
            // btn_btn_primary.setAttribute('class','btn btn-primary');
            // btn_btn_primary.innerHTML=data[0];
            // div_col_md_6_1.append(btn_btn_primary);
            // var div_col_md_6_2=document.createElement('div');
            // div_col_md_6_2.setAttribute('class','col-md-6');
            // div_row.append(div_col_md_6_2);
            // var btn=document.createElement('button');
            // btn.setAttribute('class','show_hide');
            // btn.setAttribute('onclick','showToDisplay($(this).parent().parent().parent().attr("id"))');
            // btn.innerHTML="show";
            // div_col_md_6_2.append(btn);
        
        

            var div_row=document.createElement('div')
            div_row.setAttribute('class','row');
            li_hiddenfeat.append(div_row);
            var div_col_md_6_1=document.createElement('div');
            div_col_md_6_1.setAttribute('class','col-md-6');
            div_row.append(div_col_md_6_1);
            var div_col_md_6_2=document.createElement('div');
            div_col_md_6_2.setAttribute('class','col-md-6');
            div_row.append(div_col_md_6_2);
            var btn_btn_primary=document.createElement('btn');
            btn_btn_primary.setAttribute('class','btn btn-primary');
            btn_btn_primary.innerHTML=feat_hide[i];
            div_col_md_6_1.append(btn_btn_primary);
            var btn_show_hide=document.createElement('button');
            btn_show_hide.setAttribute('class','show_hide');
            btn_show_hide.setAttribute('onclick','showToDisplay($(this).parent().parent().parent().attr("id"))');
            btn_show_hide.innerHTML="show";
            div_col_md_6_2.append(btn_show_hide);
            hide_disp.push(feat_hide[i]);


        }
            crit_order_dict[active_co]=shw_disp;
            crit_hide_dict[active_co]=hide_disp;
            console.log("crit_order_dict->>",crit_order_dict);
            console.log("crit_hide_dict->>",crit_hide_dict);

            $('ul').sortable({
                axis: 'y',
                stop: function (event, ui) {
                console.log("thus",$(this))
                var data = $(this).sortable('serialize').split("&");
                var arr=[];
                console.log("data",data)
                for (var key in data)
                {   
                    console.log("key",key)
                    arr.push(data[key].split("=")[0].replace('[]',''));

                }
                console.log("arr",arr)
                                    console.log("crit_order_dict-->",crit_order_dict)

                                    console.log("jason string",JSON.stringify(arr))

                                    $('span').text(data);
                                    if (crit_order_dict[active_co]===undefined){
                                        crit_order_dict[active_co]=[]
                                    }
                                    else{
                                    crit_order_dict[active_co]=arr;
                                    crit_hide_dict[active_co]=hide_disp;

                                    console.log("crit_order_dict-",crit_order_dict)
                                    console.log("crit_hide_dict-",crit_hide_dict);

                                    }
                                            //   $.ajax({
                                          
                                            //         type: 'POST',
                                            //         dataType: "json",
                                            //         'data': {
                                            //         'd': JSON.stringify(arr),
        
                                            //         'csrfmiddlewaretoken': '{{ csrf_token }}',
                                            //       },
                                                  
                                            //         url: "{% url 'updatefeatureposition' %}",
                                            //         success: function(response){
                                            //         console.log("success");
                                            //         }
                                            //     });
                                              }
                                          });
        }
        
        // $.ajax({
        //        type: 'POST',
        //        dataType: "json",
        //        'data': {
        //        'set': set_num,
        //        'csrfmiddlewaretoken': '{{ csrf_token }}',
        //         },
        //        url: "{% url 'gf' %}",
        //        success: function(response){
        //            console.log("success");
        //        }
        //    });
              // location.reload().delay(800);
         
        
        function hideFromDisplay(id) {
           var item = $('#'+id);
           console.log(id);
           var temp=document.getElementById(id);
          //  var temp = item;
          
           item.find(".show_hide").remove();
          //  var btn = $('<button>Show</button>').attr('width','200px').addClass('show_hide').attr('onclick', '(showToDisplay('+id+'))');
          // var btn = $('<button>Show</button>').attr('width','200px').addClass('show_hide').attr('onclick', '(showToDisplay($(this).parent().attr("id")))');
          var btn=document.createElement('button');
          btn.setAttribute('class','show_hide');
          btn.setAttribute('onclick','showToDisplay($(this).parent().parent().parent().attr("id"))');
          btn.innerHTML="show"
          var data = id.split("_");  
          console.log("data",data[0])
          var arr=[];
          var elem="";
          for (var key in data)
                    {   
                        console.log("key",key);
                        arr.push(data[key]);
                        elem=data[key];
                        break;
                    }
            console.log("temp2",temp )
        
           
            item.remove();
          
            console.log("jason st",JSON.stringify(arr));
            console.log("elem",elem);

            console.log("active_co",active_co)
            var index = crit_order_dict[active_co].indexOf(elem);
            console.log("INDEX",index)
                     if (index > -1) {
                       crit_order_dict[active_co].splice(index, 1);
                            }
            console.log("crit_order_dict<<<<",crit_order_dict)
            crit_hide_dict[active_co].push(elem);
            console.log("crit_hide_dict<<<",crit_hide_dict)
            var mylist=document.getElementById('myList');
              
              while (temp.firstChild) {
               temp.removeChild(temp.firstChild);
            }
              console.log("lastchild",temp);
              mylist.append(temp);
              var div_row=document.createElement('div');
              div_row.setAttribute('class','row');
              temp.append(div_row);
              var div_col_md_6_1=document.createElement('div');
              div_col_md_6_1.setAttribute('class','col-md-6');
              div_row.append(div_col_md_6_1);
              var btn_btn_primary=document.createElement('btn');
              btn_btn_primary.setAttribute('class','btn btn-primary');
              btn_btn_primary.innerHTML=data[0];
              div_col_md_6_1.append(btn_btn_primary);
              var div_col_md_6_2=document.createElement('div');
              div_col_md_6_2.setAttribute('class','col-md-6');
              div_row.append(div_col_md_6_2);
              div_col_md_6_2.append(btn);
              // $("#myList").append(temp);
        
        
          
        //    $.ajax({
        //        type: 'POST',
        //        dataType: "json",
        //        'data': {
        //        'd': JSON.stringify(arr),
        //        'csrfmiddlewaretoken': '{{ csrf_token }}',
        //       },
        //        url: "{% url 'hidefeature' %}",
        //        success: function(response){
        //        console.log("success");
        //        }
        //    });
         }
        
        function showToDisplay(id) {
            console.log("showToDisplayid",id)
            var item = $("#"+id);
            //var item=document.getElementById(id)
            // var item = $(id);
             var temp = document.getElementById(id);
                item.find(".show_hide").remove();
                //  var btn = $('<button>Hide</button>').attr('width', '200px').addClass('show_hide').attr('onclick', '(hideFromDisplay($(this).parent().attr("id")))');
                var btn=document.createElement('button');btn.setAttribute('class','show_hide');btn.setAttribute('onclick',"hideFromDisplay($(this).parent().parent().parent().attr('id'))");
                btn.innerHTML="Hide";
                var data =item.attr('id');
                console.log("showToDisplay_data",data)
                var d=data.split("_");
                var arr=[]; 
                var elem='';
                for (var key in d)
                  {   
                          console.log("key",key);
                          arr.push(d[key]);
                          elem=d[key];
                          break;
                }
                item.remove();
        
                // temp.append(btn);

            console.log("active_co",active_co)
            var index = crit_hide_dict[active_co].indexOf(elem);
            console.log("INDEX",index)
                     if (index > -1) {
                       crit_hide_dict[active_co].splice(index, 1);
                            }
            
            crit_order_dict[active_co].push(elem);
            console.log("crit_order_dict>>>>",crit_order_dict);
            console.log("crit_hide_dict>>>>",crit_hide_dict);
                
                var ul_sortable=document.getElementById('sortable');
                ul_sortable.append(temp);
                while (temp.firstChild) {
                temp.removeChild(temp.firstChild);
                }
        
                var div_row=document.createElement('div');
                div_row.setAttribute("class",'row');
                temp.append(div_row);    
                var div_col_md_6_1=document.createElement('div');
                div_col_md_6_1.setAttribute("class","col-md-6");
                div_row.append(div_col_md_6_1);
                var btn_btn_primary=document.createElement('button');
                btn_btn_primary.setAttribute("class","btn btn-primary");
                btn_btn_primary.innerHTML=d[0];
                div_col_md_6_1.append(btn_btn_primary);
                var div_col_md_6_2=document.createElement('div');
                div_col_md_6_2.setAttribute("class","col-md-6");
                div_row.append(div_col_md_6_2);
                div_col_md_6_2.appendChild(btn);
               // console.log(arr);
               // console.log("jason st",JSON.stringify(arr));
                // $("#sortable").append(temp);
                
        
        
        
        
                // $.ajax({
                // type: 'POST',
                // dataType: "json",
                // 'data': {
                // 'd': JSON.stringify(arr),
                // 'csrfmiddlewaretoken': '{{ csrf_token }}',
                // },
                // url: "{% url 'showfeature' %}",
                // success: function(response){
                // console.log("success");
                //  }
                // });
         }
        //  function myFun(id) {
                 
        //         var item = $('#'+id);
        //         var temp = item;
                 
        //         item.find(".show_hide").remove();
        //         var btn = $('<button>Hide</button>').attr('width', '200px').addClass('show_hide').attr('onclick', '(hideFromDisplay($(this).parent().attr("id")))');
        //         var data = id.split("_");
        //         var arr=[];
        //         for (var key in data)
        //           {   
        //               console.log("key",key);
        //               arr.push(data[key]);
        //               break;
        //           }
        //         temp.append(btn);
        //         item.remove();
        //         console.log(arr);
        //         console.log("jason st",JSON.stringify(arr));
        //         $("#sortable").append(temp);
        //         $.ajax({
        //           type: 'POST',
        //           dataType: "json",
        //           'data': {
        //           'd': JSON.stringify(arr),
        //           'csrfmiddlewaretoken': '{{ csrf_token }}',
        //           },
        //           url: "{% url 'showfeature' %}",
        //           success: function(response){
        //           console.log("success");
        //           }
        //        });
        //       }
             
              //  $(document).ready(function () {
                
              //   role_data=$('#roles option:selected').val()
              //   console.log(role_data ); 
              //   JSON.stringify(role_data)
              //   //    $.ajax({
                //     type: 'POST',
                //     dataType: "json",
                //     'data': {
                //     'd': JSON.stringify(role_data),
                //     'csrfmiddlewaretoken': '{{ csrf_token }}',
                //     },
                //     url: "{% url 'gf' %}",
                //     success: function(response){
                        
                //     console.log("success");
                //     }
                // });
              
        //        $('#sortable').sortable({
        //         axis: 'y',
        //         stop: function (event, ui) {
        //           console.log("thus",$(this))
        // 	        var data = $(this).sortable('serialize').split("&");
        //             var arr=[];
        //             console.log("data",data)
        //             for (var key in data)
        //             {   
        //                 console.log("key",key)
        //                 arr.push(data[key].split("=")[0].replace('[]',''));
        
        //             }
        //              console.log("arr",arr)
        //              console.log("jason string",JSON.stringify(arr))
        //             $('span').text(data);
        //            $.ajax({
               
        //                 type: 'POST',
        //                 dataType: "json",
        //                 'data': {
        //                 'd': JSON.stringify(arr),
        
        //                 'csrfmiddlewaretoken': '{{ csrf_token }}',
        //                },
                       
        //                 url: "{% url 'updatefeatureposition' %}",
        //                 success: function(response){
        //                 console.log("success");
        //                     }
        //             });
        // 	}
        //     });
        //  });
        
      function brandCheck_box(element){
        if (brand_set_dict[active_button]===undefined){
            brand_set_dict[active_button]=[];
        }
        
       
        if (element.checked === true){
            brand_set_dict[active_button].push(element.value);
            console.log("brand_set_dict!!!",brand_set_dict);
            $.ajax({
                type:"POST",
                dataType:"json",
                'data':{
                    'brands':JSON.stringify(brand_set_dict[active_button]),
                    'price':JSON.stringify(slider_set_dict[active_button]),
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                url: "{% url 'getReqPhones' %}",
                        success: function(data){
                            console.log(data['mobilephones']);
                                $('#mobile_catalog_div').empty();                            
                                // var json_data_mobiles=data['samsung_phones']
                                var json_data_mobiles=data['mobilephones']
                                // var row_fluid=document.createElement('div');
                                // row_fluid.setAttribute('class','row-fluid');
                                // row_fluid.setAttribute('id','mobile_catalog_div');
                                row_fluid=$('#mobile_catalog_div');
                                var row=document.createElement('div');
                                row.setAttribute('class','row');
                                row_fluid.append(row);
                                var col_md_12=document.createElement("div");
                                col_md_12.setAttribute('class','col-md-12');
                                row.append(col_md_12);
                                var lps=document.createElement("div");
                                lps.setAttribute("class",'latest-product-section');
                                col_md_12.append(lps);
                                var rtc=document.createElement('DIV');
                                rtc.setAttribute("class","row text-center");
                                lps.append(rtc);
                                for (var i=0;i<json_data_mobiles.length;i++){
                                   
                                    // if (i%3===0 && i!==0){
                                    //     console.log("asd",i)
                                    //     var hr=document.createElement('hr');
                                    //     lps.append(hr); 
                                    //     var rtc=document.createElement('DIV');
                                    //     rtc.setAttribute("class","row text-center");
                                    //     lps.append(rtc);
                                      
                                    // }
                                    var col_md_4_post=document.createElement('DIV');
                                    col_md_4_post.setAttribute("class","col-md-4 sm-margin-b-50 pull-left post");
                                    rtc.append(col_md_4_post);
                                    var margin_b_20=document.createElement('DIV');
                                    margin_b_20.setAttribute("class","margin-b-20");
                                    col_md_4_post.append(margin_b_20);
                                    var input_checkb=document.createElement('input');
                                    input_checkb.type="checkbox";
                                    var temp_set_val_list=[];
                                    temp_set_val_list=slider_set_dict[active_button];

                                    if (slider_set_dict[active_button]===undefined){
                                        slider_set_dict[active_button]=[]
                                        slider_set_dict[active_button]=temp_set_val_list
                                    }else{
                                        slider_set_dict[active_button]=temp_set_val_list
                                    }
                                    // console.log('slider_set_dict',slider_set_dict)
                                    if (phoneset_dic[active_button]===undefined    ){
                                        phoneset_dic[active_button]=[];

                                    }
                                    else{
                                        //  a check to check if the retrieved mob id matches the id in the list 
                                        
                                        if (phoneset_dic[active_button].includes(json_data_mobiles[i]['id'])){
                                            input_checkb.checked=true;
                                        }

                                    }
                                    input_checkb.value=json_data_mobiles[i]['id'];
                                    input_checkb.id=json_data_mobiles[i]['id']+"cat";
                                    input_checkb.name=json_data_mobiles[i]['id']+"-"+json_data_mobiles[i]['Mobile_Name'];
                                    input_checkb.setAttribute('onchange','toggleCheckbox(this)')
                                    var img=document.createElement('img');
                                    img.setAttribute('class','img-responsive')
                                    // console.log("/static/"+json_data_mobiles[i]['imagepath1'])
                                    img.src="/static/"+json_data_mobiles[i]['imagepath1'];

                                    margin_b_20.append(input_checkb);
                                    margin_b_20.append(img);
                                    var mobile_name_p=document.createElement('p')
                                    mobile_name_p.innerHTML=json_data_mobiles[i]['Mobile_Name']
                                    col_md_4_post.append(mobile_name_p)
                                    var mobile_price_p=document.createElement('p')
                                    mobile_price_p.innerHTML=json_data_mobiles[i]['price']
                                    col_md_4_post.append(mobile_price_p)
                                    var link=document.createElement('a');
                                    link.setAttribute('class','link btn btn-success');
                                    // took alot of time finding this solution...
                                    var url = "{% url 'mobileinfo' id=4  %}".replace("4", json_data_mobiles[i]['id']);
                                    link.href= url;

                                    link.text="READ MORE";
                                    col_md_4_post.append(link); 
                                    // if (i%3===0 && i!==0){
                                       
                                    // }
                                    // console.log(i)
                                }
                                // console.log("global_phones_exp_phones",global_phones_exp_phones);
                                for (phones in global_phones_exp_phones){
                                    $('input:checkbox[id^='+global_phones_exp_phones[phones]+"cat"+']:not(:checked)').prop('checked',true);
                                    // console.log("catt",$('input:checkbox[id^='+global_phones_exp_phones[phones].id+"cat"+']:not(:checked)').attr('id'));

                                }
                        }
                });
        }
        else{
            // // run the query and return the num of mob phones and populate mobile_catalog_div on success. 

            ind=brand_set_dict[active_button].indexOf(element.value),1
            brand_set_dict[active_button].splice(ind,1);
            console.log("brand dic>>>")
            console.log(brand_set_dict)
            $.ajax({
                type:"POST",
                dataType:"json",
                'data':{
                    'brands':JSON.stringify(brand_set_dict[active_button]),
                    'price':JSON.stringify(slider_set_dict[active_button]),
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                url: "{% url 'getReqPhones' %}",
                        success: function(data){
                        console.log(data['mobilephones']);
                                $('#mobile_catalog_div').empty();                            
                                // var json_data_mobiles=data['samsung_phones']
                                var json_data_mobiles=data['mobilephones']
                                // var row_fluid=document.createElement('div');
                                // row_fluid.setAttribute('class','row-fluid');
                                // row_fluid.setAttribute('id','mobile_catalog_div');
                                row_fluid=$('#mobile_catalog_div');
                                var row=document.createElement('div');
                                row.setAttribute('class','row');
                                row_fluid.append(row);
                                var col_md_12=document.createElement("div");
                                col_md_12.setAttribute('class','col-md-12');
                                row.append(col_md_12);
                                var lps=document.createElement("div");
                                lps.setAttribute("class",'latest-product-section');
                                col_md_12.append(lps);
                                var rtc=document.createElement('DIV');
                                rtc.setAttribute("class","row text-center");
                                lps.append(rtc);
                                for (var i=0;i<json_data_mobiles.length;i++){
                                   
                                    // if (i%3===0 && i!==0){
                                    //     console.log("asd",i)
                                    //     var hr=document.createElement('hr');
                                    //     lps.append(hr); 
                                    //     var rtc=document.createElement('DIV');
                                    //     rtc.setAttribute("class","row text-center");
                                    //     lps.append(rtc);
                                      
                                    // }
                                    var col_md_4_post=document.createElement('DIV');
                                    col_md_4_post.setAttribute("class","col-md-4 sm-margin-b-50 pull-left post");
                                    rtc.append(col_md_4_post);
                                    var margin_b_20=document.createElement('DIV');
                                    margin_b_20.setAttribute("class","margin-b-20");
                                    col_md_4_post.append(margin_b_20);
                                    var input_checkb=document.createElement('input');
                                    input_checkb.type="checkbox";
                                    var temp_set_val_list=[];
                                    temp_set_val_list=slider_set_dict[active_button];
                                    // console.log("temp_set_val_list",temp_set_val_list)

                                    if (slider_set_dict[active_button]===undefined){
                                        slider_set_dict[active_button]=[]
                                        slider_set_dict[active_button]=temp_set_val_list
                                    }else{
                                        slider_set_dict[active_button]=temp_set_val_list
                                    }
                                    // console.log('slider_set_dict',slider_set_dict)
                                    if (phoneset_dic[active_button]===undefined    ){
                                        phoneset_dic[active_button]=[];

                                    }
                                    else{
                                        //  a check to check if the retrieved mob id matches the id in the list 
                                        
                                        if (phoneset_dic[active_button].includes(json_data_mobiles[i]['id'])){
                                            input_checkb.checked=true;
                                        }

                                    }
                                    input_checkb.value=json_data_mobiles[i]['id'];
                                    input_checkb.id=json_data_mobiles[i]['id']+"cat";
                                    input_checkb.name=json_data_mobiles[i]['id']+"-"+json_data_mobiles[i]['Mobile_Name'];
                                    input_checkb.setAttribute('onchange','toggleCheckbox(this)')
                                    var img=document.createElement('img');
                                    img.setAttribute('class','img-responsive')
                                    // console.log("/static/"+json_data_mobiles[i]['imagepath1'])
                                    img.src="/static/"+json_data_mobiles[i]['imagepath1'];

                                    margin_b_20.append(input_checkb);
                                    margin_b_20.append(img);
                                    var mobile_name_p=document.createElement('p')
                                    mobile_name_p.innerHTML=json_data_mobiles[i]['Mobile_Name']
                                    col_md_4_post.append(mobile_name_p)
                                    var mobile_price_p=document.createElement('p')
                                    mobile_price_p.innerHTML=json_data_mobiles[i]['price']
                                    col_md_4_post.append(mobile_price_p)
                                    var link=document.createElement('a');
                                    link.setAttribute('class','link btn btn-success');
                                    // took alot of time finding this solution...
                                    var url = "{% url 'mobileinfo' id=4  %}".replace("4", json_data_mobiles[i]['id']);
                                    link.href= url;

                                    link.text="READ MORE";
                                    col_md_4_post.append(link); 
                                    // if (i%3===0 && i!==0){
                                       
                                    // }
                                    // console.log(i)
                                }
                                // console.log("global_phones_exp_phones",global_phones_exp_phones);
                                for (phones in global_phones_exp_phones){
                                    $('input:checkbox[id^='+global_phones_exp_phones[phones]+"cat"+']:not(:checked)').prop('checked',true);
                                    // console.log("catt",$('input:checkbox[id^='+global_phones_exp_phones[phones].id+"cat"+']:not(:checked)').attr('id'));

                                }

                        }
                });
            alert("Unchecked");

        }
      
      }
      function brandCheck_Html_Crt(){
          console.log("brand_set_dict@@@",brand_set_dict)
          var listoftotalbrands=["Samsung","QMobile","Oppo"];
        
          $("#brand_check_div").empty();
          var brand_check_div=document.getElementById("brand_check_div");
          var col_md_12=document.createElement('div');
          col_md_12.setAttribute("class",'col-md-12');
          brand_check_div.append(col_md_12);
          col_md_12.append("BRANDS")
          var col_md_12=document.createElement('div');
          col_md_12.setAttribute("class",'col-md-12');
          brand_check_div.append(col_md_12);

          for (var i in listoftotalbrands){
              
            console.log("list_element", listoftotalbrands[i])
           
            var row1=document.createElement("div");
            row1.setAttribute("class","row");
            col_md_12.append(row1);
            var col_md_6_1=document.createElement('div');
            col_md_6_1.setAttribute("class",'col-md-6');
            row1.append(col_md_6_1);
            var p_ele=document.createElement("p");
            p_ele.innerHTML=listoftotalbrands[i];
            col_md_6_1.append(p_ele)
            var col_md_6_2=document.createElement('div');
            col_md_6_2.setAttribute("class",'col-md-6');
            row1.append(col_md_6_2);
            var checkbox_inp=document.createElement('input');

            checkbox_inp.setAttribute("onchange","brandCheck_box(this)");
            checkbox_inp.setAttribute("type","checkbox");
            checkbox_inp.value=listoftotalbrands[i];

            if (brand_set_dict[active_button]!==undefined){
                if ( brand_set_dict[active_button].indexOf(listoftotalbrands[i]) > -1){
                checkbox_inp.checked=true;
                }
            }
           
            col_md_6_2.append(checkbox_inp);


          }
      
          



      }
</script>
{%endblock%}